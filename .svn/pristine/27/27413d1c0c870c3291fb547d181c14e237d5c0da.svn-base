
@{
    ViewBag.Title = "ViewUnblockPackage";
    Layout = "~/Views/Shared/_CommonLayout.cshtml";
}
<style type="text/css">
    tr.highlight td.jsgrid-cell {
        background-color: lightgoldenrodyellow;
    }
    .jsgrid-grid-header,
    .jsgrid-grid-body {
        overflow: auto;
    }
</style>
<script type="text/javascript">
    $(document).ready(function () {
        $('#path').html('Unblock Package List');
        var arrUnblockPackage = [];
        fillgrid();
        $('#ddlRows').change(function () {
            if ($("option:selected", $("#ddlRows")).val() == '1') {
                $("#jsGrid").jsGrid({ pageSize: 10 });
            }
            else if ($("option:selected", $("#ddlRows")).val() == '2') {
                $("#jsGrid").jsGrid({ pageSize: 20 });
            }
            else if ($("option:selected", $("#ddlRows")).val() == '3') {
                $("#jsGrid").jsGrid({ pageSize: 50 });
            }
            else if ($("option:selected", $("#ddlRows")).val() == '4') {
                $("#jsGrid").jsGrid({ pageSize: 100 });
            }
            else if ($("option:selected", $("#ddlRows")).val() == '5') {
                $("#jsGrid").jsGrid({ pageSize: 200 });
            }
            else if ($("option:selected", $("#ddlRows")).val() == '6') {
                $("#jsGrid").jsGrid({ pageSize: 500 });
            }
        });
        $('#btnSearch').click(function () {
            if (validate()) {
                fillgrid();
            }
        }); 
    });
    function fillgrid()
    {
            var arrUnblockPackage = [];
            $('#jsGrid').jsGrid({
            width: "100%",          
            sorting: true,
            paging: true,
            pageSize: 10,
            pagerFormat: "Pages: {first} {prev} {pages} {next} {last} &nbsp;&nbsp; {pageIndex} of {pageCount} &nbsp;&nbsp; Total rows: {itemCount}",
            pageButtonCount: 10,
            autoload: true,
            rowClick: function (args) {
                //console.log(args)
                var $row = this.rowByItem(args.item),
                    selectedRow = $("#jsGrid").find('table tr.highlight');
                if (selectedRow.length) {
                    selectedRow.toggleClass('highlight');
                };

                $row.toggleClass("highlight");
            },
            controller: {
                loadData: function () {
                    var d = $.Deferred();
                    var RegParams = {
                        HospitalCode: '@Session["HospitalCode"]',
                        URN: $('#urnNo').val()
                    };
                    return $.ajax({
                        url: ServiceURL + "/api/Registration/GetUnblockingformation",
                        type: "GET",
                        data: RegParams,
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        error: function (error) {
                            console.log(error.statusText);
                        },
                    }).done(function (result) {
                        // console.log(result);
                        if (result.length > 0) {
                            $('#divRowCount').show();
                            d.resolve($.map(result, function (item, itemIndex) {
                                return $.extend(item, { "Index": itemIndex + 1 });
                            }
                          ));
                        }
                        else {
                            $('#divRowCount').hide();
                        }
                    });
                }
            },
             fields: [
                 { name: "Index", width: 30, type: "number", title: "#Sl", align: "center" },
                    { name: "memberID", title: "memberID", type: "number", visible: false },
                 { name: "headMemberName", title: "HeadOfFamily", type: "text", visible: false },
                 { name: "schemeCode", title: "schemeCode", type: "text", visible: false },
                 { name: "schemeName", title: "schemeName", type: "text", visible: false },
                 { name: "headMemberID", title: "headMemberID", type: "text", visible: false },
                 { name: "amoutBlocked", title: "amoutBlocked", type: "text", visible: false },
                 { name: "headMemberName", title: "headMemberName", type: "text", visible: false },
                 { name: "memberDistrictCode", title: "MemberDistrictCode", type: "number", visible: false },
                 { name: "memberDistrictName", title: "MemberDistrictName", type: "text", visible: false },
                 { name: "memberStateName", title: "MemberStateName", type: "text", visible: false },
                 { name: "transactionID", title: "TransactionID", type: "text", visible: false },
                 { name: "procedureCode", title: "procedureCode", type: "text", visible: false },
                 { name: "procedureName", title: "procedureName", type: "number", visible: false },
                 { name: "packageCode", title: "packageCode", type: "text", visible: false },
                 { name: "packageName", title: "packageName", type: "text", visible: false },
                 { name: "Category", title: "Category", type: "text", visible: false },
                 { name: "CategoryCode", title: "CategoryCode", type: "text", visible: false },
                 { name: "urn", type: "text", title: "HIMCARE No.", align: "center" },
                 { name: "cardNo", type: "text", title: "Card No.", align: "center", visible: false },
                 { name: "familyID", type: "text", title: "familyID", align: "center", visible: false },
                 { name: "memberName", type: "text",  title: "Name", align: "center"},
                 { name: "blockingInvoiceNo", type: "text", title: "Invoice No.", align: "center" },
                 { name: "packageName", type: "text", title: "Package Name", align: "center" },
                 { name: "registrationDate", type: "number", title: "Date Of Admission", align: "center" },
                 { name: "patientContactNumber", type: "number",title: "Contact Number", align: "center" },
                    { type: "control", editButton: false, deleteButton: false, align: "center",
                        itemTemplate: function (value,item) {
                            return $("<button>").attr({ type: "button", class: "btn btn-outline-success focusedBtn btn-sm my-2 my-sm-0" }).text("Unblock")
                                .on("click", function () {
                                    arrUnblockPackage.push({
                                        schemeCode: item.schemeCode,
                                        schemeName: item.schemeName,
                                        urn: item.urn,
                                        cardNo: item.cardNo,
                                        memberName: item.memberName,
                                        patientContactNumber:item.patientContactNumber,
                                        memberID:item.memberID,
                                        invoiceNo: item.blockingInvoiceNo,
                                        registrationDate:item.registrationDate,
                                        headMemberID: item.headMemberID,
                                        headMemberName: item.headMemberName,
                                        memberDistrictCode: item.memberDistrictCode,
                                        memberDistrictName: item.memberDistrictName,
                                        memberStateName: item.memberStateName,
                                        procedureCode: item.procedureCode,
                                        procedureName: item.procedureName,
                                        category: item.category,
                                        categoryCode: item.categoryCode,
                                        packageCode: item.packageCode,
                                        packageName: item.packageName,
                                        amoutBlocked: item.amoutBlocked,
                                        transactionID: item.transactionID,
                                        familyID: item.familyID
                                    })
                                    localStorage.setItem('UnlockPackageInfo', JSON.stringify(arrUnblockPackage));
                                  window.location.href = '@Url.Action("AddUnblockPackage", "UnblockPackage")';
                                });
                        },
                        headerTemplate: function () {
                            return $("<div>").prop("title", "Action").text("Action");
                        }
                    }
                ]
        });
    }
    function inputLimiter(e, allow) {
        var AllowableCharacters = '';
        if (allow == 'NameCharactersymbol') {
            AllowableCharacters = ' ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz./&';
        }
        if (allow == 'NameCharacters') {
            AllowableCharacters = ' ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-.\'';
        }
        if (allow == 'NameCharactersAndNumbers') {
            AllowableCharacters = '1234567890 ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-,/.\'';
        }
        if (allow == 'Description') {
            AllowableCharacters = '1234567890 ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-,./\&(){}[]#$:';
        }
        if (allow == 'Numbers') {
            AllowableCharacters = '1234567890';
        }
        if (allow == 'Decimal') {
            AllowableCharacters = '1234567890.';
        }
        var k;
        k = document.all ? parseInt(e.keyCode) : parseInt(e.which);
        if (k != 13 && k != 8 && k != 0) {
            if ((e.ctrlKey == false) && (e.altKey == false)) {
                return (AllowableCharacters.indexOf(String.fromCharCode(k)) != -1);
            }
            else {
                return true;
            }
        }
        else {
            return true;
        }
    }
    function validate() {
        if ($('#urnNo').val() == '') {
            alert('Please Enter URN !!');
            $('#urnNo').focus();
            return false;
        }
        else {
            return true;
        }
    }
 </script>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12 pb-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <form class="filter-wrapper">
                                            <div class="form-group row">
                                                <label for="packageHeader" class="col-sm-1 col-form-label">HIMCARE No.</label>
                                                <div class="col-sm-2">
                                                    <input type="text" class="form-control" autofocus id="urnNo" placeholder="Enter here" maxlength="17" onkeypress="return inputLimiter(event,'Numbers')" />
                                                </div>
                                                @*<label for="packageHeader" class="col-sm-2 col-form-label">From Date</label>
                        <div class="col-sm-2">
                            <div class="input-group mb-3">
                                <input type="text" id="FrmDt" class="form-control datepicker" placeholder="dd mmm yyyy" aria-label="Username" aria-describedby="basic-addon1" maxlength="11">
                                <div class="input-group-prepend">
                                    <label for="blockingDt" class="input-group-text"><i class="icon-calendar"></i></label>
                                </div>
                            </div>
                        </div>
                        <label for="packageHeader" class="col-sm-2 col-form-label">To Date</label>
                        <div class="col-sm-2">
                            <div class="input-group mb-3">
                                <input type="text" id="ToDt" class="form-control datepicker" placeholder="dd mmm yyyy" aria-label="Username" aria-describedby="basic-addon1" maxlength="11">
                                <div class="input-group-prepend">
                                    <label for="blockingDt" class="input-group-text"><i class="icon-calendar"></i></label>
                                </div>
                            </div>
                        </div>*@
                                                <div class="col-sm-1">
                                                    <input class="btn btn-outline-success my-2 my-sm-0" type="button" value="Search" id="btnSearch">
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>

                                <div class="row" id="divRowCount">
                                    <label for="Rows">&nbsp;&nbsp;&nbsp;Row count</label>
                                    <div class="col-sm-1">
                                        <select id="ddlRows" autofocus>
                                            <option value="1">10</option>
                                            <option value="2">20</option>
                                            <option value="3">50</option>
                                            <option value="4">100</option>
                                            <option value="5">200</option>
                                            <option value="6">500</option>
                                        </select>
                                    </div>
                                    <div class="col-sm-10"></div>
                                </div>
                                <div class="table table-striped table-bordered" id="jsGrid">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script type="text/javascript">
                $(function(){
                    $('.secondary-menu li a').tooltip();
                });
</script>

