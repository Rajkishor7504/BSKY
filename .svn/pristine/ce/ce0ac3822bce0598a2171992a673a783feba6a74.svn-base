@model HPSBYS.Data.Model.Login

@{
    /**/

    ViewBag.Title = "ChangePassword";
    Layout = "~/Views/Shared/_CommonLayout.cshtml";
}
<script type="text/javascript">
    $(document).keydown(function (event) {
        event = (event || window.event);
        if (event.keyCode == 13) {
            $('#btnSubmit').click();
        }
    });
    $(document).ready(function () {
        $('#path').html('Change Password');
        $('#btnReset').click(function () {
            Reset();
        });
        $('#btnSubmit').click(function () {
            if (validate()) {
                if (checkconfirm()) {
                    var ChamgePasswordParams = JSON.stringify({
                        ACTION: 'A',
                        UserID:@Session["UserID"],
                        UserName: '@Session["UserName"]',
                        Password: $('#Password').val(),
                        NewPassword: $('#NewPassword').val(),
                        ConfirmPassword: $('#ConfirmPassword').val()
                    });
                    $.ajax({
                        url: ServiceURL + "/api/Common/changePassword",
                        type: "POST",
                        data: ChamgePasswordParams,
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        success: function (data) {
                            // console.log(data);
                            if (data == '2') {
                                alert('Invalid Old Password!!');
                                $('#Password').focus();
                            }
                            else if (data == '1') {
                                alert('Password Change Sucessfully!!');
                                window.location.href = '@Url.Action("Login", "Dashboard")';
                            }
                        },
                        error: function (error) {
                            console.log(error.statusText);
                        }
                    });
                }
            }
        });
    });
    function Reset() {
        $('#Password').val('');
        $('#NewPassword').val('');
        $('#ConfirmPassword').val('');
    }
    function validate() {
        var regularExpression = /^(?=.*[0-9])(?=.*[!@@#$%^&*])[a-zA-Z0-9!@@#$%^&*]{6,16}$/;
        if ($('#Password').val() == "") {
            alert('Please Enter Old Password!!');
            $('#Password').focus();
            return false;
        }
        else if ($('#NewPassword').val() == "") {
            alert('Please Enter New Password!!');
            $('#NewPassword').focus();
            return false;
        }
        else if ($('#ConfirmPassword').val() == "") {
            alert('Please Enter Confirm Password!!');
            $('#NewPassword').focus();
            return false;
        }
        else if ($('#NewPassword').val().length < 8) {
            alert('Password must contain at least 8 character!');
           $('#NewPassword').focus();
            return false;
        }
        else  if (!$('#NewPassword').val().match(regularExpression))
              {
             alert('Password must contain at least one upparcase,lowercase,number and specialcharacter!!');
             $('#NewPassword').focus();
             return false;
        } 
        else if ($('#ConfirmPassword').val() != $('#NewPassword').val())
        {
            alert('Confirm Password Schould be same with New Password !!');
            $('#ConfirmPassword').focus();
            return false;
        }
        else {
            return true;
        }
    }
    function checkconfirm() {
        if (window.confirm("Are you sure to submit?")) {
            return true;
        }
        else {
            return false;
        }
    }
</script>
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    <div class="card m-auto w-25">
        <div class="card-body p-0">
            <div class="filter-wrapper mb-0">
                <div class="row mb-3">
                    <label for="lblOldPwd" class="col-lg-12 col-form-label" id="oldPwd">Old Password <b><span style="color:red">*</span></b></label>
                    <div class="col-lg-12">
                        @Html.EditorFor(model => model.Password, new { htmlAttributes = new { @class = "form-control", autocomplete = "off", maxlength = "20", placeholder = "Old Password", type = "password", @autofocus = "autofocus" } })
                    </div>

                </div>
                <div class="row mb-3">
                    <label for="lblPwd" class="col-lg-12 col-form-label" id="pwd">New Password <b><span style="color:red">*</span></b></label>
                    <div class="col-lg-12">
                        @Html.EditorFor(model => model.NewPassword, new { htmlAttributes = new { @class = "form-control", autocomplete = "off", maxlength = "20", placeholder = "New Password", type = "password" } })
                    </div>
                </div>
                <div class="row mb-3">
                    <label for="lblConPwd" class="col-lg-12 col-form-label" id="ConPwd">Confirm Password <b><span style="color:red">*</span></b></label>
                    <div class="col-lg-12">
                        @Html.EditorFor(model => model.ConfirmPassword, new { htmlAttributes = new { @class = "form-control", autocomplete = "off", maxlength = "20", placeholder = "Confirm Password", type = "password" } })
                    </div>
                    <div style="color:green">&nbsp;&nbsp;&nbsp;(New Password must contain at least 8 character,</div>
                    <div style="color:green">&nbsp;&nbsp;&nbsp;one upparcase,lowercase,number and specialcharacter.)</div>

                </div>
                <div class="form-group">
                    <div class="text-center">
                        <input type="button" value="Submit" class="btn btn-outline-success" id="btnSubmit" />
                        <input type="button" value="Reset" class="btn btn-outline-danger" id="btnReset" />
                    </div>
                </div>
            </div>
        </div>
    </div>
}
