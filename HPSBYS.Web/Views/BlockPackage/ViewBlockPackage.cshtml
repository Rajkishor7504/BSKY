@{

    ViewBag.Title = "ViewBlockPackage";

    Layout = "~/Views/Shared/_CommonLayout.cshtml";

}

<script src="~/js/PackageBlock.js"></script>

<style>

    .divdisable {
        pointer-events: none;
    }

    tr.row_selected td {
        background-color: #EFF9F6 !important;
    }



    .red-tooltip + .tooltip > .tooltip-inner {
        background-color: #f00;
    }
</style>



@*Code from Registration*@



<script type="text/javascript">

    //Added on 06-01-2023



@*$(document).keydown(function (event) {

    event = (event || window.event);

    if ((event.keyCode == 49) && (event.shiftKey === true)) {

        window.location.href = '@Url.Action("ViewBlockPackage", "BlockPackage")';

    }

    else if ((event.keyCode == 50) && (event.shiftKey === true)) {

        window.location.href = '@Url.Action("ViewMultipleBlockPackage", "BlockPackage")';

    }

    else if ((event.keyCode == 51) && (event.shiftKey === true)) {

        window.location.href = '@Url.Action("PreAuthorizationDetails", "PreAuthorization")';

    }

    else if ((event.keyCode == 52) && (event.shiftKey === true)) {

        window.location.href = '@Url.Action("ViewExtensionOfStay", "ExtensionOfStay")';

    }

   });*@



    $(document).ready(function () {

        //$("#loader").addClass("loaderactive");

        $('#tblImplantDtls').DataTable();



        var arrBlockPackage = [];



        function BlockAmtCalculate() {

            $('#tblPackageDtls tr:first td').each(function () {

                var $td = $(this);

                var colTotal = 0;

                $('#tblPackageDtls tr:not(:first,.totalColumn)').each(function () {

                    colTotal += parseInt($(this).children().eq($td.index()).html(), 10);

                });

                alert(colTotal);

                //$('#tblPackageDtls tr.totalColumn').children().eq($td.index()).html('Total: ' + colTotal);

            });

        }



        $('#btnpackagedtls').click(function () {

            //alert(1);

            //bindPackageDetils();

        });

    });



</script>

<!-- Dashboard Body content part starts -->

<div class="container">



    <input type="hidden" id="hdnPackages" name="packages" />

    <input type="hidden" id="hdnheadercode" name="hdnhedcode" />

    <input type="hidden" id="hdnscmCode" name="ScmCodeNm" />

    <input type="hidden" id="hdnCurrentPackheader" name="PckHeader" />

    <input type="hidden" id="PackageApproveRequired" name="AprvRequr" />

    <input type="hidden" id="hdnSubpackId" name="subid" />

    <input type="hidden" id="hdnPackDtlsId" name="dtlId" />

    <input type="hidden" id="hdnsubpackcode" name="subcode" />

    <input type="hidden" id="hdnProcCode" name="proccode" />

    <input type="hidden" id="hdnstaytype" name="staytype" />

    <input type="hidden" id="hdndaycare" name="daycare" />

    <input type="hidden" id="AuthenticationMode" />

    <input type="hidden" id="VerifyMemeberId" />

    <input type="hidden" id="VerifyMemeberName" />

    <input type="hidden" id="hdnIsWardEdit" />

    <input type="hidden" id="hdnWardUnit" />

    <input type="hidden" id="hdnIsImplReq" name="IsPackImplReq" />

    <input type="hidden" id="hdnPackCategoryType" name="packcategoryid" />

    <input type="hidden" id="hdnPrevPckgList" name="PrevBlockedPackageList" />



    <input type="hidden" id="hdnIsPackPriceEdit" name="IsPackagePriceEditable" />



    <div class="row">

        <div class="col-12 pb-3">

            <div class="card">

                <div class="card-body mb-0">

                    <div class="clearfix"></div>



                    <!-- Family Verification info -->

                    <div class="form-box-bg mb-4">
                        <ul class="nav nav-tabs custom-tab mb-4">

                            <li class="nav-item">

                                <a class="nav-link active" href="@Url.Action("ViewBlockPackage","BlockPackage")">Add</a>

                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="@Url.Action("ViewBlockPackageDetails","BlockPackage")">View</a>
                            </li>
                        </ul>

                        <div class="pkg_grey">

                            <div class="form-row align-items-center">

                                <div class="col-lg-8 col-md-12 col-sm-12 col-xs-12 form-row form-designsc" id="searchDiv">

                                    <label for="packageHeader" class="col-lg-2 col-md-3 col-sm-4 col-xs-12 col-form-label">NFSA/SFSS No.<b><span style="color:red">*</span></b></label>

                                    <div class="col-lg-5 col-md-6 col-sm-6 col-xs-12 input-group px-0">

                                        <div class="input-group-append formDirect">

                                            <select id="ddlSearchByFilter" class="form-control">

                                                @*<option value="0"> Select </option>*@

                                                <option value="1"> NFSA/SFSS </option>

                                                <option value="2"> AADHAAR </option>

                                            </select>

                                        </div>

                                        <input type="text" class="form-control" autofocus id="urnNo" autocomplete="off" placeholder="Enter here" maxlength="17" onkeypress="return inputLimiter(event,'Numbers')" />

                                    </div>

                                    <div class="col-lg-1 col-md-1 col-sm-1 col-xs-12 px-0">

                                        <input class="btn btn-outline-success my-2 my-sm-0" type="button" value="Search" id="btnSearch">

                                    </div>
                                </div>

                                <div class="col-lg-4 col-md-12 col-sm-12 col-xs-12 form-row">
                                    <div id="mouDiv">
                                        <div class="d-flex justify-content-end align-items-center">
                                            <p class="mou-txt" style="font-size:13px;"><span id="ExpiredStaatus"></span> Please Contact Administrator.</p>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="mb-4" id="DvPatientInfo">

                            <div class="row mb-1 heading-pkg border-bottom ">

                                <h5>Patient Info </h5>

                            </div>

                            <div class="row">

                                <div class="col-lg-3">

                                    <div class="mb-4">

                                        <label class="pkg-label font-weight-normal">NFSA/SFSS No. :</label>

                                        <div class="pkghead-txt" id="lblURNNo">

                                        </div>

                                    </div>

                                </div>

                                <div class="col-lg-3">

                                    <div class="mb-4">

                                        <label class="pkg-label font-weight-normal">Current Policy :</label>

                                        <div class="pkghead-txt" id="schNm"></div>

                                    </div>

                                </div>

                                <div class="col-lg-3">

                                    <div class="mb-4">

                                        <label class="pkg-label font-weight-normal">Current Policy Period : </label>

                                        <div class="pkghead-txt"><span id="spnPolFrmDate"></span> to <span id="spnPolToDate"></span></div>

                                    </div>

                                </div>

                            </div>

                            <div class="row">

                                <div class="col-lg-3">

                                    <div class="mb-4">

                                        <label class="pkg-label font-weight-normal">Claim Amount (<i class="fa fa-rupee"></i>) : </label>

                                        <div class="pkghead-txt" id="schClaimAmount"></div>

                                    </div>

                                </div>

                                <div class="col-lg-3">

                                    <div class="mb-4">

                                        <label class="pkg-label font-weight-normal">Currently Available Amount (<i class="fa fa-rupee"></i>) : </label>

                                        <div class="pkghead-txt">

                                            <span id="AvailB"></span>

                                        </div>

                                    </div>

                                </div>

                                <div class="col-lg-3">

                                    <div class="mb-4">

                                        <label class="pkg-label font-weight-normal">Female Fund (<i class="fa fa-rupee"></i>) : </label>

                                        <div class="pkghead-txt" id="schFemaleFund"></div>

                                    </div>

                                </div>

                                <div class="col-lg-3">

                                    <div class="mb-4">

                                        <label class="pkg-label font-weight-normal">Blocked Amount (<i class="fa fa-rupee"></i>) :</label>

                                        <div class="pkghead-txt" id="schBlockedAmount"></div>

                                    </div>

                                </div>

                            </div>

                            <div class="clearfix"></div>

                            <div class="col-md-12 col-sm-12 col-xs-12 px-0">

                                <div class="table-responsive">

                                    <table class="table table-striped jsgrid-table" id="tblFamilyDetails">

                                        <thead>

                                            <tr class="jsgrid-header-row">

                                                <th scope="col" class="jsgrid-header-cell" width="100">Sl No.</th>

                                                <th scope="col" class="jsgrid-header-cell">Name</th>

                                                <th scope="col" class="jsgrid-header-cell">Gender</th>

                                                <th scope="col" class="jsgrid-header-cell">Age</th>

                                                <th scope="col" class="jsgrid-header-cell">Aadhaar Card No</th>

                                                <th scope="col" class="jsgrid-header-cell">Select Patient</th>

                                            </tr>

                                        </thead>

                                        <tbody>
                                        </tbody>

                                    </table>

                                </div>

                            </div>

                        </div>



                        <!-- patient info -->

                        <div class="mb-4" id="PatientDetails">

                            <div class="row  mb-1 heading-pkg border-bottom">

                                <h5>Patient Details </h5>

                            </div>

                            <div class="row">

                                <div class="col-lg-2">

                                    <label class="pkg-label font-weight-normal">Name :</label>

                                    <div class="pkghead-txt">

                                        <span id="spnPatientName"></span>

                                    </div>

                                </div>

                                <div class="col-lg-2">

                                    <label class="pkg-label font-weight-normal">Member ID :</label>

                                    <div class="pkghead-txt">

                                        <span id="spnPatientMemberId"></span>

                                    </div>

                                </div>

                                @*<div class="col-lg-2">

                                        <label class="pkg-label font-weight-normal">Ration Card No. :</label>

                                        <div class="pkghead-txt">

                                            <span id="spnPatientRationId"></span>

                                        </div>

                                    </div>*@

                                <div class="col-lg-2">

                                    <label class="pkg-label font-weight-normal">Gender : </label>

                                    <div class="pkghead-txt">

                                        <span id="spnPatientGender"></span>

                                    </div>

                                </div>

                                <div class="col-lg-2">

                                    <label class="pkg-label font-weight-normal">Age :</label>

                                    <div class="pkghead-txt">

                                        <span id="spnPatientAge"></span>

                                    </div>

                                </div>

                                <div class="col-lg-2">

                                    <label class="pkg-label font-weight-normal">Aadhaar Card :</label>

                                    <div class="pkghead-txt">

                                        <span id="spnPatAadhar"></span>

                                        <span id="spnPatAdmissionStatus" hidden></span>

                                        <span id="spnPaturnno"></span>

                                        <input type="hidden" id="hdnParentpatientId" />

                                    </div>

                                </div>

                            </div>

                            <div class="customRadio mt-4" id="TreatmentType">

                                <div class="customRadio mt-2 mt-4">

                                    <div class="form-row">

                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 d-flex">

                                            <div class="chkbox-bg">

                                                <input type="radio" name="radio" value="N" id="Surgical" checked onclick="SetSurgical();">

                                                <label for="Surgical"> Medical/Surgical/Pre-Auth </label>

                                            </div>

                                            <div class="chkbox-bg">

                                                <input type="radio" name="radio" id="Emergency" value="Y" onclick="SetEmergency();">

                                                <label for="Emergency"> Emergency</label>

                                            </div>

                                        </div>

                                    </div>

                                </div>



                                <div class="mt-2" id="Verifieddetails">

                                    <div class="row  mb-4 heading-pkg border-bottom">

                                        <h5> Verified Details </h5>

                                    </div>

                                    <div id="verificationBlock">

                                        <div class="table-responsive">

                                            <table id="grdFamilyDetails" data-toggle="table" class="table table-striped" width="100%">
                                            </table>

                                        </div>

                                    </div>

                                </div>

                            </div>

                            <div class="form-row  mb-4 heading-pkg px-0" id="OverVerifieddetails">

                                <div class="col-md-2">

                                    <input type="text" id="txtOverrideCode" disabled="disabled" autocomplete="off" maxlength="7" class="form-control" />

                                </div>

                                <div class="col-md-2">

                                    <input class="btn btn-outline-success my-2 my-sm-0" type="button" onclick="OverrideRequest()" value="Generate Override Code" id="btnoverridegeneration" />

                                    <input type="hidden" id="txtExcptionType" />
                                    <input type="hidden" id="txtExcptionTypeid" />
                                    <input type="hidden" id="txttotalwardcost" />
                                    <input type="hidden" id="txtimplanttotalwardcost" />
                                    <input type="hidden" id="totalimplantcostid" />
                                    <input type="hidden" id="totalhighendcostid" />
                                    <input type="hidden" id="txthightotalwardcost" />
                                    <input type="hidden" id="txtimptotalwardcost" />

                                </div>

                                <div class="col-md-2">

                                    @*<input class="btn btn-outline-success my-2 my-sm-0" type="button" value="Verify Override Code" id="btnverifyoverride" />*@

                                </div>

                            </div>

                        </div>

                    </div>

                </div>

                <!-- patient info -->
                <!-- Package info -->

                <div class="form-box-bg mb-4" id="PackageDetails">

                    <div class="row  mb-1 heading-pkg border-bottom px-0">

                        <div class="col-md-3">

                            <h5>Package Details </h5>

                        </div>

                        <div class="col-md-9">

                            <div id="priviouspckgdetails" align="right">

                                <button type="button" id="btnPrevBooked" data-toggle="modal" @*data-target="#PrevPackageModal"*@ onclick="PrevPackageDetails();" class="btn btn-sm btn-success"> Click Here For Previous Packages &nbsp;<i class="fa fa-gift text-white"></i></button>

                            </div>



                            <div class="row">

                                <div class="col-md-2">

                                    <label> Hospital Type :</label>

                                </div>

                                <div class="col-md-2">

                                    <label id="lblHospitalType">'@Session["HospitalCategoryId"]'</label>

                                </div>

                                <div class="col-md-2">

                                    <label>Ward Editable :</label>

                                </div>

                                <div class="col-md-2">

                                    <label id="lblWardEdit"></label>

                                </div>

                                <div class="col-md-2">

                                    <label> Day Care :</label>

                                </div>

                                <div class="col-md-2">

                                    <label id="lblDaycare"></label>

                                </div>

                            </div>

                            <div class="row">

                                <div class="col-md-2">

                                    <label>  Price :</label>

                                </div>

                                <div class="col-md-2">

                                    <label id="lblPackPrice"></label>

                                </div>

                                <div class="col-md-2">

                                    <label>  Ward Cost :</label>

                                </div>

                                <div class="col-md-2">

                                    <label id="lblFormula"></label>

                                </div>

                                <div class="col-md-2">

                                    <label>Ward Max Unit :</label>

                                </div>

                                <div class="col-md-2">

                                    <label id="lblWardMaxUnit"></label>

                                </div>

                            </div>

                            <div class="row">

                                <div class="col-md-2">

                                    <label> Stay Type :</label>

                                </div>

                                <div class="col-md-2">

                                    <label id="lblStayType"></label>

                                </div>

                                <div class="col-md-2">

                                    <label>Max Days :</label>

                                </div>

                                <div class="col-md-2">

                                    <label id="lblMaximumDays"></label>

                                </div>

                                <div class="col-md-2">

                                    <label> Exception Type :</label>

                                </div>

                                <div class="col-md-2">

                                    <label id="lblExcptionType"></label>

                                </div>

                            </div>

                            <div class="row">

                                <div class="col-md-2">

                                    <label>Package Price Editable :</label>

                                </div>

                                <div class="col-md-2">

                                    <label id="lblIsPackPriceEdit"></label>

                                </div>

                            </div>

                        </div>

                    </div>



                    <div class="form-row mt-2">

                        <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12">

                            <div class="form-row form-designsc">

                                <div class="col-lg-11 col-md-9 col-sm-10 col-xs-10 pr-0 ">

                                    <div class="col-form-label d-flex">

                                        Package header <b><span style="color:red">*</span></b>

                                    </div>

                                    <div class="d-flex">

                                        <input type="text" id="txtpackageheader" readonly="readonly" class="form-control" />

                                    </div>

                                </div>

                                <div class="col-lg-1 col-md-3 col-sm-2 col-xs-12 view-bt px-0">

                                    <button type="button" class="btn btn-outline-success my-2 my-sm-0" data-toggle="modal" data-target="#popmodal"> <span class="fa fa-eye"></span> </button>

                                </div>

                            </div>

                            <!-- modal start -->

                            <div class="modal fade wow fadeInUp animated" id="popmodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">

                                <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">

                                    <div class="modal-content">

                                        <div class="modal-header">

                                            <div class="row heading-pkg">

                                                <h5 class="mb-0"> Package Header Information </h5>

                                            </div>

                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">

                                                <span aria-hidden="true">&times;</span>

                                            </button>

                                        </div>

                                        <div class="modal-body">





                                            <table id="tblpackageheader1" class="table table-striped" style="width:100%">

                                                <thead>

                                                    <tr>

                                                        <th>Sl No</th>

                                                        <th>Package Header Code</th>

                                                        <th>Package Header Name</th>

                                                        <th>Choose</th>

                                                    </tr>

                                                </thead>

                                                <tbody>
                                                </tbody>

                                            </table>

                                        </div>

                                    </div>

                                </div>

                            </div>

                            <!-- modal end -->



                        </div>



                        <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 ">

                            <div class="form-row form-designsc">

                                <div class="col-lg-11 col-md-9 col-sm-10 col-xs-10 pr-0">

                                    <div class="col-form-label d-flex">

                                        Package Details <b><span style="color:red"> *</span></b>

                                    </div>

                                    <input type="text" id="txtPackageDetails" readonly="readonly" class="form-control" />

                                </div>

                                <div class="col-lg-1 col-md-3 col-sm-2 col-xs-12 view-bt px-0">

                                    <button type="button" class="btn btn-outline-success my-2 my-sm-0" data-toggle="modal" data-target="#popmodalDtls" id="btnpackagedtls">

                                        <span class="fa fa-eye"></span>

                                    </button>

                                </div>



                            </div>



                            <!-- modal start -->

                            <div class="modal fade wow fadeInUp animated table-modalwidth" id="popmodalDtls" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">

                                <div class="modal-dialog modal-xl modal-dialog-scrollable" role="document">

                                    <div class="modal-content">

                                        <div class="modal-header">

                                            <div class="col-lg-10 px-0">

                                                <div class="form-row">

                                                    <div class="col-md-6">

                                                        <div class="heading-pkg px-0"><h5 class="mb-0"> Package Information </h5> </div>

                                                    </div>

                                                </div>

                                            </div>

                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">

                                                <span aria-hidden="true">&times;</span>

                                            </button>

                                        </div>

                                        <div class="modal-body">

                                            <div class="table-responsive">

                                                <table class="table" id="tblPackageDetails1">

                                                    <thead>

                                                        <tr>

                                                            <th>SL No </th>

                                                            <th>Package Name </th>

                                                            <th>Package ID</th>

                                                            <th>Sub Package </th>

                                                            <th>Package Details </th>

                                                            <th>Procedure Code </th>

                                                            <th>Amount </th>

                                                            <th>Days </th>

                                                            <th>Pre-Auth</th>

                                                            <th>Choose</th>

                                                        </tr>

                                                    </thead>

                                                    <tbody>
                                                    </tbody>

                                                </table>

                                            </div>

                                        </div>

                                    </div>

                                </div>

                            </div>

                            <!-- modal end -->



                        </div>

                        <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12">

                            <div class="form-row form-designsc">

                                <div class="col-lg-11 col-md-9 col-sm-10 col-xs-10 pr-0">

                                    <div class="col-form-label d-flex">Sub-Package <b><span style="color:red"> *</span></b></div>

                                    <div class="d-flex">

                                        <input type="text" id="txtSubPackage" readonly="readonly" class="form-control" />

                                    </div>

                                </div>

                            </div>

                        </div>



                        <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-designsc">

                            <div class="form-row">

                                <div class="col-md-12">

                                    <div class="col-form-label">Ward <b><span style="color:red">*</span></b></div>

                                    <div class="d-flex">

                                        <select id="ddlWard" class="form-control">
                                        </select>

                                    </div>

                                </div>

                            </div>

                        </div>

                        <!-- modal start -->

                        <div class="modal fade wow fadeInUp animated" id="viewimplant" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">

                            <div class="modal-dialog" role="document">

                                <div class="modal-content">

                                    <div class="modal-header">

                                        <div class="row heading-pkg">

                                            <h5 class="mb-0"> Implant Details </h5>

                                        </div>

                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">

                                            <span aria-hidden="true">&times;</span>

                                        </button>

                                    </div>

                                    <div class="modal-body">

                                        <div class="table-responsive">

                                            <table class="display" id="tblImplantDtls">

                                                <thead>

                                                    <tr>

                                                        <th>Implant Code </th>

                                                        <th>Implant Name </th>

                                                        <th>ProcCode </th>

                                                        <th>Max.Permissibility </th>

                                                        <th>Implant Amount </th>

                                                        <th>Multiple</th>

                                                        <th>Total Amount </th>

                                                    </tr>

                                                </thead>

                                                <tbody>
                                                </tbody>

                                            </table>

                                        </div>

                                    </div>

                                </div>

                            </div>

                        </div>

                        <!-- modal end -->

                        <div class="col-lg-12">

                            <div class="form-row">

                                <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">

                                    <div class="col-form-label"> Package Cost <b><span style="color:red">*</span></b></div>

                                    <input type="number" id="txtTreatCost" readonly="readonly" class="form-control">

                                </div>

                                <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">

                                    <div class="col-form-label"> Ward Cost <b><span style="color:red">*</span></b></div>

                                    <input type="number" id="txtwardcost" class="form-control" maxlength="8">

                                </div>

                                <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">

                                    <div class="col-form-label"> Treatment Days <b><span style="color:red">*</span></b></div>

                                    <input type="number" id="txtTreatDays" min="1" value="0" oninput="validity.valid||(value='');"
                                           class="form-control" />

                                </div>

                                <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">

                                    <div class="col-form-label"> Total Package Cost <b><span style="color:red">*</span></b></div>

                                    <input type="text" id="txtPackageCost" disabled="disabled" class="form-control">

                                </div>



                                <div class="col-lg-2 mt-3">

                                    <input class="btn btn-outline-success my-2 my-sm-0 w-100" type="button" value="Add Package" id="btnAddPackage" />

                                </div>

                            </div>

                        </div>

                    </div>

                    <div class="clearfix"></div>



                    <div id="PackageGridDetails">

                        @*<div class="mb-4 heading-pkg border-bottom mt-4 p-0">

                                <div class="row">

                                    <div class="col-md-8">

                                    </div>

                                    <div class="col-md-4" align="right">

                                        <button type="button" id="btnPrevBooked" data-toggle="modal" data-target="#PrevPackageModal" class="btn btn-sm btn-success"> Click Here For Previous Packages &nbsp;<i class="fa fa-gift text-white"></i></button>

                                    </div>

                                </div>

                            </div>*@



                        <table class="table table-striped jsgrid-table table-responsive mt-3 mb-3" id="tblPackageDtls">

                            <thead>

                                <tr class="jsgrid-header-row">

                                    @*<th scope="col" class="jsgrid-header-cell" width="100">Sl#</th>*@

                                    <th scope="col" class="jsgrid-header-cell">Package Header</th>

                                    <th scope="col" class="jsgrid-header-cell">Package Details</th>

                                    <th scope="col" class="jsgrid-header-cell">Procedure Code</th>

                                    <th scope="col" class="jsgrid-header-cell">Package Cost</th>

                                    <th scope="col" class="jsgrid-header-cell">Treatment Days</th>

                                    <th scope="col" class="jsgrid-header-cell">Ward Name</th>

                                    <th scope="col" class="jsgrid-header-cell">Ward Cost</th>

                                    <th scope="col" class="jsgrid-header-cell">Total Cost</th>

                                    <th scope="col" class="jsgrid-header-cell">Implant Cost</th>

                                    <th scope="col" class="jsgrid-header-cell">Highend Drugs Cost</th>

                                    <th scope="col" class="jsgrid-header-cell">Approval Required</th>

                                    <th scope="col" class="jsgrid-header-cell" width="28%">Action </th>

                                </tr>

                            </thead>

                            <tbody>
                            </tbody>

                            <tfoot>

                                <tr>

                                    <td colspan="3" style="color:#404040;">Total Amount to be blocked</td>

                                    <td id="sum" style="font-weight:bold; color:#404040;">&nbsp;</td>

                                    <td></td>

                                    <td></td>

                                    <td id="WardTotCost" style="font-weight:bold; color:#404040;">0.00</td>

                                    <td id="PackSubTotCost" style="font-weight:bold; color:#404040;">0.00</td>

                                    <td id="ImplAmt" style="font-weight:bold; color:#404040;">0.00</td>

                                    <td id="HighendAmt" style="font-weight:bold; color:#404040;">0.00</td>

                                    <td colspan="2"></td>

                                </tr>

                                <tr>

                                    <td colspan="10" style="color:#404040;">Total Cost (Total Package Cost +Implant Cost +Highend Drugs Cost)</td>

                                    <td colspan="2" id="TotalPackageCost" align="right" style="font-weight:bold; color:#404040;">0.00</td>

                                </tr>

                            </tfoot>

                        </table>



                        <div class="row">

                            <div class="col-md-12" style="text-align:right">

                            </div>

                        </div>

                    </div>



                    <div class="form-row">

                        <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">

                            <label class="col-form-label">Pre-Auth File<b><span id="preauthspanid" style="color:red">*</span></b> </label>

                            <div class="pkghead-txt">

                                <input type="file" class="form-control pr-5" id="txtuploadfile">

                                <span id="RemovePreauthDoc" onclick="RemovePreauthDoc(this)" class="btn btn-outline-danger btn-sm btn-crus"> <i class="fa fa-times"></i></span>

                            </div>

                            <div>

                                <small><span class="text-danger">File to be uploaded in  pdf , jpeg , jpg and size should not exceed 5 MB </span></small>

                            </div>

                        </div>



                        <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">

                            <label class="col-form-label">No. Of Days <b><span id="preauthspandays" style="color:red">*</span></b></label>

                            <div class="pkghead-txt">

                                <input id="txtpreauthNoofdays" autocomplete="off" class="form-control" maxlength="2" max="30" min="1" type="text" placeholder="Enter No Of Days" oninput="validity.valid||(value='');" onkeypress='return event.charCode >= 48 && event.charCode <= 57' />

                            </div>

                        </div>



                        <div class="col-lg-3">

                            <div class="row">

                                <div class="col-md-12">

                                    <div class="col-form-label">Referral Code </div>

                                    @*<input type="text" id="txtRefCode" maxlength="7" class="form-control">*@

                                    <input type="text" id="txtRefCode" maxlength="7" disabled="disabled" autocomplete="off" class="form-control" placeholder="Enter Referral Code" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />

                                </div>

                            </div>

                        </div>

                        <div class="col-lg-3">

                            <div class="addmore-sc">

                                <input class="btn btn-outline-success my-2 my-sm-0" type="button" onclick="Referalbtn()" value="Referral Code" id="btnreferralcode" />

                            </div>

                        </div>

                        <div class="col-lg-12">

                            <div class="form-row">

                                <div class="col-form-label">PreAuth Description <b><span id="preauthspandesc" style="color:red">*</span></b></div>

                                <textarea class="form-control form-group" id="txtDescription" maxlength="500" oninput="this.value = this.value.toUpperCase()" placeholder="Enter text Here....">

                                    </textarea>

                            </div>

                        </div>

                        <input type="hidden" id="cost" />

                    </div>

                </div>

                <!-- Package info -->
                <!-- html content staic design -->

                <div class="col-lg-12 col-mmd-12 col-sm-12 col-xs-12 p-0" hidden>

                    <div class="row  mb-3 heading-pkg border-bottom">

                        <h5>Patient Details </h5>

                    </div>

                    <div class="table-responsive border mb-3">

                        <table class="table table-striped">

                            <thead>

                                <tr>

                                    <th scope="col" class="bg-white" width="30" style="background-color:#fff;">Sl#</th>

                                    <th scope="col" class="bg-white" width="150" style="background-color:#fff;">Package Header</th>

                                    <th scope="col" class="bg-white" width="150" style="background-color:#fff;">Sub-Package</th>

                                    <th scope="col" class="bg-white" width="300" style="background-color:#fff;">Package Details</th>

                                    <th scope="col" class="bg-white text-align-right" width="150" style="background-color:#fff;">Treatment Cost</th>

                                    <th scope="col" class="bg-white text-align-center" width="150" style="background-color:#fff;">Approval Require</th>

                                    <th scope="col" class="bg-white text-align-right" width="400" style="background-color:#fff;">Action </th>

                                </tr>

                            </thead>

                            <tbody>

                                <tr>

                                    <td>1</td>

                                    <td>Burns Management</td>

                                    <td> Burns Management </td>

                                    <td>Total Body Surface Area Burns (TBSA) - any(not requiring admission). Needs at least 5-6 dressing</td>

                                    <td align="right">78,750</td>

                                    <td class="text-align-center">No</td>

                                    <td class="text-align-right">

                                        <button type="button" class="btn btn-outline-danger "><i class="fa fa-trash"></i></button>

                                        <button type="button" class="btn btn-outline-success " data-toggle="collapse" data-target="#demo1" class="accordion-toggle"><i class="fa fa-eye"></i> </button>

                                        <button type="button" class="btn btn-outline-success " data-toggle="modal" data-target="#Addimplantmodal"><i class="fa fa-plus"></i> Implant  </button>

                                        <button type="button" class="btn btn-outline-success " data-toggle="modal" data-target="#Endrugs"><i class="fa fa-plus"></i> HighEndDrugs </button>

                                    </td>

                                </tr>

                                <tr>

                                    <td colspan="10" class="m-0 p-0 border-0">

                                        <div class="accordian-body collapse" id="demo1">

                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 mt-3">

                                                <div class="headingpkg-bg"> Package Details </div>

                                                <div class="row d-flex align-items-center">

                                                    <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">

                                                        <div class="impl_head"> Implant Details </div>

                                                    </div>

                                                    <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">

                                                        <div class="row d-flex align-items-center">

                                                            <div class="col-lg-7 col-md-7 col-sm-12 col-xs-12">

                                                                <div class="impl_head"> HighEndDrugs Details | <span> HDU Implant </span> </div>

                                                            </div>

                                                            <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">

                                                                @*<select class="form-control">

                                                                        <option> Select Implant Name </option>

                                                                        <option> Burns Management</option>

                                                                        <option> Cardiology </option>

                                                                        <option> Burns Management </option>

                                                                    </select>*@

                                                            </div>

                                                        </div>

                                                    </div>

                                                </div>

                                                <div class="row">

                                                    <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 mt-3">

                                                        <div id="table-scroll" class="table-scroll table-responsive mb-3 newpkghd">

                                                            <table class="table table-striped">

                                                                <thead>

                                                                    <tr>

                                                                        <th scope="bg-white text-align-left" style="background-color:#fff !important;"> Implant Name</th>

                                                                        <th scope="bg-white text-align-center" style="background-color:#fff !important;"> Unit </th>

                                                                        <th scope="bg-white text-align-right" style="background-color:#fff !important;"> Price </th>

                                                                        <th scope="bg-white text-align-center" style="background-color:#fff !important;"> Action </th>

                                                                    </tr>

                                                                </thead>

                                                                <tbody>

                                                                    <tr class="active brd-left">

                                                                        <td class="brd-left">HDU</td>

                                                                        <td>4 </td>

                                                                        <td> 1,450</td>

                                                                        <td>

                                                                            <button type="button" class="btn btn-outline-danger " id="del"><i class="fa fa-trash"></i></button>

                                                                            <button type="button" class="btn btn-outline-success " data-toggle="modal" data-target="#Endrugs"><i class="fa fa-plus"></i> HighEndDrugs </button>



                                                                        </td>

                                                                    </tr>

                                                                    <tr>

                                                                        <td>HDU</td>

                                                                        <td>4 </td>

                                                                        <td> 1,450</td>

                                                                        <td>

                                                                            <button type="button" class="btn btn-outline-danger " id="del"><i class="fa fa-trash"></i></button>

                                                                            <button type="button" class="btn btn-outline-success " data-toggle="modal" data-target="#Endrugs"><i class="fa fa-plus"></i> HighEndDrugs </button>



                                                                        </td>

                                                                    </tr>

                                                                    <tr>

                                                                        <td>HDU</td>

                                                                        <td>4 </td>

                                                                        <td> 1,450</td>

                                                                        <td>

                                                                            <button type="button" class="btn btn-outline-danger " id="del"><i class="fa fa-trash"></i></button>

                                                                            <button type="button" class="btn btn-outline-success " data-toggle="modal" data-target="#Endrugs"><i class="fa fa-plus"></i> HighEndDrugs </button>



                                                                        </td>

                                                                    </tr>

                                                                    <tr>

                                                                        <td>HDU</td>

                                                                        <td>4 </td>

                                                                        <td> 1,450</td>

                                                                        <td>

                                                                            <button type="button" class="btn btn-outline-danger " id="del"><i class="fa fa-trash"></i></button>

                                                                            <button type="button" class="btn btn-outline-success " data-toggle="modal" data-target="#Endrugs"><i class="fa fa-plus"></i> HighEndDrugs </button>



                                                                        </td>

                                                                    </tr>

                                                                </tbody>

                                                                <tfoot>

                                                                    <tr>

                                                                        <td class="font-weight-5">Total </td>

                                                                        <td class="font-weight-5">  8 </td>

                                                                        <td colspan="2" class="font-weight-5"> 5,800  </td>

                                                                    </tr>

                                                                </tfoot>

                                                            </table>

                                                        </div>

                                                    </div>

                                                    <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12 mt-3">

                                                        <div id="table-scroll" class="table-scroll table-responsive mb-3">

                                                            <table id="main-table" class="main-table table table-striped">

                                                                <thead>

                                                                    <tr>

                                                                        <th scope=" bg-white  text-align-left" style="background-color:#fff !important;"> HighEndDrugs Name </th>

                                                                        <th scope=" bg-white text-align-center" style="background-color:#fff !important;"> Unit </th>

                                                                        <th scope=" bg-white text-align-right" style="background-color:#fff !important;"> Price </th>

                                                                        <th scope=" bg-white text-align-center" style="background-color:#fff !important;"> Action </th>

                                                                    </tr>

                                                                </thead>

                                                                <tbody>

                                                                    <tr>

                                                                        <td>Recombinant Tissue Plasminogen Activator</td>

                                                                        <td>4 </td>

                                                                        <td> 1,450</td>

                                                                        <td>

                                                                            <button type="button" class="btn btn-outline-danger " id="del"><i class="fa fa-trash"></i></button>



                                                                        </td>

                                                                    </tr>

                                                                    <tr>

                                                                        <td>Recombinant Tissue Plasminogen Activator</td>

                                                                        <td>3 </td>

                                                                        <td> 1,450</td>

                                                                        <td>

                                                                            <button type="button" class="btn btn-outline-danger " id="del"><i class="fa fa-trash"></i></button>



                                                                        </td>

                                                                    </tr>

                                                                    <tr>

                                                                        <td>Recombinant Tissue Plasminogen Activator</td>

                                                                        <td>7 </td>

                                                                        <td> 1,450</td>

                                                                        <td>

                                                                            <button type="button" class="btn btn-outline-danger " id="del"><i class="fa fa-trash"></i></button>



                                                                        </td>

                                                                    </tr>

                                                                    <tr>

                                                                        <td>Recombinant Tissue Plasminogen Activator</td>

                                                                        <td>7 </td>

                                                                        <td> 1,450</td>

                                                                        <td>

                                                                            <button type="button" class="btn btn-outline-danger " id="del"><i class="fa fa-trash"></i></button>



                                                                        </td>

                                                                    </tr>

                                                                </tbody>

                                                                <tfoot>

                                                                    <tr>

                                                                        <td colspan="1"> &nbsp; </td>

                                                                        <td class="font-weight-5">  8 </td>

                                                                        <td class="font-weight-5" colspan="2">15,800  </td>

                                                                    </tr>

                                                                </tfoot>

                                                            </table>

                                                        </div>

                                                    </div>

                                                </div>

                                            </div>

                                        </div>

                                    </td>

                                </tr>

                            </tbody>

                        </table>

                    </div>

                </div>

                <!-- html content staic design end -->

                <div class="clearfix"></div>

                <div class="form-box-bg mb-4" id="AdmissionDetails">

                    <div class="row  mb-1 heading-pkg border-bottom">

                        <h5> Admission Details </h5>

                    </div>

                    <div class="form-row">

                        <div class="col-lg-3">

                            <div class="form-row">

                                <div class="col-md-12">

                                    <div class="col-form-label">Actual Date of Admission <b><span style="color:red">*</span></b></div>

                                    <input type="text" id="dtActualAdmission" class="form-control form-group inputRequired bg-white" readonly autocomplete="off" />

                                </div>

                            </div>

                        </div>

                        <div class="col-lg-3">

                            <div class="row">

                                <div class="col-md-12">

                                    <div class="col-form-label">Doctor Name<b><span id="doctornameid" style="color:red">*</span></b>  </div>

                                    <input type="text" id="txtDoctorName" maxlength="50" autocomplete="off" onkeypress="return inputLimiter(event,'NameCharactersymbolDoctor')" oninput="this.value = this.value.toUpperCase()" class="form-control" placeholder="Enter Doctor Name">

                                </div>

                            </div>

                        </div>

                        <div class="col-lg-3">

                            <div class="form-row">

                                <div class="col-md-12">

                                    <div class="col-form-label">Doctor Phone No <b><span id="doctorphnoid" style="color:red">*</span></b>   </div>

                                    <input type="text" id="txtDrPhoneNo" maxlength="10" min="10" autocomplete="off" placeholder="Enter Doctor Phone No" class="form-control" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />

                                </div>

                            </div>

                        </div>

                        <div class="col-lg-3">

                            <div class="form-row">

                                <div class="col-md-12">

                                    <div class="col-form-label">Patient Phone No <b><span style="color:red">*</span></b></div>

                                    <input type="text" id="txtPatientNo" maxlength="10" min="10" class="form-control" autocomplete="off" placeholder="Enter Patient Phone No" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />



                                </div>

                            </div>

                        </div>

                        <div class="col-lg-3">

                            <div class="form-row">

                                <div class="custom-control custom-radio d-flex ml-2 mr-1">

                                    <input type="radio" class="custom-control-input patientotp" id="votp" name="ReferTo" value="Y">

                                    <label class="custom-control-label" for="votp" onclick="SendOTPWithPatient();">  Validate With OTP </label>

                                </div> @*data-toggle="modal" data-target="#WithOTP"*@

                            </div>

                        </div>

                        <div class="col-lg-3">

                            <div class="form-row">

                                <div class="custom-control custom-radio d-flex">

                                    <input type="radio" class="custom-control-input patientotp" id="vwotp" name="ReferTo" value="N" checked="">

                                    <label class="custom-control-label" for="vwotp"> Validate Without OTP </label>

                                </div>

                            </div>

                        </div>

                    </div>

                    <!--<div class="form-row">-->
                    @*<div class="col-lg-3">

                            <div class="form-row">

                                <div class="col-md-12">

                                    <div class="col-form-label">Override Code </div>

                                    <input type="text" id="txtOverrideCode" maxlength="7" class="form-control" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />

                                </div>

                            </div>

                        </div>*@

                    <!--<div class="col-lg-12">

                            <div class="form-row">

                                <div class="col-form-label"> Description <b><span style="color:red">*</span></b></div>

                                <textarea class="form-control form-group" id="txtDescription" maxlength="500" oninput="this.value = this.value.toUpperCase()" placeholder="Enter text Here....">

                                    </textarea>

                            </div>

                        </div>

                    </div>-->

                    <div class="clearfix"></div>

                    <div class="row  mb-1 heading-pkg border-bottom mt-4">

                        <h5> Vital Parameter </h5>

                    </div>

                    <div class="form-row mb-2">

                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">

                            <div class="form-row">

                                <div class="col-md-5">

                                    <div class="col-form-label">Parameter <b><span style="color:red"></span></b></div>

                                    <select class="form-control" id="dlVitalParam">
                                    </select>

                                </div>

                                <div class="col-md-5">

                                    <div class="col-form-label">Value <b><span style="color:red"></span></b></div>

                                    @*<input type="text" class="form-control" id="txtVtParamValue" autocomplete="off" maxlength="8"

                                        onkeypress="return inputLimiter(event,'NameCharactersAndNumbers')" />*@

                                    <input type="text" class="form-control" id="txtVtParamValue" autocomplete="off" maxlength="8"
                                           oninput="validity.valid||(value='');" onkeypress="return inputLimiter(event,'NameCharactersAndNumbers')" />



                                </div>

                                <div class="col-md-2 addmore-sc">

                                    <button class="btn btn-outline-success w-100 btn-sm px-7" id="addMoreVitalParam"> Add More<i class="fa fa-plus px-1"></i></button>

                                </div>

                                <div class="col-lg-5 col-md-5 col-sm-6 col-xs-12">

                                    <label for="packageHeader" class="col-form-label">Patient Photo </label>

                                    <div class="pkghead-txt">

                                        <input type="file" id="Photo" class="form-control" onchange="readURL(this);" accept="image/jpeg" />

                                        <span id="RemovePatientPic" onclick="RemovePatientPic(this)" class="btn btn-danger btn-sm btn-timesbg brd-color"> <i class="fa fa-times"></i></span>



                                        <div>

                                            <small>

                                                <span class="text-danger">Max file size is 1Mb,Only jpg/jpeg document allowed</span>

                                            </small>

                                        </div>

                                    </div>

                                </div>

                                <div class="col-lg-7 col-md-7 col-sm-7 col-xs-12">

                                    <div class="row">

                                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 mt-4">



                                            <img src="~/imgs/no_user.png" alt="" style="height:100px; border-radius:5px;" id="showPhoto" />



                                        </div>

                                    </div>

                                </div>

                            </div>

                        </div>

                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">

                            <div class="table-responsive mt-4">

                                <table class="table table-striped jsgrid-table" id="tblVitalParam">

                                    <thead>

                                        <tr class="jsgrid-header-row">

                                            <th scope="col" class="jsgrid-header-cell" width="100">SL No</th>

                                            <th scope="col" class="jsgrid-header-cell"> Parameter</th>

                                            <th scope="col" class="jsgrid-header-cell"> Value</th>

                                            <th scope="col" class="jsgrid-header-cell"> Action</th>

                                        </tr>

                                    </thead>

                                    <tbody>
                                    </tbody>

                                </table>

                            </div>

                        </div>

                    </div>

                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 px-0">

                        <div class="alert alert-warning p-2"><small>Please upload clearly visible patient colored photo. The photo should be taken in Hospital only, this photo will be verified during your Pre-Auth and claim Processing. Any other photo like Aadhaar card copy, Photo where face is not clearly visible or normal passport size photo is not acceptable. </small> </div>

                        <div id="divMobile" hidden="hidden"></div>

                    </div>

                    <div class="row">

                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

                            <div class="col-form-label">Blocking Remark <b><span style="color:red">*</span></b></div>

                            <textarea class="form-control" rows="4" placeholder="Enter Your Remarks..." id="txtBlockingremarks" oninput="this.value = this.value.toUpperCase()" maxlength="500"></textarea>

                        </div>

                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-left mb-4 mt-4">

                            <input class="btn btn-success my-2 my-sm-0" type="button" value="Block" id="btnBlocking" onclick="BlockPackageSava(this);">

                            <input class="btn btn-primary my-2 my-sm-0" type="reset" value="Clear" id="btnClear" onclick="ClearBlockPackages();">

                            <input class="btn btn-danger my-2 my-sm-0" type="button" value="Close" id="btnClose" onclick="CloseBlockPackages();">

                        </div>

                    </div>

                </div>

            </div>

            <div class="clearfix"></div>

        </div>

    </div>

</div>
    </div>
</div>

<!--OTP Modal -->

<div class="modal fade" id="OTPModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static">

    <div class="modal-dialog modal-sm otpmodal" role="document">

        <div class="modal-content">

            <div class="modal-header">

                <h5 class="modal-title" id="exampleModalLabel"> Aadhaar OTP Verification </h5>

            </div>

            <div class="modal-body">

                <div class="row">

                    <div class="col-lg-12" align="center">

                        <div class="mb-4">

                            <div class="row">

                                <div class="col-md-12">

                                    <div class="col-form-label  mb-1"> OTP <b><span style="color:red">*</span></b></div>

                                    <input type="text" class="form-control mb-2" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" maxlength="7" autocomplete="off" id="txtopt" placeholder="Enter OTP">

                                    <input type="hidden" mb-3" id="Uid" />

                                    <input type="hidden" mb-3" id="txn" />

                                    <input type="hidden" mb-3" id="OTPVerifyMemberID" />

                                    <input type="hidden" mb-3" id="OTPurn" />

                                    <input type="hidden" mb-3" id="SelectedPatientId" />

                                    <label class="mb-2 text-left">Time Remaining <span id="timer-countdown"></span></label>



                                    <div>

                                        <input type="button" class="btn btn-outline-success" value="Verify" onclick="VerifyOTP();">

                                        <input type="button" class="btn btn-outline-danger" value="Cancel" data-dismiss="modal" aria-label="Close">

                                    </div>

                                </div>



                            </div>

                        </div>



                    </div>



                </div>



                <div class="clearfix"></div>



            </div>

        </div>

    </div>

</div>



<!--IRIS Modal -->

<div class="modal fade" id="IrisModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">

    <div class="modal-dialog modal-lg" role="document">

        <div class="modal-content">



            <div class="modal-header">

                <h5 class="modal-title" id="exampleModalLabel">Authenticate</h5>

                <button type="button" class="close" data-dismiss="modal" aria-label="Close">

                    <span aria-hidden="true">×</span>

                </button>

            </div>

            <div class="modal-body">

                <div class="row justify-content-center  customRadio">

                    <div class="col-md-3">

                        <div class="chkbox-bg">

                            <input type="radio" name="textEditor" id="rdProduction" checked="checked" value="P">

                            <label for="rdProduction"> Production </label>

                        </div>

                    </div>

                    <div class="col-md-3">

                        <div class="chkbox-bg">

                            <input type="radio" name="textEditor" id="rdStaging" value="S" disabled>

                            <label for="rdStaging"> Staging Server </label>

                        </div>

                    </div>

                </div>

                <div class="form-row">

                    <div class="col-lg-12">

                        <div class="mb-3">

                            <div class="form-row mb-2">

                                <div class="col-md-3">

                                    <input type="hidden" id="getrdresponse" />

                                    <div class="col-form-label">RD Service Status <b><span style="color:red">*</span></b></div>

                                    <input type="text" class="form-control" id="rdStatus" readonly>

                                </div>

                                <div class="col-md-3">

                                    <div class="col-form-label">Device Info Path <b><span style="color:red">*</span></b></div>

                                    <input type="text" class="form-control" id="rdinfo" readonly>

                                </div>

                                <div class="col-md-3">

                                    <div class="col-form-label"> Capture Path <b><span style="color:red">*</span></b></div>

                                    <input type="text" class="form-control" readonly>

                                </div>

                                <div class="col-md-3">

                                    <div class="col-form-label">RD Service Info <b><span style="color:red">*</span></b></div>

                                    <input type="text" class="form-control" readonly>

                                </div>



                            </div>

                        </div>

                    </div>

                </div>

                <div class="row  mb-3 heading-pkg border-bottom">

                    <h5> Capture Pid Data </h5>

                </div>



                <div class="form-row mb-3">



                    <div class="col-md-3">

                        <div class="col-form-label">Error Code <b><span style="color:red">*</span></b></div>

                        <input type="text" class="form-control" id="errCode" readonly>

                    </div>





                    <div class="col-md-3">

                        <div class="col-form-label">Quality Service <b><span style="color:red">*</span></b></div>

                        <input type="text" class="form-control" readonly>

                    </div>



                    <div class="col-md-3">

                        <div class="col-form-label"> Error Info <b><span style="color:red">*</span></b></div>

                        <input type="text" class="form-control" id="errInfo" readonly>

                    </div>



                    <div class="col-md-3">

                        <div class="col-form-label"> dpid <b><span style="color:red">*</span></b></div>

                        <input type="text" class="form-control" id="dpid" readonly>

                    </div>





                    <div class="col-md-3">

                        <div class="col-form-label"> Red/Id <b><span style="color:red">*</span></b></div>

                        <input type="text" class="form-control" readonly>

                    </div>





                    <div class="col-md-3">

                        <div class="col-form-label"> Red/info <b><span style="color:red">*</span></b></div>

                        <input type="text" class="form-control" readonly>

                    </div>





                    <div class="col-md-3">

                        <div class="col-form-label"> do <b><span style="color:red">*</span></b></div>

                        <input type="text" class="form-control" readonly>

                    </div>





                    <div class="col-md-3">

                        <div class="col-form-label"> mi <b><span style="color:red">*</span></b></div>

                        <input type="text" class="form-control" id="mi" readonly>

                    </div>





                    <div class="col-md-12">

                        <div class="col-form-label"> mc <b><span style="color:red">*</span></b></div>

                        <input type="text" class="form-control" id="mc" readonly>

                    </div>

                </div>

                <div class="mb-3">

                    <div class="row  mb-3 heading-pkg border-bottom">

                        <h5> Auth Request </h5>

                    </div>

                    <div class="form-row mb-2">

                        <div class="col-md-3">

                            <div class="col-form-label">Aadhar UID <b><span style="color:red">*</span></b></div>

                        </div>

                        <div class="col-md-3">

                            <input type="text" id="AadharUidMask" class="form-control" readonly>

                            <input type="hidden" id="AadharUid" class="form-control" readonly>

                        </div>

                        <div class="col-md-3">

                            <div class="col-form-label"> Response Result <b><span style="color:red">*</span></b></div>

                        </div>

                        <div class="col-md-3">

                            <input type="text" class="form-control" readonly>

                        </div>

                    </div>

                    <div class="form-row mb-2">

                        <div class="col-md-3">

                            <div class="col-form-label"> Error code <b><span style="color:red">*</span></b></div>

                        </div>

                        <div class="col-md-3">

                            <input type="number" class="form-control" readonly>

                        </div>

                        <div class="col-md-3">

                            <div class="col-form-label"> Error Info <b><span style="color:red">*</span></b></div>

                        </div>

                        <div class="col-md-3">

                            <input type="text" class="form-control" readonly>

                        </div>

                    </div>



                    <input type="hidden" id="rdInfo" />

                    <input type="hidden" id="rdData" />

                    <input type="hidden" id="MemberId">

                    <input type="hidden" id="Urn">

                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 px-0" align="left">

                        <input type="button" class="btn btn-outline-success mb-2" value="Captured" id="btnCapture" onclick="Capture();">

                        <input type="button" class="btn btn-outline-success mb-2" value="Authentication" id="btnAuthentication">

                    </div>

                </div>

            </div>

        </div>

        <div class="clearfix"></div>

    </div>

</div>

@*<div class="loader" id="divLoader" style="display:none">

        <div class="center">

            <img src="~/imgs/DataLoading.gif" alt="Loader..." />

        </div>

    </div>*@



<div id="myModal" class="modal fade" role="dialog">

    <div class="modal-dialog">

        <!-- Modal content-->

        <div class="modal-content">

            <div class="modal-header">

                <button type="button" class="close" data-dismiss="modal">&times;</button>

                <h4 class="modal-title">Modal Header</h4>

            </div>

            <div class="modal-body">

                <p>Some text in the modal.</p>

            </div>

            <div class="modal-footer">

                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

            </div>

        </div>

    </div>

</div>



<div id="PrevPackageModal" class="modal fade table-modalwidth" role="dialog">

    <div class="modal-dialog">

        <!-- Modal content-->

        <div class="modal-content">



            <div class="modal-header">

                <div class="heading-pkg px-0"><h5 class="mb-0"> Previous Package Details </h5> </div>



                <button type="button" class="close" data-dismiss="modal">&times;</button>



                @*<h4 class="modal-title">Modal Header</h4>*@

            </div>



            <div class="modal-body">



                <table class="table table-striped jsgrid-table " id="tblPrevPackageDtls">
                </table>

            </div>

        </div>

    </div>

</div>





<div class="modal" id="Addimplantmodal" tabindex="-1" role="dialog" aria-labelledby="Addimplantmodal" aria-hidden="true">

    <div class="modal-dialog modal-xl" role="document">

        <div class="modal-content">

            <!-- Modal Header -->

            <div class="modal-header">

                <div class="row w-100">

                    <div class="col-lg-7 col-md-7 col-sm-7 col-xs-12">

                        <h4 class="modal-title text-success"> Add Implant Details </h4>

                    </div>

                    <p>

                        <label id="lblParentTableId" style="color:rebeccapurple; display:none"></label>

                    </p>

                    @*<div class="col-lg-5 col-md-5 col-sm-5 col-xs-12">

                            <select class="form-control">

                                <option> Select Implant Name </option>

                                <option> Burns Management</option>

                                <option> Cardiology </option>

                                <option> Burns Management </option>

                            </select>

                        </div>*@

                </div>

                <button type="button" class="close" data-dismiss="modal">&times;</button>

            </div>

            <!-- Modal body -->

            <div class="modal-body">

                <div class="table-responsive mb-3">

                    <div id="table-scroll" class="table-scroll table-responsive">

                        <table class="table table-striped" id="tblImplantList">

                            <thead>

                                <tr>

                                    <th scope="col" class="bg-white" style="width:8% !important;">Select</th>

                                    <th scope="col" class="bg-white" style="width:30% !important;"> Implant Name </th>

                                    <th scope="col" class="bg-white text-align-right" style="width:14% !important;"> Unit/Cycle Price </th>

                                    <th scope="col" class="bg-white" style="width:10% !important;">Max Unit </th>

                                    <th scope="col" class="bg-white text-align-center" style="width:10% !important;"> Unit </th>

                                    <th scope="col" class="bg-white text-align-right" style="width:15% !important;"> Total Price </th>

                                    <th scope="col" class="bg-white text-align-right" style="width:10% !important;">Pre-Auth </th>

                                </tr>

                            </thead>

                            <tbody>
                            </tbody>

                            <tfoot>

                                <tr>

                                    <td> &nbsp; </td>

                                    <td class="font-weight-5"> Total </td>

                                    <td class="font-weight-5" align="right">
                                    </td>

                                    <td class="font-weight-5" align="center">

                                        <label id="lblTotImplant"></label>

                                    </td>

                                    <td></td>

                                    <td class="font-weight-5" colspan="1" align="right">  <label id="lblImpSubTotal" class="label-success">0.00</label>  </td>

                                    <td></td>

                                </tr>

                            </tfoot>

                        </table>

                    </div>

                </div>

                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-0" align="right">

                    <button type="button" id="btnSubmitImplant" class="btn btn-success"> Add Implant</button>

                </div>

            </div>

        </div>

        <!-- Modal footer -->

        <div class="clearfix"></div>

    </div>

</div>



<!-- The Modal HighEndrugs -->

<div class="modal" id="Endrugs" tabindex="-1" role="dialog" aria-labelledby="Endrugs" aria-hidden="true">

    <div class="modal-dialog modal-xl" role="document">

        <div class="modal-content">

            <!-- Modal Header -->

            <div class="modal-header">

                <div class="row w-100">

                    <div class="col-lg-7 col-md-7 col-sm-7 col-xs-12">

                        <div class="impl_head"> HighEndDrugs</div>

                    </div>

                    <p>

                        <label id="lblHedTabCount" style="display:none"></label>

                    </p>

                    <div class="col-lg-5 col-md-5 col-sm-5 col-xs-12">

                        @*<select class="form-control">

                                <option> Select Implant Name </option>

                                <option> Burns Management</option>

                                <option> Cardiology </option>

                                <option> Burns Management </option>

                            </select>*@

                    </div>

                </div>

                <button type="button" class="close" data-dismiss="modal">&times;</button>

            </div>

            <!-- Modal body -->

            <div class="modal-body">

                <div class="table-responsive mb-3 table-modalwidth">

                    <div id="table-scroll" class="table-scroll table-responsive">

                        <table class="table table-striped" id="tblHgDruglist">

                            <thead>

                                <tr>

                                    <th scope="col" class="bg-white" width="50">Select</th>

                                    <th scope="col" class="bg-white" width="100"> HighEndDrugs Name </th>

                                    <th scope="col" class="bg-white" width="100">Pre-Auth Required </th>

                                    <th scope="col" class="bg-white text-align-right" width="100"> Unit/Cycle Price </th>

                                    <th scope="col" class="bg-white text-align-center" width="50"> Unit </th>

                                    <th scope="col" class="bg-white text-align-right" width="100"> Total Price </th>

                                </tr>

                            </thead>

                            <tbody>

                                @*<tr>

                                        <td>

                                            <div class="custom-control custom-checkbox">

                                                <input type="checkbox" class="custom-control-input" id="customCheckim1">

                                                <label class="custom-control-label" for="customCheckim1"></label>

                                            </div>

                                        </td>

                                        <td>HDU</td>

                                        <td class="text-align-right">7,089</td>

                                        <td class="text-align-center"><input type="text" class="form-control" id="num"></td>

                                        <td class="text-align-right">

                                            7,089

                                        </td>

                                    </tr>*@



                            </tbody>



                            <tfoot>

                                <tr>

                                    <td class="font-weight-5"> Total </td>

                                    <td class="font-weight-5" align="right"></td>

                                    <td class="font-weight-5" align="center"></td>

                                    <td></td>

                                    <td></td>

                                    <td class="font-weight-5" colspan="1" align="right">

                                        <label id="lblHedSubTotal" class="label-success"></label>

                                    </td>



                                </tr>

                            </tfoot>

                        </table>

                    </div>

                </div>

                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-0" align="right">

                    <button type="button" id="btnHedSubmit" class="btn btn-success"> Add HED</button>

                </div>

            </div>

        </div>

        <!-- Modal footer -->

        <div class="clearfix"></div>

    </div>

</div>

<!-- The Modal -->
<!-- OverRide Request Modal -->

<div id="MyPopupBlock" class="modal fade" role="dialog">

    <div class="modal-dialog modal-lg">

        <!-- Modal content-->

        <div class="modal-content">

            <form id="OverrideRequestForm">

                <div class="modal-header">

                    <div class="row">

                        <div class="col-lg-12">

                            <h4 class="modal-title"> Override Request </h4>

                        </div>

                    </div>

                    <button type="button" class="close" data-dismiss="modal"> &times; </button>

                </div>

                <div class="modal-body">

                    <div class="row">

                        <div class="col-md-4 mb-2">

                            <label class="pkg-label font-weight-normal">Member Id :</label>

                            <div class="pkghead-txt" id="lblPatientMemberId"></div>

                        </div>

                        <div class="col-md-4 mb-2">

                            <label class="pkg-label font-weight-normal"> Name :</label>

                            <div class="pkghead-txt" id="lblPatientName"></div>

                        </div>

                        <div class="col-md-4 mb-2">

                            <label class="pkg-label font-weight-normal"> Gender :</label>

                            <div class="pkghead-txt" id="lblPatientGender"></div>

                        </div>

                        <div class="col-md-4 mb-2">

                            <label class="pkg-label font-weight-normal"> Age :</label>

                            <div class="pkghead-txt" id="lblPatientAge"></div>

                        </div>

                        <div class="col-md-4 mb-2">

                            <label class="pkg-label font-weight-normal"> Aadhaar No. :</label>

                            <div class="pkghead-txt" id="lblPatientAadharNo"></div>

                        </div>

                        <div class="col-md-4 mb-2">

                            <label class="pkg-label font-weight-normal"> URN. :</label>

                            <div class="pkghead-txt" id="lblPatientUrnNo"></div>

                        </div>

                        <div class="col-md-4 mb-2">

                            <label class="pkg-label font-weight-normal">Purpose of Override Code :</label>

                            <label>

                                <input type="checkbox" class="packagedetails" id="chkboxblock" value="0301,0302" />

                                Block Package

                            </label>

                            <label>

                                <input type="checkbox" class="packagedetails" oninput="this.value = this.value.toUpperCase()" id="chkboxunblock" value="0301,0302" />

                                Unblock Package

                            </label>

                        </div>

                        <div class="col-md-8">

                            <label class="pkg-label font-weight-normal"> No. Of Days <b><span style="color:red">*</span></b></label>

                            <div class="pkghead-txt">

                                <input id="txtNoofdays" maxlength="2" min="1" max="30" type="number" autocomplete="off" oninput="validity.valid||(value='');" onkeypress='return event.charCode >= 48 && event.charCode <= 57' />

                            </div>

                        </div>



                        <div class="col-md-4">

                            <label class="pkg-label font-weight-normal"> Upload File </label>

                            <div class="pkghead-txt">

                                <input type="file" class="form-control pr-5" id="uploadfile">

                                <span id="RemoveoverrideDoc" onclick="RemoveoverrideDoc(this)" class="btn btn-outline-danger btn-sm btn-crus"> <i class="fa fa-times"></i></span>



                            </div>

                            <div>

                                <small><span style="color:red">File to be uploaded in  pdf , jpeg , jpg and size should not exceed 5 MB </span></small>

                            </div>

                        </div>





                        <div class="col-md-8">

                            <label class="pkg-label font-weight-normal"> Description<b><span style="color:red">*</span></b></label>

                            <div class="pkghead-txt">

                                <textarea id="txtDescription12" class="form-control" oninput="this.value = this.value.toUpperCase()" placeholder="Description" style="width:100%"></textarea>

                            </div>

                        </div>

                    </div>

                </div>

                <div class="modal-footer">

                    <div class="row">

                        <div class="col-md-12">

                            <button type="button" id="btnSubmit" class="btn btn-sm btn-success" onclick="submitOverrideRequestForm()"> Submit </button>

                            <button type="button" class="btn btn-sm btn-danger" data-dismiss="modal"> Close </button>

                        </div>

                    </div>

                </div>

            </form>

        </div>

    </div>

</div>

<!-- OverRide Request Modal END -->
<!--With OTP Modal -->

<div class="modal fade" id="WithOTP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static">

    <div class="modal-dialog modal-sm otpmodal" role="document">

        <div class="modal-content">

            <div class="modal-header">

                <h5 class="modal-title" id="exampleModalLabel"> Patient OTP Verification </h5>

            </div>

            <div class="modal-body">

                <div class="row">

                    <div class="col-lg-12" align="center">

                        <div class="mb-4">

                            <div class="row">

                                <div class="col-md-12">

                                    <div class="col-form-label  mb-1"> OTP <b><span style="color:red">*</span></b></div>

                                    <input type="text" class="form-control mb-2" maxlength="6" autocomplete="off" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" id="txtpatiantopt" placeholder="Enter OTP">

                                    <input type="hidden" mb-3" id="Uid" />

                                    <input type="hidden" mb-3" id="txn" />

                                    <input type="hidden" mb-3" id="OTPVerifyMemberID" />

                                    <input type="hidden" mb-3" id="OTPurn" />

                                    <input type="hidden" mb-3" id="SelectedPatientId" />

                                    @*<label class="mb-2 text-left">Time Remaining <span id="timer-countdown"></span></label>*@



                                    <div>

                                        <input type="button" class="btn btn-outline-success" value="Verify" onclick="PatientVerifyOTP();">

                                        <input type="button" class="btn btn-outline-danger" id="btnpatientcancel" value="Cancel" data-dismiss="modal" aria-label="Close">

                                    </div>

                                </div>



                            </div>

                        </div>



                    </div>



                </div>



                <div class="clearfix"></div>



            </div>

        </div>

    </div>

</div>

<!--With OTP Modal -->



<script>

    $(document).on('click', '#btnerror', function (e) {

        swal({

            title: "Oops!",

            text: " Something Went Wrong",

            type: "error",

            confirmButtonColor: "#36A865",

            confirmButtonText: "OK"

        });

    });

</script>





<script>

    $('#btninfo').click(function () {

        swal({

            title: 'Are you sure to Add?',

            type: 'warning',

            showCancelButton: true,

            confirmButtonColor: '#36A865',

            cancelButtonColor: '#d33',

            confirmButtonText: 'Yes, Add it!'



        }).then(function () {

            swal(

                'Added',

                'Added Succesfully.',

                'success'

            );

        });

    });

</script>





<script type="text/javascript">

    var userImg = '@Url.Content("~/imgs/no_user.png")';

    var vitaldata = [];

    var Pacakagedata = [];

    var arrRegData = [];

    var implantdata = [];

    var highenddrugs = [];

    var SchemeParams = {

        Schemecode: '0'

    };

    var AddPackageHtml = "";

    var count = 0;

    var url;

    var currrentElement;



    $(function () {

        $('.secondary-menu li a').tooltip();

    });



    $(document).ready(function () {



        $("#txtwardcost").attr('disabled', 'disabled');

        $("#txtTreatDays").attr('disabled', 'disabled');

        $("#txtRefCode").attr('disabled', 'disabled');

        $("#txtOverrideCode").attr('disabled', 'disabled');

        loadNavigation('ViewBlockPackageDetails', 'Mlblockpackage', 'pl', 'Block Package', 'Add BlockPackage Details', '');



        $('#path').html('Block Package List');

        $("#btnCapture").hide();

        $("#btnPrevBooked").attr('style', 'display:none');

        $('#RemovePreauthDoc').hide();

        $('#RemoveoverrideDoc').hide();



        var dateNow = new Date();

        //$("#dtActualAdmission").datepicker({

        //    dateFormat: 'dd-M-y'

        //});

        $("#dtActualAdmission").datepicker({
            numberOfMonths: 1,
            changeMonth: true,
            dateFormat: "dd-M-y",
            changeYear: true,
            minDate: "@Session["backdate_admission"]",
            maxDate: 0
        });


        var d = new Date();

        $(".dateFormat").val(moment(new Date(d.getFullYear(), d.getMonth(), d.getDate())).format("DD-MMM-YY"));



        $('#DvPatientInfo').hide();
        $('#PatientDetails').hide();
        $('#AdmissionDetails').hide();
        $('#Verifieddetails').hide();
        $('#PackageDetails').hide();// 01032023
        $('#PackageGridDetails').hide();// 01032023
        $('#AdmissionDetails').hide();
        $('#Verifieddetails').hide();
        $('#TreatmentType').hide();
        bindPackageHeaderDetils();
        BindPackageHeader();
        BindVitalParam();
        $("#preauthspanid").hide();

        $("#preauthspandays").hide();

        $("#preauthspandesc").hide();

        $("#doctornameid").hide();

        $("#doctorphnoid").hide();

        $('#RemovePatientPic').hide();
    if ('@Session["moustatus"]' == 'true' || '@Session["empanelmentstatus_flag"]' == '1' || '@Session["is_block_active"]' == '1') {
            $('#searchDiv').addClass('divdisable');
            $('#urnNo').attr('disabled', true);
            $('#mouDiv').show();
            if ('@Session["moustatus"]' == 'true' && '@Session["empanelmentstatus_flag"]' == '1' && '@Session["is_block_active"]' == '1') {
                $('#ExpiredStaatus').text("Hospiatl Inactive/MOU/Empanelment Expired,");
            }
            else if ('@Session["moustatus"]' == 'false' &&'@Session["empanelmentstatus_flag"]' == '1' && '@Session["is_block_active"]' == '1') {
                $('#ExpiredStaatus').text("Hospiatl Inactive/Empanelment Expired,");
            }
            else if ('@Session["moustatus"]' == 'true' && '@Session["empanelmentstatus_flag"]' == '1' && '@Session["is_block_active"]' == '0') {
                $('#ExpiredStaatus').text("MOU/Empanelment Expired,");
            }
            else if ('@Session["is_block_active"]' == '1' && '@Session["moustatus"]' == 'true' && '@Session["empanelmentstatus_flag"]' == '0') {
                $('#ExpiredStaatus').text("Hospiatl Inactive/MOU Expired,");
            }
            else if ('@Session["moustatus"]' == 'true' && '@Session["empanelmentstatus_flag"]' == '0' && '@Session["is_block_active"]' == '0') {
                $('#ExpiredStaatus').text("MOU Expired,");
            }
            else if ('@Session["moustatus"]' == 'false' && '@Session["empanelmentstatus_flag"]' == '1' && '@Session["is_block_active"]' == '0') {
                $('#ExpiredStaatus').text("Empanelment Expired,");
            }
            else if ('@Session["moustatus"]' == 'false' &&  '@Session["empanelmentstatus_flag"]' == '0' && '@Session["is_block_active"]' == '1') {
                $('#ExpiredStaatus').text("Hospiatl Inactived,");
            }
        }
        else {
            $('#searchDiv').removeClass('divdisable');
            $('#urnNo').attr('disabled', false);
            $('#mouDiv').hide();
        }
        //CheckMOUStatus('@Session["HospitalCode"]')
    });



    document.onkeydown = function (e) {

        if (event.keyCode == 123) {

            return false;

        }

        if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) {

            return false;

        }

        if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) {

            return false;

        }

        if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) {

            return false;

        }

    }



    function sweetAlert(stitle, sdata, sparam) {

        swal({

            title: stitle,

            html: "<div class='row'> <div class='mb-1 col-md-12 text-center'>" + sdata + "</div> </div>",

            confirmButtonColor: "#36A865",

            confirmButtonText: "OK"

        }).then(function (isConfirm) {

            if (sparam != null) {

                if (sparam == 'pageReload') {

                    window.location.reload();

                }

                else {

                    setUserSession(sparam);

                }

            }

        });

    }



    function inputLimiter(e, allow) {

        var AllowableCharacters = '';

        if (allow == 'NameCharactersymbolDoctor') {

            AllowableCharacters = ' ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz.';

        }

        if (allow == 'NameCharactersymbol') {

            AllowableCharacters = ' ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz./&';

        }

        if (allow == 'NameCharacters') {

            AllowableCharacters = ' ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-.\'';

        }

        if (allow == 'NameCharactersAndNumbers') {

            AllowableCharacters = '1234567890 ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-,/.\'';

        }

        if (allow == 'Description') {

            AllowableCharacters = '1234567890 ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-,./\&(){}[]#$:';

        }

        if (allow == 'Numbers') {

            AllowableCharacters = '1234567890';

        }

        if (allow == 'Decimal') {

            AllowableCharacters = '1234567890.';

        }

        var k;

        k = document.all ? parseInt(e.keyCode) : parseInt(e.which);

        if (k != 13 && k != 8 && k != 0) {

            if ((e.ctrlKey == false) && (e.altKey == false)) {

                return (AllowableCharacters.indexOf(String.fromCharCode(k)) != -1);

            }

            else {

                return true;

            }

        }

        else {

            return true;

        }

    }



    // Search Urn

    $('#btnSearch').click(function () {

        if (validate()) {

            $('#btnAuth').hide();

            $('#TreatmentType').show();

            $('#DvPatientInfo').show();

            $('#PatientDetails').hide();

            GetSchemeList();

            $('#verificationBlock').removeClass('divdisable')

            $('#TreatmentType').removeClass('divdisable');

            $('#tblFamilyDetails').removeClass('divdisable')

            $('#tblPackageDtls tbody').empty();

            $('#tblVitalParam tbody').empty();

            clearallTotalAmout();

        }

    });



    function validate() {

        if ($("#ddlSearchByFilter option:selected").val() == 0) {

            swal({

                text: "Please choose Aadhaar or NFSA/SFSS",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#ddlSearchByFilter").focus();

            });

            return false;

        }

        else if ($('#urnNo').val() == '') {

            swal({

                text: "Please enter NFSA/SFSS No.",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#urnNo").focus();

            });

            return false;

        }

        else {

            return true;

        }

    }



    function GetSchemeList() {

        $.ajax({

            url: ServiceURL + "/api/Common/GetSchemeList",

            type: "GET",

            data: SchemeParams,

            dataType: "json",

            contentType: "application/json; charset=utf-8",

            beforeSend: function () {

                $("#loader").show();

            },

            success: function (data) {

                //$('#DvPatientInfo').show();

                $.each(data, function () {

                    $('#schNm').html(this['schemeName']);

                    $('#hdnscmCode').val(this['schemeCode']);

                    //if (this['schemeCode'] == "undefined") {

                    //    $('#DvPatientInfo').hide();

                    //}

                    //alert(this['schemeCode']);

                    SearchAdm();

                    FamilyMemberDetails();

                });

            },

            complete: function () {

                $("#loader").hide();

            },

            error: function (error) {

                console.log(error.responseText);

                $('#DvPatientInfo').hide();

            }

        });

    }



    function Referalbtn() {

        window.location.href = '@Url.Action("PatientReferalForm", "Discharge")?URN=' + $('#lblURNNo').text()

    }



    function SearchAdm() {



        if (validate()) {

        }

    }


    //Surgical Part
    function SetSurgical() {

        $('#Surgical').prop('checked', true);
        if ($("#Surgical").is(":checked")) {
            var urnno = $('#lblURNNo').text();
            var memberId = $("#spnPatientMemberId").text();
            verificationFamilyData(urnno);
            $('#Verifieddetails').show();
            $('#PackageDetails').hide();// 01032023
            $('#AdmissionDetails').hide();
            $('#PackageGridDetails').hide();
            Pacakagedata = [];
            implantdata = [];
            highenddrugs = [];
            vitaldata = [];
            //$("#tblPackageDtls").empty();
            $('#tblPackageDtls tbody').empty();
            AdmissionDetailsReset();
            OverrideDetails(memberId);
        }
    }

    //Emergency Part
    function SetEmergency() {
        var memberId = $("#spnPatientMemberId").text();
        $('#Surgical').prop('checked', false);
        $('#tblPackageDtls tbody').empty();
        $('#Verifieddetails').show();
        $('#PackageDetails').hide();
        $('#PackageGridDetails').hide();
        OverrideDetails(memberId);
    }



    // Display Family Member Verification List

    function verificationFamilyData(urn) {

        $.ajax({

            url: ServiceURL + "/api/URN/GetFamilyMemeberList",

            type: "GET",

            data: { 'URN': urn },

            dataType: "json",

            contentType: "application/json; charset=utf-8",

            success: function (response) {

                $("#grdFamilyDetails").DataTable({

                    processing: true,

                    bLengthChange: true,

                    lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],

                    bFilter: true,

                    bSort: true,

                    bPaginate: false,

                    searching: false,

                    bInfo: false,

                    data: response,

                    bDestroy: true,

                    autoWidth: false,

                    columns: [

                        { data: 'id', type: "text", title: "Sl#", align: "center", render: function (data, type, row, meta) { return meta.row + meta.settings._iDisplayStart + 1; } },

                        { data: "memberID", type: "text", title: "Member Id", align: "center" },

                        { data: "memberName", type: "text", title: "Name", align: "center" },

                        { data: "memberGender", type: "text", title: "Gender", align: "center" },

                        { data: "memberAge", type: "text", title: "Age", align: "center" },

                        { data: "maskAadharnumber", type: "text", title: "Aadhaar Card No", align: "center", width:"150px" },

                        /*{ data: "maskAadharnumber", type: "text", title: " Aadhar Card No ", align: "center", visible: "false" },*/

                        { data: "rationCardNumber", type: "text", title: " Ration Card No ", align: "center" },

                    ],

                    columnDefs: [

                        {

                            targets: 7,

                            data: null,

                            title: "IRIS",

                            orderable: false,

                            defaultContent: "<button type='button'id='btnIris' onclick='IrisVerification(this)' class='btn btn-outline-success focusedBtn btn-sm my-2 my-sm-0'> IRIS</button>"

                        },

                        {

                            targets: 8,

                            data: null,

                            title: "POS",

                            orderable: false,

                            defaultContent: "<button type='button'id='btnPOS' onclick='POSVerification(this)' class='btn btn-outline-primary focusedBtn btn-sm my-2 my-sm-0'> POS </button>"

                        },

                        {

                            targets: 9,

                            data: null,

                            title: "OTP",

                            orderable: false,

                            defaultContent: "<button type='button'id='btnOTP' onclick='OTPVerification(this)' class='btn btn-outline-warning focusedBtn btn-sm my-2 my-sm-0'> OTP </button>"

                        }

                    ]

                });

            },

            failure: function (response) {

                alert(response.d);

            },

            error: function (response) {

                alert(response.d);

            }

        });

    }



    function OverrideDetails(memberid) {

        //debugger;

        var overideparams = {

            Action: 'A',

            //URN: $('#urnNo').val(),

            URN: $('#lblURNNo').text(),

            HospitalCode: '@Session["HospitalCode"]',

            Memberid: memberid

        };

        $.ajax({

            url: ServiceURL + "/api/Common/GetOverrideRefrral",

            type: "GET",

            data: overideparams,

            dataType: "json",

            contentType: "application/json; charset=utf-8",

            success: function (resultBal) {

                if (resultBal.blockfpoverride != null) {

                    $('#btnoverridegeneration').attr('disabled', 'disabled');

                    $('#txtOverrideCode').val(resultBal.blockfpoverride);

                    $('#verificationBlock').addClass('divdisable');

                    $("#PackageDetails").show();

                    $('#txtRefCode').attr('disabled', 'disabled');

                    $('#txtRefCode').val(resultBal.referralcode);

                    $('#tblFamilyDetails').addClass('divdisable')

                    if (resultBal.referralcode != null) {

                        $('#btnreferralcode').attr('disabled', 'disabled');

                    }

                    else {

                        $('#btnreferralcode').removeAttr('disabled', 'disabled');

                    }



                }

                if (resultBal.blockfpoverride == null) {

                    $('#btnoverridegeneration').removeAttr('disabled', 'disabled');

                    $('#txtOverrideCode').val('');

                    $('#txtOverrideCode').focus();

                    $("#PackageDetails").hide();// 01032023

                    $('#verificationBlock').removeClass('divdisable');

                    $('#txtRefCode').attr('disabled', 'disabled');

                    $('#txtRefCode').val(resultBal.referralcode);

                    $('#tblFamilyDetails').removeClass('divdisable')

                    if (resultBal.referralcode != null) {

                        $('#btnreferralcode').attr('disabled', 'disabled');

                    }

                    else {

                        $('#btnreferralcode').removeAttr('disabled', 'disabled');

                    }

                }

            },

            error: function (error) {

                console.log(error.responseText);

            }

        });

    }



    //Hide Divs when no records found

    function hideDivs() {

        $('#DvPatientInfo').hide();

        $('#PatientDetails').hide();

        $('#AdmissionDetails').hide();

        $('#Verifieddetails').hide();

        $('#PackageDetails').hide();// 01032023

        $('#PackageGridDetails').hide();

        $('#AdmissionDetails').hide();

        $('#Verifieddetails').hide();

        $('#TreatmentType').hide();

    }

     // Display Family Member List

    function FamilyMemberDetails() {

        var selectedRow;

        var arrMembInfo = [];

        $('#tblFamilyDetails').jsGrid({

            width: "100%",

            sorting: true,

            paging: true,

            pageSize: 10,

            autoload: true,

            controller: {

                loadData: function () {

                    var d = $.Deferred();

                    var params = {

                        URN: $('#urnNo').val(),

                        searchBy: $("#ddlSearchByFilter option:selected").val(),

                        hospitalcode: '@Session["HospitalCode"]',

                    };

                    return $.ajax({

                        url: ServiceURL + "/api/URN/SearchFamilyMemeberList",

                        type: "GET",

                        data: params,

                        dataType: "json",

                        contentType: "application/json; charset=utf-8",

                        error: function (error) {

                            console.log(error.statusText);

                        },

                    }).done(function (result) {

                        if (!$.trim(result)) {



                            hideDivs();

                            swal({

                                text: "No record found",

                                type: 'warning',

                                confirmButtonColor: "#36A865",

                                confirmButtonText: "OK"

                            });

                        }

                        else {

                            var arrVerMembName = [];

                            var BalanceParams = {

                                Action: 'A',

                                URN: result[0].urn,

                                FamilyId: result[0].familyID

                            };

                            for (i = 0; i < result.length; i++) {

                                arrVerMembName.push({

                                    memberName: result[i].memberName,

                                    memberID: result[i].memberID

                                });

                            }



                            $('#lblURNNo').html(result[0].urn);

                            $('#spnPolFrmDate').html(result[0].policystartdate);

                            $('#spnPolToDate').html(result[0].policyenddate);

                            $('#divDesc').show();

                            SetSurgical();

                            $.ajax({

                                url: ServiceURL + "/api/Common/GetAvailBalance",

                                type: "GET",

                                data: BalanceParams,

                                dataType: "json",

                                contentType: "application/json; charset=utf-8",

                                success: function (resultBal) {

                                    if (resultBal != null) {

                                        $('#AvailB').html(toIndianCurrency(parseFloat(resultBal.availableBalance)));

                                    }

                                    else {

                                        $('#AvailB').html('NA');

                                    }



                                    if (resultBal != null) {

                                        $('#schClaimAmount').html(toIndianCurrency(parseFloat(resultBal.claimedamount)));

                                    }

                                    else {

                                        $('#schClaimAmount').html('NA');

                                    }



                                    if (resultBal != null) {

                                        $('#schFemaleFund').html(toIndianCurrency(parseFloat(resultBal.femalefund)));

                                    }

                                    else {

                                        $('#schFemaleFund').html('NA');

                                    }



                                    if (resultBal != null) {

                                        $('#schBlockedAmount').html(toIndianCurrency(parseFloat(resultBal.amountBlocked)));

                                    }

                                    else {

                                        $('#schBlockedAmount').html('NA');

                                    }

                                },

                                error: function (error) {



                                    console.log(error.responseText);

                                }

                            });

                        }

                        console.log(result);

                        d.resolve($.map(result,

                            function (item, itemIndex) {

                                return $.extend(item, { "Index": itemIndex + 1 });

                            }

                        ));

                    });

                }

            },



            fields: [

                { name: "Index", width: "30", type: "number", title: "#Sl", align: "center", editing: false },

                { name: "policystartdate", title: "policystartdate", type: "text", visible: false },

                { name: "policyenddate", title: "policyenddate", type: "text", visible: false },

                { name: "memberID", title: "memberID", type: "text", visible: true },

                { name: "headMemberID", title: "headMemberID", type: "text", visible: false },

                { name: "hoh", title: "HeadOfFamily", type: "text", visible: false },

                { name: "memberBlock", title: "memberBlock", type: "text", visible: false },

                { name: "memberBlockCode", title: "memberBlockCode", type: "text", visible: false },

                { name: "memberPanchayatCode", title: "memberPanchayatCode", type: "text", visible: false },

                { name: "memberPanchayatName", title: "memberPanchayatName", type: "text", visible: false },

                { name: "memberVillageCode", title: "memberVillageCode", type: "text", visible: false },

                { name: "memberVillageName", title: "memberVillageName", type: "text", visible: false },

                { name: "memberDistrict", title: "District", type: "text", visible: false },

                { name: "memberDistrictCode", title: "DistrictCode", type: "number", visible: false },

                { name: "memberState", title: "State", type: "text", visible: false },

                { name: "memberStateCode", title: "memberStateCode", type: "number", visible: false },

                //{ name: "urn", type: "text", title: "URN", align: "center", editing: false },

                { name: "familyID", type: "text", title: "FamilyID", align: "center", editing: false, visible: false },

                { name: "memberName", type: "text", title: "Name", align: "center", editing: false },

                { name: "memberGender", type: "text", width: "70", title: "Gender", align: "center", editing: false },

                { name: "memberAge", type: "number", title: "Age", width: "50", align: "center", editing: false },

                { name: "mobile", type: "text", title: "Mobile", align: "center", editing: false, visible: false },

                { name: "aadharnumber", type: "text", title: "Aadharcard", align: "center", editing: false, visible: false },

                { name: "rationCardBackDoc", type: "text", title: "RationCard", align: "center", editing: false, visible: false },

                {

                    type: "control", editButton: false, deleteButton: false, align: "center", name: "maskAadharnumber",

                    itemTemplate: function (value, item) {

                        return value

                            //.on("click", function () {

                            //    var BaseUrl = item.memberDistrictCode + '/' + item.memberBlockCode + '/' + item.memberPanchayatCode + '/RationCard/' + item.adharcard;

                            //    window.open("../Download.ashx?msg=" + encodeURIComponent(BaseUrl), '_blank');

                            //    // window.open(AppURL + '/UploadDoc/'+item.memberDistrictCode+'/'+item.memberBlockCode+'/'+item.memberPanchayatCode+'/RationCard/' + item.adharcard, '_blank');

                            //    // alert(AppURL + '/UploadDoc/' + item.adharcard);

                            //    return false;

                            //});

                    },

                    width: 100,

                    headerTemplate: function () {

                        return $("<div>").prop("title", "Action").text("Aadhaar Card No.");

                    },

                },

                {

                    type: "control", editButton: false, deleteButton: false, align: "center", name: "rationCardNumber",

                    itemTemplate: function (value, item) {

                        return value

                    },

                    width: 100,

                    headerTemplate: function () {

                        return $("<div>").prop("title", "Action").text("Ration Card No.");

                    },

                },

                { type: "control", editButton: true, deleteButton: false, align: "center", visible: false },

                {

                    type: "control", editButton: false, deleteButton: false, align: "center",

                    itemTemplate: function (value, item) {

                        return $("<button>").attr({ type: "button", class: "btn btn-outline-success focusedBtn btn-sm my-2 my-sm-0" }).text("Select")

                            .on("click", function () {



                                var gender = $(this).closest("tr").find('td:eq(3)').text();

                                if (gender.toUpperCase() == "MALE" && $('#AvailB').text().replace(/[^\x00-\x7F]/g, "") == 0.00) {

                                    swal({

                                        text: "Cannot Admitted, Insufficient Available Amount",

                                        confirmButtonColor: "#36A865",

                                        type: "error",

                                        confirmButtonText: "OK"

                                    })

                                }

                                else if (gender.toUpperCase() == "FEMALE" && $('#AvailB').text().replace(/[^\x00-\x7F]/g, "") == 0.00 && $('#schFemaleFund').text().replace(/[^\x00-\x7F]/g, "") == 0.00) {

                                    swal({

                                        text: "Cannot Admitted, Insufficient Available Amount & Female Fund",

                                        confirmButtonColor: "#36A865",

                                        type: "error",

                                        confirmButtonText: "OK"

                                    })

                                }

                                else {





                                    //#region "For highlighting a particular row by button click"

                                    var $row = $("#jsGrid").jsGrid("rowByItem", item);

                                    selectedRow = $("#jsGrid").find('table tr.highlight');

                                    if (selectedRow.length) {

                                        selectedRow.toggleClass('highlight');

                                    };

                                    $row.toggleClass("highlight");



                                    //#endregion



                                    // Mo Mr Unblock Check



                                    if (item.admissionstatus.toUpperCase() == "ADMITTED") {



                                        $.ajax({

                                            url: ServiceURL + "/api/Common/Check_MOMR_Package",

                                            type: "GET",

                                            data: { 'memberID': item.memberID, 'urn': item.urn, 'hospitalcode': '@Session["HospitalCode"]' },

                                            dataType: "json",

                                            contentType: "application/json; charset=utf-8",

                                            success: function (resultBal) {

                                                console.log("MoMr :", resultBal);



                                                $('#hdnParentpatientId').val(resultBal[0].parent_id);



                                                if (resultBal.length > 0) {

                                                    if (resultBal[0].status == 0 && resultBal[0].parent_id == null) {

                                                        swal({

                                                            icon: 'warning',

                                                            type: 'warning',

                                                            title: item.memberName.toUpperCase(),

                                                            text: 'Patient already admitted another hospital!!',

                                                            confirmButtonColor: "#36A865",

                                                            confirmButtonText: "OK"

                                                        });

                                                        $("#PatientDetails").hide();

                                                        return false;

                                                    }

                                                    else if (resultBal[0].status == 1 && resultBal[0].parent_id == null) {

                                                        swal({

                                                            icon: 'warning',

                                                            type: 'warning',

                                                            title: item.memberName.toUpperCase(),

                                                            text: 'Patient already admitted another hospital!!',

                                                            confirmButtonColor: "#36A865",

                                                            confirmButtonText: "OK"

                                                        });

                                                        $("#PatientDetails").hide();

                                                        return false;

                                                    }

                                                    else if (resultBal[0].status == 2 && resultBal[0].parent_id == null) {

                                                        swal({

                                                            icon: 'warning',

                                                            type: 'warning',

                                                            title: item.memberName.toUpperCase(),

                                                            text: 'Patient already admitted another hospital!!',

                                                            confirmButtonColor: "#36A865",

                                                            confirmButtonText: "OK"

                                                        });

                                                        $("#PatientDetails").hide();

                                                        return false;

                                                    }



                                                }

                                            },

                                            error: function (error) {

                                                console.log(error.responseText);

                                            }

                                        });

                                    }







                                    $("#PatientDetails").show();



                                    $("#spnPatientName").html(item.memberName);

                                    $("#spnPatientMemberId").html(item.memberID);//Member Id

                                    $("#spnPatientGender").html(item.memberGender);

                                    $("#spnPatientAge").html(item.memberAge);

                                    $("#spnPatAadhar").html(item.maskAadharnumber);

                                    $("#spnPatientRationId").html(item.urnno);

                                    //For Over Ride Request Data Bind

                                    $("#lblPatientMemberId").html(item.memberID);

                                    $("#lblPatientName").html(item.memberName);

                                    $("#lblPatientGender").html(item.memberGender);

                                    $("#lblPatientAge").html(item.memberAge);

                                    $("#lblPatientAadharNo").html(item.maskAadharnumber);

                                    $("#lblPatientUrnNo").html($('#lblURNNo').text());//Member URN No

                                    $("#spnPatAdmissionStatus").html(item.admissionstatus.toUpperCase());//Member URN No

                                    //END

                                    arrMembInfo.push({

                                        memberID: item.memberID,

                                        hoh: item.hoh,

                                        headMemberID: item.headMemberID,

                                        memberDistrict: item.memberDistrict,

                                        memberDistrictCode: item.memberDistrictCode,

                                        memberState: item.memberState,

                                        memberStateCode: item.memberStateCode,

                                        memberBlock: item.memberBlock,

                                        memberBlockCode: item.memberBlockCode,

                                        memberPanchayatCode: item.memberPanchayatCode,

                                        memberPanchayatName: item.memberPanchayatName,

                                        memberVillageCode: item.memberVillageCode,

                                        memberVillageName: item.memberVillageName,

                                        urn: item.urn,

                                        familyID: item.familyID,

                                        memberName: item.memberName,

                                        memberGender: item.memberGender,

                                        memberAge: item.memberAge,

                                        schemeCode: $('#schemeCode').text(),

                                        schemeName: $('#schNm').text()

                                    })

                                    // console.log(arrMembInfo);

                                    localStorage.setItem('MembInfo', JSON.stringify(arrMembInfo));

                                    // $('#AuthMode').show();

                                    $('#AuthDocument').show();

                                    $('#OnlineAadhNo').val(item.aadharnumber);



                                    $('#btnAuth').show();

                                    $('#divMobile').text(item.mobile);

                                    getPrevBlockedPackageList();

                                    // clearDocument();

                                    getPrevPackageDetails();

                                    OverrideDetails(item.memberID);

                                }

                            });

                    },

                    headerTemplate: function () {

                        return $("<div>").prop("title", "Action").text("Select Patient");

                    },

                }

            ]

        });

    }



    // Verification member Part

    function VerificationMember(ele) {

        var dataRow = $('#grdFamilyDetails').DataTable().row($(ele).closest('tr')).data();

        if ($("#iris").is(":checked")) {

            $('#IrisModal').modal('show');

            $("#btnAuthentication").hide();

            discoverRDService();

            //DeviceInfo();

            currrentElement = ele;

        }

        if ($("#pos").is(":checked")) {

            POSVerification(ele, dataRow.urn, dataRow.memberID);

        }

        if ($("#otp").is(":checked")) {

            $('#txtopt').val('');

            SendOTP(dataRow.aadharnumber);

            currrentElement = ele;

            $('#OTPModal').modal('show');

            $("#Uid").val(dataRow.aadharnumber);

        }

        $('#VerifiedMemberId').val(dataRow.memberID);

        $('#VerifiedMemberName').val(dataRow.memberName);

    };



    // Iris Device Ready or not Code

    function discoverRDService() // Search for the valid RDService from port 11100 to 11120

    {



        var primaryUrl = "";

        if (window.location.protocol != "https:") {

            primaryUrl = "http://localhost"

        }

        else {

            primaryUrl = "https://localhost"

        }

        document.getElementById("getrdresponse").innerHTML = primaryUrl;

        var tempcount = 0;

        url = "";

        for (var i = 11100; i <= 11120; i++) {

                console.log('local', i);

                var verb = "RDSERVICE";

                var err = "";

                var res;

                $.support.cors = true;

                var httpStaus = false;

                var jsonstr = "";

                var data = new Object();

                var obj = new Object();

                var xmlstr = '';

                var RDurl = primaryUrl + ":" + i.toString();

                console.log('url', RDurl);



                $.ajax({

                    type: "RDSERVICE",

                    async: false,

                    crossDomain: true,

                    url: RDurl,

                    contentType: "text/xml; charset=utf-8",

                    processData: false,

                    cache: false,

                    async: false,

                    crossDomain: true,



                    beforeSend: function () {



                            console.log('before');

                            $("#loader").show();



                    },

                    success: function (data) {

                        console.log('data', data);

                        try {

                            xmlstr = data.xml ? data.xml : (new XMLSerializer()).serializeToString(data);

                            data = xmlstr;

                            var xmlDoc = $.parseXML(data);

                            console.log("decvice xmldoc-", xmlDoc);

                            var $xml = $(xmlDoc);

                            var Name = $xml.find('RDService').attr('status');

                            var info = $xml.find('RDService').attr('info');

                            $('#rdStatus').val(Name);

                            $('#rdinfo').val(info);



                            if ("Biomatiques Iris (Model: EPI-1000)" == info) {

                                console.log('abcd');

                                url = RDurl;

                                i = 11130;;

                            }



                            if (Name == "READY") {

                                $("#btnCapture").show();

                                DeviceInfo();

                            }



                            httpStaus = true;

                            res = { httpStaus: httpStaus, data: data };

                            tempcount++;



                        }

                        catch (e) {

                            //alert(e.Message);

                        }

                    },

                    complete: function () {

                        console.log('after');

                        $("#loader").hide();

                    },

                    error: function (jqXHR, ajaxOptions, thrownError) {

                        //console.log('error1', jqXHR);

                        //console.log('error2', ajaxOptions);

                        //console.log('error1', thrownError);

                        //    res = { httpStaus: httpStaus, err: getHttpError(jqXHR) };

                    }

                });

        }

        return res;

    }



    // Iris Device information

    function DeviceInfo() {

        $('#getrdresponse').html('');

        var urlinfo = url + "/BISPL/info";

        document.getElementById("getrdresponse").innerHTML = urlinfo;

        var verb = "DEVICEINFO";

        var err = "";

        var res;

        $.support.cors = true;

        var httpStaus = false;

        var jsonstr = "";

        var data = new Object();

        var obj = new Object();

        var xmlstr = '';

        var RDurl = urlinfo;



        $.ajax({

            type: "DEVICEINFO",

            async: false,

            crossDomain: true,

            url: RDurl,

            contentType: "text/xml; charset=utf-8",

            processData: false,

            cache: false,

            async: false,

            crossDomain: true,

            beforeSend: function () {

                $("#loader").show();

            },

            success: function (data) {

                try {

                    xmlstr = data.xml ? data.xml : (new XMLSerializer()).serializeToString(data);

                    data = xmlstr;

                    var xmlDoc = $.parseXML(data);

                    //console.log("xmldoc-", xmlDoc);

                    var $xml = $(xmlDoc);

                    var dpid = $xml.find('DeviceInfo').attr('dpId');

                    var mi = $xml.find('DeviceInfo').attr('mi');

                    var mc = $xml.find('DeviceInfo').attr('mc');

                    $('#mi').val(mi);

                    $('#mc').val(mc);

                    $('#dpid').val(dpid);

                    $('#rdInfo').val(data);

                    document.getElementById("getrdresponse").innerHTML = data;

                    httpStaus = true;

                    res = { httpStaus: httpStaus, data: data };

                    tempcount++;



                }

                catch (e) {

                    //Alert(e.Message);

                }

            },

            complete: function () {

                $("#loader").hide();

            },

            error: function (jqXHR, ajaxOptions, thrownError) {

                //    res = { httpStaus: httpStaus, err: getHttpError(jqXHR) };

            }

        });



    }



    // Iris Device Capture information

    function Capture() {

        /* alert("Click");*/

        $('#getrdresponse').html('');



        var val = '';

        if (document.getElementById('rdProduction').checked) {

            val = document.getElementById('rdProduction').value

        }

        else if (document.getElementById('rdStaging').checked) {

            val = document.getElementById('rdStaging').value

        }

        //else{

        // alert("Please Select Option");

        //}

        var urlcapture = url + "/BISPL/capture";



        var PIDOPTS = '<PidOptions ver=\"1.0\">' + '<Opts fCount=\"0\" fType=\"\" iCount=\"1\" iType=\"0\" pCount=\"\" pType=\"\" format=\"0\" pidVer=\"2.0\" timeout=\"15000\" otp=\"\" wadh=\"\" posh=\"\" env=\"' + val + '\"/>' + '</PidOptions>';

        //alert(PIDOPTS);



        var verb = "CAPTURE";

        var err = "";

        var res;

        $.support.cors = true;

        var httpStaus = false;

        var jsonstr = "";

        var data = new Object();

        var obj = new Object();

        var xmlstr = '';

        var RDurl = urlcapture;



        $.ajax({

            type: "CAPTURE",

            async: false,

            crossDomain: true,

            url: RDurl,

            contentType: "text/xml; charset=utf-8",

            data: PIDOPTS,

            processData: false,

            cache: false,

            async: false,

            crossDomain: true,

            beforeSend: function () {

                $("#loader").show();

            },

            success: function (data) {

                try {

                    xmlstr = data.xml ? data.xml : (new XMLSerializer()).serializeToString(data);

                    data = xmlstr;

                    var xmlDoc = $.parseXML(data);

                    //console.log("xmlCaptureDoc-", xmlDoc);

                    var $xml = $(xmlDoc);

                    var dpid = $xml.find('DeviceInfo').attr('dpId');

                    var mi = $xml.find('DeviceInfo').attr('mi');

                    var mc = $xml.find('DeviceInfo').attr('mc');

                    var errorcode = $xml.find('Resp').attr('errCode');

                    var errInfo = $xml.find('Resp').attr('errInfo');

                    $('#mi').val(mi);

                    $('#mc').val(mc);

                    $('#dpid').val(dpid);

                    $('#errCode').val(errorcode);

                    $('#errInfo').val(errInfo);

                    $('#rdData').val(data);

                    if (errInfo == $('#errCode').text()) {

                        $("#btnAuthentication").show();

                    }

                    document.getElementById("getrdresponse").innerHTML = data;

                    httpStaus = true;

                    res = {

                        httpStaus: httpStaus,

                        data: data

                    };

                    tempcount++;



                }

                catch (e) {

                    //Alert(e.Message);

                }

            },

            complete: function () {

                $("#loader").hide();

            },

            error: function (jqXHR, ajaxOptions, thrownError) {

                //    res = { httpStaus: httpStaus, err: getHttpError(jqXHR) };

            }

        });



    }



    // Iris Authentication

    function IrisVerification(ele) {

        var dataRow = $('#grdFamilyDetails').DataTable().row($(ele).closest('tr')).data();

        $('#IrisModal').modal('show');

        $("#AadharUidMask").val(dataRow.maskAadharnumber);

        $("#AadharUid").val(dataRow.aadharnumber);

        $("#MemberId").val(dataRow.memberID);

        $("#Urn").val(dataRow.urn);

        $("#btnAuthentication").hide();

        $('#rdInfo').val("");

        $('#rdData').val("");

        $('#AuthenticationMode').val("");

        $('#VerifyMemeberId').val("");

        $('#VerifyMemeberName').val("");

        discoverRDService();

        //DeviceInfo();

        currrentElement = ele;

    }



    // Iris Authentication

    $('#btnAuthentication').click(function (event) {

        //var model = JSON.stringify({

        //    uid: $("#AadharUid").val(),

        //    memberId: $("#MemberId").val(),

        //    urn: $("#Urn").val(),

        //    rdInfo: $('#rdInfo').val(),

        //    rdData: $('#rdData').val(),

        //    verificationThrough: "0301",

        //    patientid: $('#spnPatientMemberId').text()

        //});
        var hos = '@Session["HospitalCode"]'
        var model = JSON.stringify({
            uid: $("#AadharUid").val(),
            memberId: $("#MemberId").val(),
            urn: $("#Urn").val(),
            rdInfo: $('#rdInfo').val(),
            rdData: $('#rdData').val(),
            verificationThrough: "0301",
            patientid: $('#spnPatientMemberId').text(),
            hospitalcode: hos
        });

        $.ajax({

            url: ServiceURL + "/api/Common/IRISVerification",

            type: "POST",

            data: model,

            dataType: "json",

            contentType: "application/json; charset=utf-8",

            beforeSend: function () {

                $("#loader").show();

            },

            success: function (result) {

                if (result.status == "SUCCESS") {

                    swal({

                        text: "Authentication successfully",

                        type: "success",

                        confirmButtonColor: "#36A865",

                        confirmButtonText: "OK"

                    }).then(function () {

                        $('#IrisModal').modal('hide');

                        displayIRISSelectedRow(currrentElement, "SUCCESS");

                    });

                }

                else if (result.status == "ERROR") {

                    swal({

                        text: result.errMsg,

                        type: "error",

                        confirmButtonColor: "#36A865",

                        confirmButtonText: "OK"

                    }).then(function () {

                        $('#IrisModal').modal('hide');

                        displayIRISSelectedRow(currrentElement, "ERROR");

                    });

                }

                else {



                }

            },

            complete: function () {

                $("#loader").hide();

            },

            error: function (error) {

                console.log(error.statusText);

            }

        });

    });



    function displayIRISSelectedRow(ele, result) {

        if (result == "ERROR") {

            var currentRow = $(ele).closest("tr");

            currentRow.find("td:eq(7)").find('#btnIris').text("Not Verified");

            $('#btnoverridegeneration').removeAttr('disabled', 'disabled');

        }

        if (result == "SUCCESS") {

            var currentRow = $(ele).closest("tr");

            currentRow.find("td:eq(7)").find('#btnIris').text("Verified");

            $(ele).closest('tr').addClass('row_selected')

            $('#verificationBlock').addClass('divdisable')

            $('#PackageDetails').show();

            $('#AuthenticationMode').val("IRIS");

            $('#VerifyMemeberId').val(currentRow.find("td:eq(1)").text());

            $('#VerifyMemeberName').val(currentRow.find("td:eq(2)").text());



            $('#btnoverridegeneration').attr('disabled', 'disabled');

            $('#tblFamilyDetails').addClass('divdisable')

        }



    }



    // Pos Verification Part

    function POSVerification(ele) {

        var SelectedPaitentid = $('#spnPatientMemberId').text();

        var dataRow = $('#grdFamilyDetails').DataTable().row($(ele).closest('tr')).data();

        POSVerifyOrNot(ele, dataRow.urn, dataRow.aadharnumber, dataRow.memberID, SelectedPaitentid, "0301");

        $('#AuthenticationMode').val("");

        $('#VerifyMemeberId').val(dataRow.memberID);

        $('#VerifyMemeberName').val(dataRow.memberName);

    }



    // Pos Verification Part

     function POSVerifyOrNot(ele, urn, uid, memberid, SelectedPaitentid, varificationThrough,Hospitalcode) {

        $.ajax({

            url: ServiceURL + "/api/Common/CheckPosVerifyOrNot",

            type: "get",

            dataType: "json",

            data: { urn: urn, uid: uid, memberID: memberid, selectedPatient: SelectedPaitentid, verificationThrough: varificationThrough, Hospitalcode: '@Session["HospitalCode"]'},

            contentType: "application/json; charset=utf-8",

            beforeSend: function () {

                $("#loader").show();

            },


            success: function (data) {

                //console.log("StatusList", data);

                var currentRow = $(ele).closest("tr");

                if (data.length > 0) {

                    if (data[0].verifystatus == "Y") {

                        var urnno = currentRow.find("td:eq(8)").find('#btnPOS').text("Verified");

                        $(ele).closest('tr').addClass('row_selected')

                        $('#verificationBlock').addClass('divdisable')

                        $('#PackageDetails').show();

                        $('#TreatmentType').addClass('divdisable');

                        $('#VerifyMemeberId').val(currentRow.find("td:eq(1)").text());

                        $('#VerifyMemeberName').val(currentRow.find("td:eq(2)").text());

                        $('#AuthenticationMode').val("POS");

                        $('#btnoverridegeneration').attr('disabled', 'disabled');

                        $('#tblFamilyDetails').addClass('divdisable')

                    }

                    else {

                        currentRow.find("td:eq(8)").find('#btnPOS').text("Not Verified");

                        $('#btnoverridegeneration').removeAttr('disabled', 'disabled');

                    }

                }

                else {

                    currentRow.find("td:eq(8)").find('#btnPOS').text("Not Verified");

                    $('#btnoverridegeneration').removeAttr('disabled', 'disabled');

                }

            },

            complete: function () {

                $("#loader").hide();

            },

            error: function (error) {

                console.log(error.statusText);

            }

        });

    }



     // Send Otp

    function OTPVerification(ele) {

        var dataRow = $('#grdFamilyDetails').DataTable().row($(ele).closest('tr')).data();

        $('#txtopt').val('');

        SendOTP(dataRow.aadharnumber);

        currrentElement = ele;

        var SelectedPaitentid = $('#spnPatientMemberId').text();

        $("#Uid").val(dataRow.aadharnumber);

        $("#OTPVerifyMemberID").val(dataRow.memberID);

        $("#OTPurn").val(dataRow.urn);

        $("#SelectedPatientId").val(SelectedPaitentid);

        $('#AuthenticationMode').val("");

        $('#AuthenticationMode').val("");

        $('#VerifyMemeberId').val("");

        $('#VerifyMemeberName').val("");

    }



    // Send Otp Part

    function SendOTP(aadharnumber) {

        if (aadharnumber != "") {

            //:: Kisan encrypt Format Start

            var aadharnumberEncrypt = aadharnumber;

            var key = CryptoJS.enc.Utf8.parse('8080808080808080');

            var iv = CryptoJS.enc.Utf8.parse('8080808080808080');

            var encryptedlogin = CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(aadharnumberEncrypt), key,

                { keySize: 128 / 8, iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 });

            aadharnumberEncrypt = encryptedlogin;

            console.log(aadharnumberEncrypt);

            //:: Kisan encrypt Format End

            $.ajax({

                url: ServiceURL + "/api/Common/SendOTP?AadhaarNo=" + aadharnumberEncrypt,

                type: "POST",

                processData: false,

                contentType: false,

                beforeSend: function () {

                    $("#loader").show();

                },

                success: function (result) {

                    //console.log("otp", result);

                    if (result.status == "SUCCESS") {

                        swal({

                            text: "OTP Generated & Sent to Registred Mobile No. & e-mail ID!!",

                            type: "success",

                            confirmButtonColor: "#36A865",

                            confirmButtonText: "OK"

                        }).then(function () {

                            $('#OTPModal').modal('show');

                            $('#OTPModal').modal({

                                backdrop: 'static',

                                keyboard: false

                            })

                            OTPTIMER();

                        });

                        $('#Uid').val(aadharnumber);

                        $('#txn').val(result.txn);

                    }

                    else if (result.status == "ERROR") {

                        swal({

                            text: "Invalid aadhaar number or aadhaar server not responding.!!",

                            type: "error",

                            confirmButtonColor: "#36A865",

                           confirmButtonText: "OK"

                        });

                    }

                    else {

                    }

                },

                complete: function () {

                    $("#loader").hide();

                },

                error: function (error) {

                    console.log(error.statusText);

                }

            });

        }

    };



    // Verification OTP Part

    function VerifyOTP() {

        var otpValue = $('#txtopt').val();

        var Uid = $("#Uid").val();

        var txn = $("#txn").val();

        var OTPVerifyMemberID = $("#OTPVerifyMemberID").val();

        var OTPurn = $("#OTPurn").val();

        var SelectedPatientId = $("#SelectedPatientId").val();

        if (otpValue != "") {
            var model = JSON.stringify({
                uid: Uid,
                txn: txn,
                otpValue: otpValue,
                verificationThrough: "0301",
                memberid: OTPVerifyMemberID,
                urn: OTPurn,
                patientid: SelectedPatientId,
                HospitalCode :  '@Session["HospitalCode"]'
            });


            $.ajax({

                url: ServiceURL + "/api/Common/OTPVerification",

                type: "POST",

                data: model,

                dataType: "json",

                contentType: "application/json; charset=utf-8",

                beforeSend: function () {

                    $("#loader").show();

                },

                success: function (result) {

                    if (result == "SUCCESS") {

                        $('#OTPModal').modal('hide');

                        swal({

                            text: "OTP verified successfully!!",

                            type: "success",

                            confirmButtonColor: "#36A865",

                            confirmButtonText: "OK"

                        }).then(function () {

                            displayOTPSelectedRow(currrentElement, result);

                        });

                    }

                    else if (result == "ERROR") {

                        $('#txtopt').val("");

                        $('#OTPModal').modal('show');

                        swal({

                            text: "OTP not verified !!",

                            type: "error",

                            confirmButtonColor: "#36A865",

                            confirmButtonText: "OK"

                        }).then(function () {

                            displayOTPSelectedRow(currrentElement, result);

                        });;

                    }

                    else {

                    }

                },

                complete: function () {

                    $("#loader").hide();

                },

                error: function (error) {

                    console.log(error.statusText);

                }

            });

        }

    };



    // Selected Verifiy Row

    function displayOTPSelectedRow(ele, result) {

        if (result == "ERROR") {

            var currentRow = $(ele).closest("tr");

            currentRow.find("td:eq(9)").find('#btnOTP').text("Not Verified");

            $('#btnoverridegeneration').removeAttr('disabled', 'disabled');

        }

        if (result == "SUCCESS") {

            var currentRow = $(ele).closest("tr");

            currentRow.find("td:eq(9)").find('#btnOTP').text("Verified");

            $(ele).closest('tr').addClass('row_selected');

            $('#verificationBlock').addClass('divdisable');

            $('#TreatmentType').addClass('divdisable');

            $('#PackageDetails').show();

            $('#VerifyMemeberId').val(currentRow.find("td:eq(1)").text());

            $('#VerifyMemeberName').val(currentRow.find("td:eq(2)").text());

            $('#AuthenticationMode').val("OTP");

            $('#btnoverridegeneration').attr('disabled', 'disabled');

            $('#tblFamilyDetails').addClass('divdisable')

        }

    }



    function ValidateNewPackage() {

        if ($("#dlPackage").val() == "0") {

            swal({

                text: "Please select package from list!!'",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#dlPackage").focus();

            });

            return false;

        }

        else if ($("#txtpackageheader").val() == "") {

            swal({

                text: "Please select package header!!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtpackageheader").focus();

            });

            return false;

        }

        else if ($("#txtSubPackage").val() == "") {

            swal({

                text: "Please enter sub package name!!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtSubPackage").focus();

            });

            return false;

        }

        else if ($("#txtPackageDetails").val() == "") {

            swal({

                text: "Please enter package details!!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtPackageDetails").focus();

            });

            return false;

        }

        else if ($("#txtTreatCost").val() == "") {

            swal({

                text: "Treatment Cost should not be blank!!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtTreatCost").focus();

            });

            return false;

        }

        else if ($('#ddlWard').find(":selected").val() == "0") {

            swal({

                text: "Please select ward!!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#ddlWard").focus();

            });

            return false;

        }

        else if ($("#txtwardcost").val() == "") {

            swal({

                text: "Ward Cost should not be blank!!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtwardcost").focus();

            });

            return false;

        }

        if ($("#hdnIsWardEdit").val() == "Y") {

            if ($("#txtTreatDays").val() == "0") {

                swal({

                    text: "Treatment days should not be zero!!",

                    confirmButtonColor: "#36A865",

                    type: "error",

                    confirmButtonText: "OK"

                }).then(function () {

                    $("#txtTreatDays").focus();

                });

                return false;

            }

        }

        return true;

    }



    function BindPackageHeader() {

        var PackCatagoryParams = {

            Action: 'P'

        };

        $.ajax({

            url: ServiceURL + "/api/Common/GetPackageCategory",

            type: "GET",

            data: PackCatagoryParams,

            dataType: "json",

            contentType: "application/json; charset=utf-8",

            success: function (data) {

                // console.log(data);

                $('#PApackageHeader').empty().append('<option selected="selected" value="0">--Select--</option>');

                $.each(data, function () {

                    $('#PApackageHeader').append($("<option></option>").val(this['packagecategorycode']).text(this['procedures']));

                });

            },

            error: function (error) {

                console.log(error.statusText);

            }

        });

    }



    function BindVitalParam() {

        var PackCatagoryParams = {

            Action: 'A'

        };

        $.ajax({

            url: ServiceURL + "/api/Common/GetVitalParameter",

            type: "GET",

            data: PackCatagoryParams,

            dataType: "json",

            contentType: "application/json; charset=utf-8",

            success: function (data) {

                // console.log(data);

                $('#dlVitalParam').empty().append('<option selected="selected" value="0">--Select--</option>');

                $.each(data, function () {

                    $('#dlVitalParam').append($("<option></option>").val(this['id']).text(this['vitalsign']));

                });

            },

            error: function (error) {

                console.log(error.statusText);

            }

        });

    }



    function ClearControls() {

        $("#txtpackageheader").val('');

        $('#txtSubPackage').val('');

        $("#txtPackageDetails").val('');

        $("#txtTreatCost").val(0);

        $("#txtTreatDays").val(0);

        $("#PackageApproveRequired").val('');

        $("#ddlWard").val('0');

        $("#txtPackageCost").val(0);

        $("#lblPackPrice").html('0');

        $("#lblMaximumDays").html('0');

        $("#lblDaycare").html('');

        $("#lblStayType").html('');

        $("#lblFormula").html('0');

        $("#hdnIsWardEdit").val('');

        $("#hdnWardUnit").val('');

        $("#lblWardEdit").html('');

        $("#txtpackageheader").focus();

        $('#txtSubPackage').val('');

        $("#hdnpriceeditbl").val('');

        $("#hdnheadercode").val('');

        $("#txtwardcost").val(0);

        $("#hdnProcCode").val('');

        $("#lblExcptionType").html('');

        $("#hdnPackCategoryType").val('');

        $("#hdnIsPackPriceEdit").val('N');

        $('#lblIsPackPriceEdit').html('');





        //$('#lblPackPrice').innerHTML('');

        //$('#lblStayType').innerHTML('');

        //$('#lblDaycare').innerHTML('');

    }



    function ClearPackagesControls() {

        $("#hdnheadercode").val('');

        $("#hdnWardUnit").val('');

        $("#hdnheadercode").val('');

        $("#hdnProcCode").val('');

    }

    //

    function calc_total() {

        //debugger;

         var statecode = '@Session["STATECODE"]';

         var excpHospitalType = '@Session["exceptionhospital"]'; //0

        var sum = 0;

        var totSum = 0;

        var totwardcost = 0;

        $(".total").each(function () {

            sum += parseFloat($(this).text());

        });

        $('#sum').text(toIndianCurrency(parseFloat(sum)));



        $(".totpackcost").each(function () {

            totSum += parseFloat($(this).text());

        });

        $('#PackSubTotCost').text(toIndianCurrency(parseFloat(totSum)));



        $(".wardcost").each(function () {

            totwardcost += parseFloat($(this).text());

        });

        $('#WardTotCost').text(toIndianCurrency(parseFloat(totwardcost)));

        //if (totwardcost > 65000 && statecode == "21" && $('input[name="radio"]:checked').val() == "N") {

        //    $("#preauthspanid").show();

        //    $("#preauthspandays").show();

        //    $("#preauthspandesc").show();

        //    //var index = Pacakagedata.findIndex(preauthstatus);

        //    //Pacakagedata[index].preauthstatus = "YES"

        //}

        //if (totwardcost > 65000 && statecode != "21" && excpHospitalType == '2' && $('input[name="radio"]:checked').val() == "N") {

        //    $("#preauthspanid").show();

        //    $("#preauthspandays").show();

        //    $("#preauthspandesc").show();

        //   // var index = Pacakagedata.indexOf(preauthstatus);

        //   // Pacakagedata[index].preauthstatus = "YES"

        //}



    }

    //

    function calc_totalView() {

        var sum = 0;

        $('.totblckamt').each(function () {

            sum += parseFloat($(this).text());

        });

        $('#sump').text(sum);

    }



    //Validation Parameter Value

    function ValidateParamVal() {

        if ($("#dlVitalParam").val() == "0") {

            swal({

                text: "Please select parameter name!!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#dlVitalParam").focus();

            });

            return false;

        }

        else if ($("#txtVtParamValue").val() == "") {

            swal({

                text: "Parameter value should not be blank!!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtVtParamValue").focus();

            });

            return false;

        }

        return true;

    }



   function vitaldataduplicate() {

        //debugger;

        var flag = true;

        $('#tblVitalParam tr').each(function () {



            if ($(this).find('td').eq(1).text() == $('#dlVitalParam').find(":selected").text()) {

                swal({

                    text: "Parameter Already Added!!",

                    confirmButtonColor: "#36A865",

                    type: "error",

                    confirmButtonText: "OK"

                }).then(function () {

                    $("#dlVitalParam").focus();

                });

                flag = false;

                return false;

            }

        });

        return flag;

    }



    //Add More VitalParam

    $("#addMoreVitalParam").click(function () {

        if (ValidateParamVal() != false) {

            var returnvalue = vitaldataduplicate();

            if (returnvalue === false) {

                return false;

            }

            else {



                var recno = parseInt($("#tblVitalParam > tbody > tr").length, 10) + 1;

                var vitalname = $('#dlVitalParam').find(":selected").text();

                var vtlIds = $('#dlVitalParam').find(":selected").val();

                var vtlParamVal = $("#txtVtParamValue").val();



                //var AddParamVal = "<tr><td>" + recno + "</td><td><input type='hidden' id='hdnVtlValue' value='" + vtlIds + "'>" + vitalname + "</td><td>" + vtlParamVal + "</td><td><button type='button' onclick='removeVital(this)' class='btn btn-outline-danger focusedBtn btn-sm my-2 my-sm-0'><i class='fa fa-trash'></i></button></td></tr >";

                var AddParamVal = "<tr><td>" + recno + "</td><td><input type='hidden' id='hdnVtlValue' value='" + vtlIds + "'>" + vitalname + "</td><td>" + vtlParamVal + "</td><td><button type='button' class='btn btn-outline-danger btndeletevaital  focusedBtn btn-sm my-2 my-sm-0'><i class='fa fa-trash'></i></button></td></tr >";

                $("#tblVitalParam").append(AddParamVal);



                var d = { "vitalsignid": vtlIds, "vitalsign": vitalname, "vitalvalue": vtlParamVal };

                vitaldata.push(d);

                // console.log("parameter add", vitaldata)

                $("#txtVtParamValue").val('');

                $("#dlVitalParam").val(0);

            }

        }

    });

    $('#tblVitalParam tbody').on('click', '.btndeletevaital', function () {

        /* function removePackage(ele) {*/

        // debugger;

        var vitalname = $(this).closest("tr").find('td:eq(1)').text();

        var data1 = vitaldata;

        for (var i = 0; i < data1.length; i++) {

            if (data1[i].vitalsign == vitalname) {

                data1 = jQuery.grep(data1, function (value) {

                    return value != data1[i];

                    //data1.remove(data1[i]);

                    //console.log(data1);

                });

                //data1.splice(data1[i])

                vitaldata = data1;

            }

        }

        if ($('#tblVitalParam tr').length == 2) {

            //Remove th also

            $('#tblVitalParam tr').remove();

        }

        else {

            $(this).closest('tr').remove();

            ////Re arrange SL#

            $('#tblVitalParam td:first-child').each(function (index) {

                $(this).text(index + 1);

            });

        }



        return false;



    });

    function BlockPackageSava(ele) {
       // debugger;
        var statecode = '@Session["STATECODE"]';
        var excpHospitalType = '@Session["exceptionhospital"]'; //0
        var ApprovalRequired = $('#tblPackageDtls').find('td').eq(10).text().trim();
        var Totalwardimplantcost = 0;
        var Totalwardhighendcost = 0;
        var apprequ = '';
        $('#tblPackageDtls tr').each(function () {
            var wardcost = $(this).find('td').eq(7).text().trim();
            var implantcost = $(this).find('td').eq(8).text().trim();
            var highendcost = $(this).find('td').eq(9).text().trim();
            var implanttotal = parseFloat(fn_ValReplace(wardcost)) + parseFloat(fn_ValReplace(implantcost));
            var highendtotal = parseFloat(fn_ValReplace(wardcost)) + parseFloat(fn_ValReplace(highendcost));
            if (implanttotal>65000) {
                Totalwardimplantcost = implanttotal;
            }
            if (highendtotal > 65000) {
                Totalwardhighendcost = highendtotal;
            }
            var preauthid = $(this).find('td').eq(10).text().trim();
            if (preauthid.toUpperCase() == 'YES') {
                apprequ = preauthid;
                console.log('preauthid', apprequ);
            }
        });
        var MotalityDocUpload = $("#txtuploadfile").get(0);
        var PhotoUpload = $("#Photo").get(0);
        var Motalityfiles = MotalityDocUpload.files;
        var Photofiles = PhotoUpload.files;
        var fileExtension = ['pdf', 'jpeg', 'jpg'];
        var photofileExtension = ['jpeg', 'jpg'];
        var filename = $('#txtuploadfile').val();
        var photofilename = $('#Photo').val();
        var extension = filename.replace(/^.*\./, '');
        var photoextension = photofilename.replace(/^.*\./, '');
        var number = $('#txtPatientNo').val();
        var expr = /^(0|91)?[6-9][0-9]{9}$/;

        if (filename.length != 0) {
            var File = $("#txtuploadfile")[0].files[0].size;
        }
        if (photofilename.length != 0) {
            var PhotoFile = $("#Photo")[0].files[0].size;
        }
        if ((apprequ.toUpperCase() == 'YES') && $('#txtExcptionType').val() == 'N' && excpHospitalType != '1' && $('input[name="radio"]:checked').val() == "N" && $('#txtuploadfile').val() === "" && statecode == "21") {
            swal({
                text: "Please Upload Pre-Auth File !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {
                $("#txtuploadfile").focus();
            });

            return false;

        }

        else if ((apprequ.toUpperCase() == 'YES') && $('input[name="radio"]:checked').val() == "N" && excpHospitalType == '2' && $('#txtuploadfile').val() === "" && statecode != "21") {
            swal({
                text: "Please Upload Pre-Auth File !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {
                $("#txtuploadfile").focus();
            });

            return false;

        }

        else if ((apprequ.toUpperCase() != 'YES') && (implantdata.length > 0 && Totalwardimplantcost > 65000)
            && $('input[name="radio"]:checked').val() == "N" && $('#txtuploadfile').val() === "" && excpHospitalType != '1' && statecode == "21" && $('#txtExcptionType').val() == 'N' && $('#txtExcptionTypeid').val()!='Y') {

            swal({
                text: "Please Upload Pre-Auth File !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {
                $("#txtuploadfile").focus();
            });

            return false;

        }
        else if ((apprequ.toUpperCase() != 'YES')
            && (highenddrugs.length > 0 && Totalwardhighendcost > 65000)
            && $('input[name="radio"]:checked').val() == "N"
            && $('#txtuploadfile').val() === "" && excpHospitalType != '1'
            && statecode == "21" && $('#txtExcptionType').val() == 'N' && $('#txtExcptionTypeid').val() != 'Y') {

            swal({
                text: "Please Upload Pre-Auth File !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {
                $("#txtuploadfile").focus();
            });

            return false;

        }

        else if ((apprequ.toUpperCase() != 'YES') && (implantdata.length > 0 && Totalwardimplantcost > 65000)
            && $('input[name="radio"]:checked').val() == "N" && excpHospitalType == '2'
            && $('#txtuploadfile').val() === ""
            && statecode != "21" && $('#txtExcptionType').val() == 'N' && $('#txtExcptionTypeid').val() != 'Y') {
            swal({
                text: "Please Upload Pre-Auth File !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {
                $("#txtuploadfile").focus();
            });
            return false;
        }
        else if ((apprequ.toUpperCase() != 'YES') && (highenddrugs.length > 0 && Totalwardhighendcost > 65000)
            && $('input[name="radio"]:checked').val() == "N" && excpHospitalType == '2' && $('#txtuploadfile').val() === ""
            && statecode != "21" && $('#txtExcptionType').val() == 'N' && $('#txtExcptionTypeid').val() != 'Y') {
            swal({
                text: "Please Upload Pre-Auth File !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {
                $("#txtuploadfile").focus();
            });
            return false;
        }

        else if ((apprequ.toUpperCase() != 'YES') && (implantdata.length > 0 && Totalwardimplantcost > 65000)
            && $('input[name="radio"]:checked').val() == "N" && excpHospitalType != '1' && statecode == "21"
            && ($('#txtpreauthNoofdays').val() === "" || $('#txtpreauthNoofdays').val() == 0)
            && $('#txtExcptionType').val() == 'N' && $('#txtExcptionTypeid').val() != 'Y') {

            swal({
                text: "Please Enter No. Of Days !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"

            }).then(function () {

                $("#txtpreauthNoofdays").focus();

            });

            return false;

        }
        else if ((apprequ.toUpperCase() != 'YES') && (highenddrugs.length > 0 && Totalwardhighendcost > 65000)
            && $('input[name="radio"]:checked').val() == "N" && excpHospitalType != '1' && statecode == "21"
            && ($('#txtpreauthNoofdays').val() === "" || $('#txtpreauthNoofdays').val() == 0)
            && $('#txtExcptionType').val() == 'N' && $('#txtExcptionTypeid').val() != 'Y') {

            swal({
                text: "Please Enter No. Of Days !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"

            }).then(function () {

                $("#txtpreauthNoofdays").focus();

            });

            return false;

        }

        else if ((apprequ.toUpperCase() != 'YES') && (implantdata.length > 0 && Totalwardimplantcost > 65000)
            && $('input[name="radio"]:checked').val() == "N"
            && excpHospitalType == '2' && statecode != "21"
            && ($('#txtpreauthNoofdays').val() === "" || $('#txtpreauthNoofdays').val() == 0)
            && $('#txtExcptionType').val() == 'N' && $('#txtExcptionTypeid').val() != 'Y') {

            swal({
                text: "Please Enter No. Of Days !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"

            }).then(function () {

                $("#txtpreauthNoofdays").focus();

            });

            return false;

        }
        else if ((apprequ.toUpperCase() != 'YES') && (highenddrugs.length > 0 && Totalwardhighendcost > 65000)
            && $('input[name="radio"]:checked').val() == "N"
            && excpHospitalType == '2' && statecode != "21"
            && ($('#txtpreauthNoofdays').val() === "" || $('#txtpreauthNoofdays').val() == 0)
            && $('#txtExcptionType').val() == 'N' && $('#txtExcptionTypeid').val() != 'Y') {

            swal({
                text: "Please Enter No. Of Days !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"

            }).then(function () {

                $("#txtpreauthNoofdays").focus();

            });

            return false;

        }

        else if ((apprequ.toUpperCase() != 'YES') && (implantdata.length > 0 && Totalwardimplantcost > 65000)
            && $("#txtDescription").val() == "" && excpHospitalType != '1' && statecode == "21"
            && $('input[name="radio"]:checked').val() == "N" && $('#txtExcptionType').val() == 'N'
            && $('#txtExcptionTypeid').val() != 'Y') {

            swal({

                text: "Please Enter Pre-Auth Description!!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"

            }).then(function () {

                $("#txtDescription").focus();

            });

            return false;

        }
        else if ((apprequ.toUpperCase() != 'YES') && (highenddrugs.length > 0 && Totalwardhighendcost > 65000)
            && $("#txtDescription").val() == ""
            && excpHospitalType != '1' && statecode == "21"
            && $('input[name="radio"]:checked').val() == "N"
            && $('#txtExcptionType').val() == 'N' && $('#txtExcptionTypeid').val() != 'Y') {

            swal({

                text: "Please Enter Pre-Auth Description!!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"

            }).then(function () {

                $("#txtDescription").focus();

            });

            return false;

        }

        else if ((apprequ.toUpperCase() != 'YES') && (implantdata.length > 0 && Totalwardimplantcost > 65000)
            && $("#txtDescription").val() == "" && excpHospitalType == '2' && statecode != "21"
            && $('input[name="radio"]:checked').val() == "N"
            && $('#txtExcptionType').val() == 'N' && $('#txtExcptionTypeid').val() != 'Y') {

            swal({
                text: "Please Enter Pre-Auth Description!!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {

                $("#txtDescription").focus();

            });
            return false;
        }
        else if ((apprequ.toUpperCase() != 'YES') && (highenddrugs.length > 0 && Totalwardhighendcost > 65000)
            && $("#txtDescription").val() == "" && excpHospitalType == '2'
            && statecode != "21" && $('input[name="radio"]:checked').val() == "N"
            && $('#txtExcptionType').val() == 'N' && $('#txtExcptionTypeid').val() != 'Y') {

            swal({
                text: "Please Enter Pre-Auth Description!!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {

                $("#txtDescription").focus();

            });
            return false;
        }
        else if ((apprequ.toUpperCase() == 'YES') && $('input[name="radio"]:checked').val() == "N" && statecode == "21" && ($('#txtpreauthNoofdays').val() === "" || $('#txtpreauthNoofdays').val() == 0)) {

            swal({

                text: "Please Enter No. Of Days !!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtuploadfile").focus();

            });

            return false;

        }

        else if ((apprequ.toUpperCase() == 'YES') && $('input[name="radio"]:checked').val() == "N" && excpHospitalType == '2' && statecode != "21" && ($('#txtpreauthNoofdays').val() === "" || $('#txtpreauthNoofdays').val() == 0)) {

            swal({

                text: "Please Enter No. Of Days !!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtuploadfile").focus();

            });

            return false;

        }

        else if ((apprequ.toUpperCase() == 'YES') && $("#txtDescription").val() == "" && statecode == "21" && $('input[name="radio"]:checked').val() == "N") {

            swal({

                text: "Please Enter Pre-Auth Description!!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtDescription").focus();

            });

            return false;

        }

        else if ((apprequ.toUpperCase() == 'YES') && $("#txtDescription").val() == "" && excpHospitalType == '2' && statecode != "21" && $('input[name="radio"]:checked').val() == "N") {
            swal({
                text: "Please Enter Pre-Auth Description!!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {

                $("#txtDescription").focus();

            });
            return false;
        }

        else if ($("#tblPackageDtls tr").length < 9) {
            swal({
                text: "Please Add Atleast One Package",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {

            });
            return false;

        }

        else if ($("#dtActualAdmission").val() == "") {
            swal({
                text: "Please Enter Actual Admission Date",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {

                $('#dtActualAdmission').focus();

            });
            return false;
        }

        else if ($("#txtDoctorName").val() == "" && statecode == 21) {
            swal({
                text: "Please Enter Doctor Name!!",
               confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {

                $('#txtDoctorName').focus();

            });
            return false;

        }
        else if ($("#txtPatientNo").val() == "" || $("#txtPatientNo").val().length != 10) {
           swal({
                text: "Please Enter Patient Phone No (10 digits)!!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {
                $('#txtPatientNo').focus();
            });
            return false;
        }
        else if (!expr.test(number)) {
            swal({
                text: "Invalid patient phono number.",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {
                $('#txtPatientNo').focus();
            });
            return false;
        }

        else if ($.inArray(extension.toLowerCase(), fileExtension) == -1 && filename.length != 0) {
            swal({
                text: "Please upload a valid file of type pdf, jpeg, jpg !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {
                $('#txtuploadfile').focus();
            });
            return false;

        }
        else if (File > 5242880) {
            swal({
                text: "File size cannot be greater than 5MB !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {

                $('#txtuploadfile').focus();

            });
            return false;
        }

        else if (PhotoFile > 1048576) {
            swal({
                text: "File size cannot be greater than 1MB !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {

                $('#Photo').focus();

            });
            return false;
        }
        else if ($.inArray(photoextension.toLowerCase(), photofileExtension) == -1 && photofilename.length != 0) {
            swal({
               text: "Please upload a valid file of type pdf, jpeg, jpg !!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {
                $('#Photo').focus();
            });
            return false;

        }

        else if ($("#txtBlockingremarks").val() == "") {
            swal({
                text: "Please Enter Blocking Remarks!!",
                confirmButtonColor: "#36A865",
                type: "error",
                confirmButtonText: "OK"
            }).then(function () {
                $('#txtBlockingremarks').focus();
            });
            return false;

        }

        else /*if (window.confirm('Are you sure to block the package？'))*/ {
            swal({
                title: "Are you sure?",
                text: " To block the package!",
                type: "warning",
                showCancelButton: true,
                cancelButtonColor: '#d33',
                confirmButtonColor: "#36A865",
                confirmButtonText: 'Yes'
            }).then(function (isConfirm) {
                if (isConfirm.value) {
                $('#btnBlocking').prop('disabled', true);
                var BlockPkgParams = JSON.stringify({
                    ACTIONCODE: 'A',
                    //Hospital Sections
                    HospitalCode: '@Session["HospitalCode"]',
                    HospitalName: '@Session["HospitalName"]',
                    MemberStateName: '@Session["HospitalState"]',
                    MemberStateCode: '21',
                    DistrictName: '0',
                    HospitalAuthorityCode: '@Session["HospitalauthorityId"]',
                   MemberDistrictCode: '@Session["Hospitaldistrictcode"]',
                    Hospitalstatecode: '@Session["STATECODE"]',
                    Hospitaldistrictcode: '@Session["Hospitaldistrictcode"]',
                    HospitalCategoryId: '@Session["HospitalCategoryId"]',
                   //no entry
                    MemberDistrictName: $('#patientName').val(),
                    MemberBlockCode: $('#patientName').val(),
                    MemberBlockName: $('#patientName').val(),
                    MemberVillageName: $('#patientName').val(),
                    MemberVillageCode: $('#patientName').val(),
                    //no entry

                    //Patient Informations
                    URN: $('#lblURNNo').text(),
                    MemberID: $('#spnPatientMemberId').text(),
                   AadhaarNo: $('#spnPatAadhar').text(),
                    policystartdate: $('#spnPolFrmDate').text(),
                    PolicyEndDate: $('#spnPolToDate').text(),
                    PatientName: $('#spnPatientName').text(),
                    PatientContactNumber: $('#txtPatientNo').val(),
                    PatientCardGender: $('#spnPatientGender').text(),
                    PatientCardAge: $('#spnPatientAge').text(),
                    Description: $('#txtDescription').val(),
                    Doctorname: $('#txtDoctorName').val(),
                    Doctorphno: $('#txtDrPhoneNo').val(),
                    // HeadMemberID: $('#patientName').val(),

                    // HeadMemberName: $('#patientName').val(),

                    mortality: 'N',
                    mortalitysummary: 'Not required',
                    Remarks: $('#txtBlockingremarks').val(),
                    AmoutBlocked: fn_ValReplace($('#sum').text()),
                    ReferalCode: $('#txtRefCode').val(),
                    OverrideCode: $('#txtOverrideCode').val(),
                    userID: '@Session["UserID"]',
                    DATEOFADMISSION: $('#dtActualAdmission').val(),
                    AuthenticationMode: $('#AuthenticationMode').val(),
                    IsEmergency: $('input[name="radio"]:checked').val(),
                    VerifiedMemberID: $('#VerifyMemeberId').val(),
                    VerifiedMemberName: $('#VerifyMemeberName').val(),
                    //IsMedSergical: $('#txtRefCode').text(),

                    PreAuthNoofDays: $('#txtpreauthNoofdays').val(),
                    //IsVerified: $('input[name="radio"]:checked').val(),// to be check
                    IsVerified: $('input:radio.patientotp:checked').val(),// to be check
                    parenttransactionid: $('#hdnParentpatientId').val(),

                    // Vital Parameters
                    VitalParams: vitaldata,
                    // Package Parametes
                    Packageparametermodel: Pacakagedata,
                    // Implant Parameters
                    Implantparams: implantdata,
                   // Highend drughs Parametes
                    Highenddrugsparams: highenddrugs,

                });
                var formData = new FormData();
                if (Motalityfiles.length > 0) { formData.append("FileData", Motalityfiles[0]); }
                if (Photofiles.length > 0) { formData.append("PhotoFile", Photofiles[0]); }
                formData.append("alldata", BlockPkgParams);
                $.ajax({
                    /*  url: ServiceURL + "/api/BlockPackage/addPatientBlockPackageInsertion",*/
                    type: "POST",
                    url: '@Url.Action("addPatientBlockPackageInsertion", "BlockPackage")',
                    data: formData,
                    dataType: "json",
                    contentType: false,
                    processData: false,
                    beforeSend: function () {

                        $("#loader").show();

                        $('#btnBlocking').prop('disabled', true);

                    },
                    success: function (data) {

                        console.log(data);

                        if (data.data.Result.length > 0 && data.data.Result[0].STATUS != 100 && data.data.Result[0].ADMISSIONFLAG == 1) {

                            swal({

                                title: "Block Package", text: "Save Successfully,    Your Case No is: " + data.data.Result[0].CASENO + "", confirmButtonColor: "#36A865", type: "success",

                                //text: "Your Case No is:" + data.data.Result[0].CASENO +""

                            }).then(function () {

                                var BlockpackageSlip = [];

                                if (localStorage.getItem('InsertedData') != null) {

                                    localStorage.removeItem('InsertedData');

                                }



                                BlockpackageSlip.push(JSON.stringify({

                                    TRANSACTIONID: data.data.Result[0].TRANSACTIONID,

                                    INVOICE: data.data.Result[0].INVOICE,

                                    URN: data.data.Result[0].URN

                                }));

                                localStorage.setItem('InsertedData', BlockpackageSlip);

                                windowBlockpackageSlipPopUp();



                            });

                        }

                        else if (data.data.Result.length > 0 && data.data.Result[0].STATUS != 401 && data.data.Result[0].STATUS != 100 && data.data.Result[0].ADMISSIONFLAG == 0) {

                            swal({

                                title: "Block Package", text: "Save Successfully,    Your Case No is: " + data.data.Result[0].CASENO + "", confirmButtonColor: "#36A865", type: "success",

                            }).then(function () {

                                window.location.href = '@Url.Action("ViewBlockPackageDetails", "BlockPackage")';

                            });

                        }

                        else if (data.data.Result.length > 0 && data.data.Result[0].STATUS == 100) {

                            swal({

                                title: "", text: "Insufficient Fund", type: "error", confirmButtonColor: "#36A865", confirmButtonText: "OK"

                            }).then(function () {

                                window.location.reload();

                            });

                        }
                        else if (data.data.Result.length > 0 && data.data.Result[0].STATUS == 401 && data.data.Result[0].ADMISSIONFLAG == 0) {

                            swal({

                                title: "", text: "Insufficient Fund,Please Remove Some Package", type: "error", confirmButtonColor: "#36A865", confirmButtonText: "OK"

                            }).then(function () {
                                $('#btnBlocking').prop('disabled', false);
                            });

                        }

                        else {

                            swal({

                                title: "Block Package", text: "Save Un Successfull", type: "error", confirmButtonColor: "#36A865", confirmButtonText: "OK"

                            }).then(function () {

                                window.location.reload();

                            });

                        }

                    },
                    complete: function () {

                        $("#loader").hide();

                    },
                    error: function (error) {

                        //$('#divLoader').hide();

                        console.log(error.statusText);

                    }
                });
            }
          });
        }
    };

    $("#txtpreauthNoofdays").on("input", function () {

        if (/^0/.test(this.value)) {

            this.value = this.value.replace(/^0/, "")

        }

    })

    function windowBlockpackageSlipPopUp() {

       // window.location.reload();

        var url = '@Url.Action("ViewBlockingSlip", "BlockPackage")';

        var width = 1200;

        var height = 700;

        var left = (screen.width - width) / 2;

        var top = (screen.height - height) / 2;

        var params = 'width=' + width + ', height=' + height;

        params += ', top=' + top + ', left=' + left;

        params += ', directories=no';

        params += ', location=no';

        params += ', menubar=no';

        params += ', resizable=no';

        params += ', scrollbars=yes';

        params += ', status=no';

        params += ', toolbar=no';

        newwin = window.open(url, 'windowname5', params);

         window.location.href = '@Url.Action("ViewBlockPackageDetails", "BlockPackage")';

        if (window.focus) { newwin.focus() }

            return false;

            //window.location.reload();

    }
    function ClearBlockPackages() {

        window.location.href = '@Url.Action("ViewBlockPackage", "BlockPackage")';

    }
    function CloseBlockPackages() {

        window.location.href = '@Url.Action("Index", "Dashboard")';

    }
    function AdmissionDetailsReset() {

        $('#dtActualAdmission').val("");

        $('#txtDoctorName').val("");

        $('#txtDrPhoneNo').val("");

        $('#txtPatientNo').val("");

        $('#txtOverrideCode').val("");

        $('#txtRefCode').val("");

        $('#txtRefCode').val("");

        $('#txtDescription').val("");

        $('#txtBlockingremarks').val("");

    }
    function checkProcIsExist(procCode) {
        let PrevPckg = $('#hdnPrevPckgList').val();
        console.log(PrevPckg);
        var hasMatch = false;
        var isPackExtn = 'NO';
        var arr = $.parseJSON(PrevPckg); //convert to javascript array
        for (var index = 0; index < arr.length; index++) {
            if (arr[index].procedurecode == procCode) {
                if (arr[index].packageextention == 'N') {
                    hasMatch = true;
                    isPackExtn = arr[index].packageextention;
                    break;
                }
            }
        }
        if (hasMatch == true) {
            swal({
                title: "You have already selected this package,Please select another package!",
                icon: "error",
                type: "error",
                confirmButtonColor: "#36A865",
                confirmButtonText: "OK"
            });
            $("#popmodalDtls").modal('hide');
            ClearControls();
        }

    }

     //Added by Niranjan Poddar on 29-03-2023

    function getPrevBlockedPackageList() {

        var paramPrev = {

            hoscode: '@Session["HospitalCode"]',

            urnno: $('#lblURNNo').text(),

            memid: $('#spnPatientMemberId').text(),



        };

        $.ajax({

            url: ServiceURL + "/api/Common/GetPrevBlockedPackage",

            type: "GET",

            data: paramPrev,

            dataType: "json",

            contentType: "application/json; charset=utf-8",

            success: function (data) {

                var result = data;

                $("#hdnPrevPckgList").val(JSON.stringify(result));

                console.log('Hidden Fieled Value');

                console.log($('#hdnPrevPckgList').val());

                //if (result.find(x => x.procedurecode === 'BM005B')) {

                //    console.log('Exists!');

                //}

                //else {

                //    console.log('Not Exists!');

                //}

                //for (const key in result) {

                //    console.log(result[key]);

                //}

                //console.log(result);

            },

            error: function (error) {

                console.log(error.responseText);

                // $('#DvPatientInfo').hide();

            }

        });

    }
    function getPrevPackageDetails() {

        var prevpackparam = {

            Action: 'B',

            hoscode: '@Session["HospitalCode"]',

            urnno: $('#lblURNNo').text(),

            memid: $('#spnPatientMemberId').text(),

            trnsid: 183

        };

        $.ajax({

            url: ServiceURL + "/api/Common/AllPrevPackageDetails",

            type: "GET",

            data: prevpackparam,

            dataType: "json",

            contentType: "application/json; charset=utf-8",

            success: function (data) {

                var result = data;



                if (result != null) {

                    $("#btnPrevBooked").attr('style', 'display:block');

                    var defaultmessage = "No Record(s) Found!";

                    // var thisHtml = "";

                    var oTable = $('#tblPrevPackageDtls').DataTable({

                        "language": {

                            "emptyTable": defaultmessage

                        },

                        destroy: true,

                        lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],

                    });

                    //oTable.buttons().container().appendTo('.indicatorslist');



                    oTable.row().clear().draw();

                    var result = data;

                    for (var i = 0; i < data.length; i++) {

                        oTable.row.add([(i + 1),

                        '<a href="#" data-id="' + result[i].packageheaderid + '">' + result[i].packagename + '</a >', result[i].packagesubcategoryname, result[i].procedurename, '<span class="totblckamt" value="' + result[i].amountblocked + '">' + result[i].amountblocked + '</span>'

                        ]).draw();

                    }



                }

                else {

                    $("#btnPrevBooked").attr('style', 'display:none');

                }



            },

            error: function (error) {

                console.log(error.responseText);

                // $('#DvPatientInfo').hide();

            }

        });

        calc_totalView();

}
    function bindPackageHeaderDetils() {

        // //debugger;

        // var UrNo = $("#urnNo").val() != "" ? $("#urnNo").val():'';



        $.ajax({

            url: ServiceURL + "/api/Common/GetPackageHeaderList",

            type: "GET",

            data: { Action: "A" },

            dataType: "json",

            contentType: "application/json; charset=utf-8",

            success: function (data) {

                var result = data;

                var defaultmessage = "No Record(s) Found!";

                // var thisHtml = "";

                var oTable = $('#tblpackageheader1').DataTable({

                    "language": {

                        "emptyTable": defaultmessage

                    },

                    destroy: true,

                    lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],

                });

                //oTable.buttons().container().appendTo('.indicatorslist');



                oTable.row().clear().draw();

                var result = data;

                for (var i = 0; i < data.length; i++) {

                    oTable.row.add([(i + 1),

                    '<a href="#" onclick="EnumeratorView(this);" data-id="' + result[i].packageheaderid + '">' + result[i].packageheadercode + '</a ><input type="hidden" class="clsPckId" value="' + result[i].packageheaderid + '" />', result[i].packageheader, '<input type="button" id="btnBlockPack" data-id="' + result[i].packageheaderid + '" cursor="pointer" value="Select" class="btn btn-sm btn-outline-success btnHeader" /> '

                    ]).draw();

                }

            },

            error: function (error) {

                console.log(error.responseText);

                // $('#DvPatientInfo').hide();

            }

        });

        //$("#loader").addClass("loaderdeactive");

    }

    $('#tblPackageDetails1 tbody').on('click', '.btnDtlPack', function () {

        var $tr = $(this).closest('tr');
        var rowData = $('#tblPackageDetails1').DataTable().row($tr).data();
        $("#txtSubPackage").val(rowData[3]);
        $("#txtPackageDetails").val(rowData[4]);
        $("#txtTreatCost").val(rowData[6]);
        var ProcCod = rowData[5];
        checkProcIsExist(ProcCod);
        var isApprovalRequired = rowData[8];
        var statecode = '@Session["STATECODE"]';
        if (isApprovalRequired.toUpperCase() == "YES" && $('input[name="radio"]:checked').val() == "N" && statecode == "21") {
            swal({

                title: "Package needs pre-approval",

                icon: "info",

                type: "warning",

                confirmButtonColor: "#36A865",

                confirmButtonText: "OK"

            }).then((result) => {

                if (result.value) {

                    if (parseInt(rowData[7]) == "99") {

                        $("#txtTreatDays").val('1');

                    }

                    else {

                        $("#txtTreatDays").val(parseInt(rowData[7]));

                    }



                    //$("#txtTreatDays").val('0'); // Added-2

                    var aprvrequrired = $(this).parents('tr').find('.clsIsPreApprove').val();

                    var subpackid = $(this).parents('tr').find('.clssubpackid').val();

                    var packdtlsId = $(this).parents('tr').find('.clsPckdtlId').val();

                    var subcatcode = $(this).parents('tr').find('.clssubpackcode').val();

                    var proccode = $(this).parents('tr').find('.clsProccode').val();

                    var staytype = $(this).parents('tr').find('.clsstaytype').val();

                    var daycare = $(this).parents('tr').find('.clsdaycare').val();

                    var maxdays = $(this).parents('tr').find('.clsMaxdays').val();

                    var isImplantReq = $(this).parents('tr').find('.clsIsImplant').val();

                    //var preauthsts = $(this).parents('tr').find('.clsPckdtlId').val();

                    var IsExceptional = $(this).parents('tr').find('.clsExcpnFlag').val();

                    var packCategoryType = $(this).parents('tr').find('.clsPckCattype').val();



                    var IsPackagePriceEdit = $(this).parents('tr').find('.hdnpriceeditbl').val();

                    if (IsPackagePriceEdit == 'Y') {

                        $("#txtwardcost").removeAttr('disabled');

                    }

                    else {

                        $("#txtwardcost").attr('disabled', 'disabled');

                    }



                    $("#PackageApproveRequired").val(aprvrequrired);

                    $("#hdnSubpackId").val(subpackid);

                    $("#hdnPackDtlsId").val(packdtlsId);

                    $("#popmodalDtls").modal('hide');



                    $("#hdnsubpackcode").val(subcatcode);

                    $("#hdnProcCode").val(proccode);

                    $("#hdnstaytype").val(staytype);

                    $("#hdndaycare").val(daycare);

                    $("#lblDaycare").html(daycare);

                    $("#hdnMaxdays").val(maxdays);

                    $("#lblPackPrice").html(rowData[6]);

                    $("#lblStayType").html(staytype);

                    $("#lblMaximumDays").html(maxdays);

                    //Added by Niranjan on 22-02-23

                    $("#hdnIsImplReq").val(isImplantReq);

                    $("#lblExcptionType").html(IsExceptional);

                    $("#hdnPackCategoryType").val(packCategoryType);



                    $("#hdnIsPackPriceEdit").val(IsPackagePriceEdit);

                    $("#lblIsPackPriceEdit").html(IsPackagePriceEdit);



                    getWardList(proccode);



                    $('#txtTreatDays').attr('max', parseInt(maxdays));

                    $("#txtwardcost").val('');

                    //Added by niranjan on 10-02-2023

                    calculateTotalPackageCostTop();

                }

            });

        }

        else {

            if (parseInt(rowData[7]) == "99") {

                $("#txtTreatDays").val('1');

            }

            else {

                $("#txtTreatDays").val(parseInt(rowData[7]));

            }



            //$("#txtTreatDays").val('0'); // Added-2

            var aprvrequrired = $(this).parents('tr').find('.clsIsPreApprove').val();

            var subpackid = $(this).parents('tr').find('.clssubpackid').val();

            var packdtlsId = $(this).parents('tr').find('.clsPckdtlId').val();

            var subcatcode = $(this).parents('tr').find('.clssubpackcode').val();

            var proccode = $(this).parents('tr').find('.clsProccode').val();

            var staytype = $(this).parents('tr').find('.clsstaytype').val();

            var daycare = $(this).parents('tr').find('.clsdaycare').val();

            var maxdays = $(this).parents('tr').find('.clsMaxdays').val();

            var isImplantReq = $(this).parents('tr').find('.clsIsImplant').val();

            //var preauthsts = $(this).parents('tr').find('.clsPckdtlId').val();

            var IsExceptional = $(this).parents('tr').find('.clsExcpnFlag').val();

            var packCategoryType = $(this).parents('tr').find('.clsPckCattype').val();



            var IsPackagePriceEdit = $(this).parents('tr').find('.hdnpriceeditbl').val();

            if (IsPackagePriceEdit == 'Y') {

                $("#txtwardcost").removeAttr('disabled');

            }

            else {

                $("#txtwardcost").attr('disabled', 'disabled');

            }

            //alert(IsPackagePriceEdit);



            $("#PackageApproveRequired").val(aprvrequrired);

            $("#hdnSubpackId").val(subpackid);

            $("#hdnPackDtlsId").val(packdtlsId);

            $("#popmodalDtls").modal('hide');



            $("#hdnsubpackcode").val(subcatcode);

            $("#hdnProcCode").val(proccode);

            $("#hdnstaytype").val(staytype);

            $("#hdndaycare").val(daycare);

            $("#lblDaycare").html(daycare);

            $("#hdnMaxdays").val(maxdays);

            $("#lblPackPrice").html(rowData[6]);

            $("#lblStayType").html(staytype);

            $("#lblMaximumDays").html(maxdays);

            $("#lblExcptionType").html(IsExceptional);

            //Added by Niranjan on 22-02-23

            $("#hdnIsImplReq").val(isImplantReq);

            $("#hdnPackCategoryType").val(packCategoryType);



            $("#hdnIsPackPriceEdit").val(IsPackagePriceEdit);

            $("#lblIsPackPriceEdit").html(IsPackagePriceEdit);

            getWardList(proccode);



            $('#txtTreatDays').attr('max', parseInt(maxdays));

            $("#txtwardcost").val('');

            //Added by niranjan on 10-02-2023

            calculateTotalPackageCostTop();

        }

    });
    $("#tblpackageheader1").on('click', '.btnHeader', function () {

        // get the current row

        ////debugger;

        //Added on 10-02-2023

        $("#txtpackageheader").val(packageHeader);

        $("#hdnCurrentPackheader").val('');

        $("#txtSubPackage").val('');

        $("#txtPackageDetails").val('');



        //$("#loader").addClass("loaderactive");

        var currentRow = $(this).closest("tr");

        var packageHeaderCode = currentRow.find("td:eq(1)").text();

        var packageHeader = currentRow.find("td:eq(2)").text();

        var packageId = $(this).parents('tr').find('.clsPckId').val();



        $("#txtpackageheader").val(packageHeader);

        $("#hdnCurrentPackheader").val(packageId);

        $("#hdnheadercode").val(packageHeaderCode);



        if ($('#spnPatAdmissionStatus').text() == "ADMITTED") {



            console.log("PackHeader", $("#hdnheadercode").val()); // true



            const AccessPackageHeaderCode = ["MR"];



            const isInPackHeaderArray = AccessPackageHeaderCode.includes(packageHeaderCode);

            console.log("IsActivePackHeader", isInPackHeaderArray); // true



            if (isInPackHeaderArray) {

                swal({

                    icon: 'warning',

                    type: 'warning',

                    title: $("#spnPatientName").text(),

                    text: 'You have already selected MR package in other hospital.',

                    confirmButtonColor: "#36A865",

                    confirmButtonText: "OK"

                }).then(function () {

                    ClearControls();

                });

                //return false;

            }

        }

        if (packageHeaderCode == 'MR') {

            checkPackageIsExist(packageHeaderCode);

        }



        getPackageDetails();

        //$("#loader").addClass("loaderdeactive");

        $("#popmodal").modal('hide');

    });
    function getPackageDetails() {

        ////debugger;



        var PackCatagoryParams = {

            Action: 'C',

            headerid: $("#hdnCurrentPackheader").val(),

            hostype: '@Session["HospitalCategoryId"]',

            excpHostype: '@Session["exceptionhospital"]',

            hosCode: '@Session["HospitalCode"]',
            IsEmergency: $('input[name="radio"]:checked').val()

        };

        $.ajax({

            url: ServiceURL + "/api/Common/AllGetPackageDetails",

            type: "GET",

            data: PackCatagoryParams,

            dataType: "json",

            async:false,

            contentType: "application/json; charset=utf-8",

            success: function (data) {

                var result = data;

                var defaultmessage = "No Record(s) Found!";

                // var thisHtml = "";

                var oTable = $('#tblPackageDetails1').DataTable({

                    "language": {

                        "emptyTable": defaultmessage

                    },

                    destroy: true,

                    lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],

                });

                //oTable.buttons().container().appendTo('.indicatorslist');



                oTable.row().clear().draw();

                var result = data;

                //console.log("hdnpriceeditable", result);

                for (var i = 0; i < data.length; i++) {

                    //console.log("hdnpriceeditable", result[i].priceeditable);

                    oTable.row.add([(i + 1),

                        '<a href="#" data-id="' + result[i].packageheaderid + '">' + result[i].packageheadername + '</a ><input type="hidden" class="clsPackExtn" value="' + result[i].packageextention + '" /><input type="hidden" class="clsPckCattype" value="' + result[i].packagecatagorytype + '" /><input type="hidden" class="clsExcpnFlag" value="' + result[i].packageexceptionflag + '" /><input type="hidden" class="clsPckdtlId" value="' + result[i].procedureid + '" /><input type="hidden" class="clssubpackid" value="' + result[i].packagesubcatagoryid + '" /><input type="hidden" class="clssubpackcode" value="' + result[i].packagesubcode + '" /><input type="hidden" class="clsProccode" value="' + result[i].procedurecode + '" /><input type="hidden" class="hdnpriceeditbl" value="' + result[i].priceeditable + '" /><input type="hidden" class="clsstaytype" value="' + result[i].staytype + '" /><input type="hidden" class="clsdaycare" value="' + result[i].daycare + '" /><input type="hidden" class="clsIsPreApprove" value="' + result[i].mandatorypreauth + '" /><input type="hidden" class="clsMaxdays" value="' + result[i].maximumdays + '" /><input type="hidden" class="clsIsImplant" value="' + result[i].implantexist + '" />', result[i].packagesubcode, result[i].subpackagename, result[i].proceduredescription, result[i].procedurecode, result[i].amount, result[i].maximumdays, result[i].mandatorypreauth, '<input type="button" id="btnselectPack" data-id="' + result[i].procedureid + '" cursor="pointer" value="Select" class="btn btn-sm btn-outline-success btnDtlPack" />'

                    ]).draw();

                }

            },

            error: function (error) {

                console.log(error.responseText);

                // $('#DvPatientInfo').hide();

            }

        });

    }
    $('#tblPackageDtls tbody').on('click', '.btndeletePck', function () {
      //  debugger;
        var currentrow = $(this).closest("tr");
        var procedureid = $("#hdnPackDtlsId").val();
        swal({
            title: "Are you sure?",
            text: "You want to delete selected items.",
            type: "warning",
            showCancelButton: true,
            cancelButtonColor: '#d33',
            confirmButtonColor: "#36A865",
            confirmButtonText: 'Yes'
        }).then(function (isConfirm) {
            if (isConfirm.value) {
                var packageprocedurecode = currentrow.find('td:eq(2)').text();
                var data1 = Pacakagedata;
                for (var i = 0; i < data1.length; i++) {
                if (data1[i].procedurecode == packageprocedurecode) {
                    data1 = jQuery.grep(data1, function (value) {
                        return value != data1[i];
                    });
                    Pacakagedata = data1;
                }
            }
            currentrow.next().remove();
            currentrow.remove();
            calc_total();
            CalculateImpHighDrugsTotAmt();
            CalculateTotalPackageCost();
                ClearPackagesControls();
                if (implantdata.length > 0) {
                    for (var i = 0; i < implantdata.length; i++) {
                        if (implantdata[i].ProcCode == packageprocedurecode) {
                            implantdata = jQuery.grep(implantdata, function (value) {
                                return value != implantdata[i];
                            });

                        }
                        implantdata = implantdata;
                    }
                }
                var data1 = highenddrugs;
                if (data1.length > 0) {
                    for (var i = 0; i < data1.length; i++) {
                        if (data1[i].ProcCode == packageprocedurecode) {
                            data1 = jQuery.grep(data1, function (value) {
                                return value != data1[i];
                            });

                        }

                        highenddrugs = data1;

                    }
                }

                $("#preauthspanid").hide();
                $("#preauthspandays").hide();
                $("#preauthspandesc").hide();
                $('#tblPackageDtls tr').each(function () {
                    var preauthid = $(this).find('td').eq(10).text().trim();
                    if (preauthid.toUpperCase() == 'YES') {
                        $("#preauthspanid").show();
                        $("#preauthspandays").show();
                        $("#preauthspandesc").show();
                        //console.log('preauthid', preauthid);
                    }
                    if (preauthid.toUpperCase() != 'YES') {
                        var wardcost = $(this).find('td').eq(7).text().trim();
                        var implantcost = $(this).find('td').eq(8).text().trim();
                        var highendcost = $(this).find('td').eq(9).text().trim();
                        var implanttotal = parseFloat(fn_ValReplace(wardcost)) + parseFloat(fn_ValReplace(implantcost));
                        var highendtotal = parseFloat(fn_ValReplace(wardcost)) + parseFloat(fn_ValReplace(highendcost));
                        if (implanttotal > 65000) {
                            $("#preauthspanid").show();
                            $("#preauthspandays").show();
                            $("#preauthspandesc").show();
                        }
                        else if (highendtotal > 65000) {
                            $("#preauthspanid").show();
                            $("#preauthspandays").show();
                            $("#preauthspandesc").show();
                        }
                        else {
                            $("#preauthspanid").hide();
                            $("#preauthspandays").hide();
                            $("#preauthspandesc").hide();
                        }

                    }


                });
            };

        });

    });


    function packagedataduplicate() {

        // debugger;

        var flag = true;

        $('#tblPackageDtls tr').each(function () {

            if ($(this).closest("tr").find('td:eq(2)').text() != "" && ($(this).closest("tr").find('td:eq(2)').text() == $("#hdnProcCode").val())) {

                swal({

                    text: "Package already added!!",

                    confirmButtonColor: "#36A865",

                    type: "error",

                    confirmButtonText: "OK"

                });

                flag = false;

                return false;

            }

        });

        return flag;

    }
    $("#btnAddPackage").click(function () {
        if (ValidateNewPackage() != false) {
            var returnvalue = packagedataduplicate();
            if (returnvalue === false) {
                $("#btnAddPackage").prop("value", "Add Package");
                $('#btnAddPackage').removeAttr('disabled');
                return false;
            }
            else {

                $("#btnAddPackage").prop("value", "Adding..");
                $('#btnAddPackage').attr('disabled', 'disabled');
                var recno = parseInt($("#tblPackageDtls > tbody > tr").length, 10) + 1;
                var PackHeader = $("#txtpackageheader").val();//$('#dlPackage').find(":selected").text();
                var SubPackage = $('#txtSubPackage').val();
                var packageDtls = $("#txtPackageDetails").val(); //$('#dlPackageDtls').find(":selected").text();
                var TreatCost = $("#txtTreatCost").val();
                var TreatDays = $("#txtTreatDays").val();
                var IsApprvRqr = $("#PackageApproveRequired").val();
                $('#txtExcptionType').val($('#lblExcptionType').html());
                if ($('#lblExcptionType').html() == 'Y') {
                    $('#txtExcptionTypeid').val($('#lblExcptionType').html());
                }
                if ($('#lblExcptionType').html() == 'N')
                {
                    if (fn_ValReplace($("#txtPackageCost").val()) > 65000) {
                        IsApprvRqr = 'YES';
                    }
                    else {
                        IsApprvRqr = 'NO';
                    }
                }
               var statecode = '@Session["STATECODE"]';
               var excpHospitalType = '@Session["exceptionhospital"]';//0
                if (excpHospitalType != '') {
                    if (excpHospitalType == '1') {
                            IsApprvRqr = 'NO';
                    }
                    else if (excpHospitalType == '2') {
                        if ($("#hdnProcCode").val() != 'US001A') {
                            IsApprvRqr = 'NO';
                        }
                        else {
                            IsApprvRqr = 'YES';
                        }
                    }
                    else if (excpHospitalType == '0') {
                        if ($('#lblExcptionType').html() == 'N') {
                            if (fn_ValReplace($("#txtPackageCost").val()) > 65000) {
                                IsApprvRqr = 'YES';
                            }
                            else {
                                IsApprvRqr = $("#PackageApproveRequired").val();
                            }
                        }
                        else {
                            IsApprvRqr = $("#PackageApproveRequired").val();
                        }
                    }
                }
                var packid = $("#hdnCurrentPackheader").val();
                var subpackid = $("#hdnSubpackId").val();
                var packdtlsid = $("#hdnPackDtlsId").val();
                var subpackcode = $("#hdnsubpackcode").val();
                var procCode = $("#hdnProcCode").val();
                var styType = $("#hdnstaytype").val();
                var daycare = $("#hdndaycare").val();
                var wardName = $('#ddlWard').find(":selected").text()
                var wardId = $('#ddlWard').find(":selected").val();
                var wardCost = $("#txtwardcost").val();
                var totalPackCost = $("#txtPackageCost").val();
                var headercode = $("#hdnheadercode").val();
                var ImplReqPack = $("#hdnIsImplReq").val();
                var IsException = $("#lblExcptionType").html();
                var isPackVariableType = $("#hdnPackCategoryType").val();
                if (isPackVariableType.toUpperCase() == 'REFERRAL' && $('#txtRefCode').val() == "" && statecode == "21" && excpHospitalType != '1' && $('input[name="radio"]:checked').val() == "N") {
                   swal({
                        title: "Referral Code required for this package!",
                        icon: "error",
                        type: "error",
                        confirmButtonColor: "#36A865",
                        confirmButtonText: "OK"
                    });
                    return false;
                }
                var htmTable = "<tr>";
                htmTable += "<td>" + PackHeader + "<input type='hidden' id='hdnExcpType' class='ExcpTypeCls' name='ExcpType' value='" + IsException + "'/></td>";
                htmTable += "<td>" + SubPackage + "</td>";
                htmTable += "<td data-toggle='tooltip' data-placement='bottom' data-original-title='Tooltip on bottom' class='red-tooltip' title='" + packageDtls + "'>" + procCode + "</td>";
                htmTable += "<td class='total'>" + parseFloat(TreatCost).toFixed(2) + "</td>";
                htmTable += "<td class='total1'>" + TreatDays + "</td>";
                htmTable += "<td class='wrdname'><input type='hidden' id='hdnwardid' name='wrdId' value='" + wardId + "'/>" + wardName + "</td>";
                htmTable += "<td class='wardcost'>" + parseFloat(wardCost).toFixed(2) + "</td>";
                htmTable += "<td class='totpackcost'>" + fn_ValReplace(totalPackCost) + "</td>";
                htmTable += "<td class='implCost" + recno + " imptotal'>0.00</td>";
                htmTable += "<td class='highendCost" + recno + " hedcost'>0.00</td>";
                htmTable += "<td class='isPackAuthReq" + recno + "'>" + IsApprvRqr + "</td>";
                var htmImpl = '';
                if (ImplReqPack == "Y") {

                    htmImpl = "<button type='button' class='btn btn-sm btn-outline-success btncallImplant mr-2' data-toggle='modal' ><i class='fa fa-plus'></i> Implant  </button>";

                }

                else {

                    htmImpl = "<button type='button' style='cursor:not-allowed;' class='btn btn-sm btn-outline-warning mr-2' data-toggle='modal' ><i class='fa fa-plus'></i> Implant  </button>";

                }

                //Check if Ward Routine

                var htmHed = '';

                if (wardName != "Routine Ward") {



                    htmHed = "<button type='button' class='btn btn-sm btn-outline-success btncallHedrugs mr-2 mt-2' data-toggle='modal'><i class='fa fa-plus'></i> HighEndDrugs </button>";

                }

                else {

                    if (procCode == 'MG069A' || procCode == 'MG090B' || procCode == 'MG092B') {

                        htmHed = "<button type='button' class='btn btn-sm btn-outline-success btncallHedrugs mr-2 mt-2' data-toggle='modal'><i class='fa fa-plus'></i> HighEndDrugs </button>";



                        // getHighEndDrugsHED11List(procCode, recno, packid);

                    }

                    else {

                        htmHed = "";

                    }



                }



                htmTable += "<td><input type ='hidden' id ='hdnIsAuthRqrPack" + recno + "' class='myhdnPreAuth" + recno + "' value ='" + IsApprvRqr + "'/><button type='button' class='btn btn-outline-danger btn-sm btndeletePck mr-2'><i class='fa fa-trash'></i></button><button type='button' class='btn btn-outline-success btn-sm mr-2' data-toggle='collapse' data-target='#demo" + recno + "'><i class='fa fa-eye'></i> </button>" + htmImpl + "" + htmHed + "<input type='hidden' class='clsPckId' value=" + packid + " /><input type='hidden' class='clsSubPckId' value=" + subpackid + " /><input type='hidden' class='clsPckdtlsId' name='hdnclsProcId' value=" + packdtlsid + " /></td>";



                htmTable += "</tr>";
                var thisHtml = "<tr id='trv" + recno + "'>";
                thisHtml += "<td colspan='12' class='m-0 p-0 border-0'>";
                thisHtml += "<div class='accordian-body collapse' id='demo" + recno + "'>";
                thisHtml += "<div class='col-lg-12 col-md-12 col-sm-12 col-xs-12 mt-3'>";
                thisHtml += "<div class='headingpkg-bg'> Package Details </div>";
                thisHtml += "<div class='row d-flex align-items-center'>";
                thisHtml += "<div class='col-lg-6 col-md-12 col-sm-12 col-xs-12'>";
                thisHtml += "<div class='impl_head'> Implant Details </div>";
                thisHtml += "</div>";
                thisHtml += "<div class='col-lg-6 col-md-12 col-sm-12 col-xs-12'>";
                thisHtml += "<div class='row d-flex align-items-center'>";
                thisHtml += "<div class='col-lg-7 col-md-7 col-sm-12 col-xs-12'>";
                thisHtml += "<div class='impl_head'> HighEndDrugs Details </div>";
                thisHtml += "</div>";
                thisHtml += "<div class='col-lg-5 col-md-5 col-sm-12 col-xs-12'>";
                thisHtml += "</div>";
                thisHtml += "</div>";
                thisHtml += "</div>";
                thisHtml += "</div>";
                thisHtml += "<div class='row'>";
                thisHtml += "<div class='col-lg-6' id='table-scroll' class='table-scroll table-responsive mb-3 newpkghd'>";
                thisHtml += "<table class='table table-striped tblImplView' id='tblImplantView" + recno + "'>";
                thisHtml += "<thead>";
                thisHtml += "<tr>";
                thisHtml += "<th scope='bg-white text-align-left' style='background-color:#fff !important;'> Implant Name</th>";
                thisHtml += "<th scope='bg-white text-align-center' style='background-color:#fff !important;'> Unit </th>";
                thisHtml += "<th scope='bg-white text-align-right' style='background-color:#fff !important;'> Price </th>";
                thisHtml += "<th scope='bg-white text-align-right' style='background-color:#fff !important;'> Total Price </th>";
                thisHtml += "<th scope='bg-white text-align-right' style='background-color:#fff !important;'> Pre-Auth </th>";
                thisHtml += "<th scope='bg-white text-align-center' style='background-color:#fff !important;'> Action </th>";
                thisHtml += "</tr>";
                thisHtml += "</thead>";
                thisHtml += "<tbody>";
                thisHtml += "<div class='col-lg-6 col-md-12 col-sm-12 col-xs-12 mt-3'>";
                thisHtml += "</tbody>";
                thisHtml += "<tfoot>";
                thisHtml += "<tr>";
                thisHtml += "<td class='font-weight-5'>Total </td>";
                thisHtml += "<td class='font-weight-5'></td>";
                thisHtml += "<td ></td>";
                thisHtml += "<td colspan='2' class='font-weight-5 clsImplTotalInner" + recno + "'></td>";
                thisHtml += "</tr>";
                thisHtml += "</tfoot>";
                thisHtml += "</table>";
                thisHtml += "</div>";
                thisHtml += "<div class='col-lg-6 col-md-12 col-sm-12 col-xs-12 mt-3'>";
                thisHtml += "<div id='table-scroll' class='table-scroll table-responsive mb-3'>";
                thisHtml += "<table id='tblHgDrugsInnerList" + recno + "' class='main-table table table-striped'>";
                thisHtml += "<thead>";
                thisHtml += "<tr>";
                thisHtml += "<th scope=' bg-white  text-align-left' style='background-color:#fff !important;'> HighEndDrugs Name </th>";
                thisHtml += "<th scope=' bg-white text-align-center' style='background-color:#fff !important;'> Unit </th>";
                thisHtml += "<th scope=' bg-white text-align-right' style='background-color:#fff !important;'> Price </th>"; thisHtml += "<th scope=' bg-white text-align-right' style='background-color:#fff !important;'> Total Price </th>";
                thisHtml += "<th scope=' bg-white text-align-right' style='background-color:#fff !important;'> Pre-Auth Required </th>";
                thisHtml += "<th scope=' bg-white text-align-center' style='background-color:#fff !important;'> Action </th>";
                thisHtml += "</tr>";
                thisHtml += "</thead>";
                thisHtml += "<tbody>";
                thisHtml += "</tbody>";
                thisHtml += "<tfoot>";
                thisHtml += "<tr>";
                thisHtml += "<td colspan='1'>Total </td>";
                thisHtml += "<td class='font-weight-5'>&nbsp;</td>";
                thisHtml += "<td>&nbsp;</td>";
                thisHtml += "<td class='font-weight-5 clsHedTotalInner" + recno + "'' colspan='3' ></td>";
                thisHtml += "</tr>";
                thisHtml += "</tfoot>";
                thisHtml += "</table>";
                thisHtml += "</div>";
                thisHtml += "</div>";
                thisHtml += "</div>";
                thisHtml += "</div>";
                thisHtml += "</div>";
                thisHtml += "</td>";
                thisHtml += "</tr>";
                $("#tblPackageDtls").append(htmTable);
                $("#tblPackageDtls").append(thisHtml);
                var d = {

                    "packagesubcategoryid": subpackid,
                    "packagesubcategorycode": subpackcode,
                    "packagesubcategoryname": SubPackage,
                    "procedureid": packdtlsid,
                    "procedurecode": procCode,
                    "procedurename": packageDtls,
                    "staytype": styType,
                    "daycare": daycare,
                    "noofdays": TreatDays,
                    "preauthstatus": IsApprvRqr,
                    "amountblocked": TreatCost,
                    "PackageHeaderCode": headercode,
                    "wardName": wardName,//added on 200223
                    "PackageHeaderName": PackHeader,//added on 200223
                    "PackageHeaderId": packid,
                    "wardid": wardId,
                    "packagecost": fn_ValReplace(totalPackCost),
                    "wardcost": fn_ValReplace(totalPackCost),
                    "totalpackagecost": fn_ValReplace($("#TotalPackageCost").html()),
                    "totalimplcost": 0,
                    "totalhedcost": 0,
                };

                $('#PackageDetails').show();

                $('#PackageGridDetails').show();

                  var statecode = '@Session["STATECODE"]';

                if (statecode == 21) {

                    $("#doctornameid").show();

                   // $("#doctorphnoid").show();

                }

                else {

                    $("#doctornameid").hide();

                   // $("#doctorphnoid").hide();

                }



                if ((IsApprvRqr.toUpperCase() == "YES") && $('#lblExcptionType').html() == 'N' && excpHospitalType != '1' && statecode == "21" && $('input[name="radio"]:checked').val() == "N") {

                    $("#preauthspanid").show();

                    $("#preauthspandays").show();

                    $("#preauthspandesc").show();

                }

                if ((IsApprvRqr.toUpperCase() == "YES")  && statecode != "21" && excpHospitalType =='2' && $('input[name="radio"]:checked').val() == "N") {

                    $("#preauthspanid").show();

                    $("#preauthspandays").show();

                    $("#preauthspandesc").show();

                }



                if ((IsApprvRqr.toUpperCase() == "YES") && statecode != "21" && excpHospitalType != '2') {

                    $("#preauthspanid").hide();

                    $("#preauthspandays").hide();

                    $("#preauthspandesc").hide();

                }



                setTimeout(function () {

                    $("#btnAddPackage").prop("value", "Add Package");

                    $('#btnAddPackage').removeAttr('disabled');

                }, 100);

                $('#AdmissionDetails').show();

                $('#Verifieddetails').show();

                //$("#dtActualAdmission").focus();

               Pacakagedata.push(d);

                console.log('d', d);

                $("#hdnPackages").val(d);



                calc_total();

                ClearControls();

                CalculateTotalPackageCost();

                $('#priviouspckgdetails').show();

            }

        }

    });
    function PrevPackageDetails() {

        var param = {

            URN: $('#lblURNNo').text(),

            MEMBERID: $('#spnPatientMemberId').text(),

            HOSPITALCODE: '@Session["HospitalCode"]'

        };

        $.ajax({

              url: '@Url.Action("PriviousBlockPackafeDtls", "BlockPackage")',

              type: "POST",

              data: param,

            success: function (resultBal) {

                $("#tblPrevPackageDtls").empty();

                if (resultBal.length > 0) {

                    for (var i = 0; i < resultBal.length; i++) {

                        var htm = '';

                        if ($('#tblPrevPackageDtls tr').length == 0) {

                            htm += '<thead><tr> <th>Sl#</th><th>Package Header</th><th>Sub-Package</th><th>Package Details</th><th>Treatment Cost</th></tr></thead>'

                            htm += '<tr> <td> 1 </td><td>' + resultBal[i].PACKAGEHEADER + '</td>'

                            htm += '<td>' + resultBal[i].PACKAGESUBCATEGORY + '</td>'

                            htm += '<td>' + resultBal[i].PROCEDURENAME + '</td>'

                            htm += '<td>' + resultBal[i].TREATMENTCOST + '</td></tr>'

                        }



                        else {

                            htm += '<tr> <td> ' + $('#tblPrevPackageDtls tr').length.toString() + '<td>' + resultBal[i].PACKAGEHEADER + '</td>'

                            htm += '<td>' + resultBal[i].PACKAGESUBCATEGORY + '</td>'

                            htm += '<td>' + resultBal[i].PROCEDURENAME + '</td>'

                            htm += '<td>' + resultBal[i].TREATMENTCOST + '</td></tr>'



                        }

                        $("#tblPrevPackageDtls").append(htm);





                    }

                    $('#PrevPackageModal').modal('show');

                }



                else{

                    $("#tblPrevPackageDtls").append('<h2 style="text-align:center;color:#f00;font-size:18px;">No Record Found</h2>');

                    $('#PrevPackageModal').modal('show');

                    }

             }

        });



    }
    function CalculateTotalPackageCost() {

       // debugger;

        var TotalPackageCost = 0;

        var packagecost = $("#PackSubTotCost").html();

        var TotImplCost = $("#ImplAmt").html();

        var TotHedCost = $("#HighendAmt").html();

        TotalPackageCost = parseFloat(fn_ValReplace(packagecost)) + parseFloat(fn_ValReplace(TotImplCost)) + parseFloat(fn_ValReplace(TotHedCost));

        //$("#TotalPackageCost").html(addCommas(TotalPackageCost));

        $("#TotalPackageCost").html(toIndianCurrency(parseFloat(TotalPackageCost)));

    }
    function fn_ValReplace(val) {

        return val.replace('₹', '').replace(',', '').replace(',', '').replace(',', '');

    }
    const toIndianCurrency = (num) => {
        const curr = num.toLocaleString('en-IN', {

            style: 'currency',

            currency: 'INR'

        });

        return curr;

    };
    $('#tblPackageDtls tbody').on('click', '.btncallImplant', function () {
       // debugger;
        //if (window.confirm('Are you sure to add implant here？')) {

        var $tr = $(this).closest('tr');
        var wardtotalcost = $(this).closest("tr").find('td:eq(7)').text();
        var implanttotalcost = $(this).closest("tr").find('td:eq(8)').text();
        var data = $('#txtimplanttotalwardcost').val(wardtotalcost);
        var implndata = $("#totalimplantcostid").val(implanttotalcost);
        //  var row_index = $(this).parent().index();

        var row_index = $(this).closest("tr").index();

        var finrow = parseInt(row_index) + 1;

        var ProcId = $(this).parents('tr').find('.clsPckdtlsId').val();

        var isException = $(this).parents('tr').find('.ExcpTypeCls').val();

        /*var rowData = $('#tblPackageDtls').DataTable().row($tr).data();*/

        //alert("ProcId" + ProcId);

        var $td = $($tr).find('td');

        //console.log(rowData);

        $("#Addimplantmodal").modal('show');

        $("#lblImpSubTotal").text('0.00');

        getImplantList($td[2].innerText, finrow, ProcId, isException);

        //}

    });

    function getImplantList(prcode, rowid, procId, isExceptionType) {

        $("#lblParentTableId").text(rowid);

        var PackCatagoryParams = {

            Action: 'A',

            proccode: prcode,

            hoscatid:'@Session["HospitalCategoryId"]',

        };

        $.ajax({

            url: ServiceURL + "/api/Common/GetImplantListByProcCode",

            type: "GET",

            data: PackCatagoryParams,

            dataType: "json",

            contentType: "application/json; charset=utf-8",

            success: function (data) {

                var result = data;

                var defaultmessage = "No Record(s) Found!";

                // var thisHtml = "";

                var oTable = $('#tblImplantList').DataTable({

                    "language": {

                        "emptyTable": defaultmessage

                    },

                    destroy: true,

                    bLengthChange: true,

                    bFilter: true,

                    bSort: true,

                    responsive: true,

                    autoWidth: false,

                    bPaginate: true,

                    lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],

                });

                //oTable.buttons().container().appendTo('.indicatorslist');

                oTable.row().clear().draw();

                var result = data;

                for (var i = 0; i < data.length; i++) {



                    oTable.row.add(["<div class='custom-control custom-checkbox'><input type='checkbox' class='custom-control-input checkme' name='selectImpl' id='customCheck" + i + "'><label class='custom-control-label' for='customCheck" + i + "'></label></div><input type='hidden' name='hdnExceptionType' value='" + isExceptionType + "'/><input type='hidden' name='hdnImpUnitPrice' value='" + parseFloat(result[i].unitcycleprice).toFixed(2) + "'/><input type='hidden' name='hdnFlagedit' value='" + result[i].editflag + "'/><input type='hidden' name='hdnProcCode' id='hdnProcCode' value='" + result[i].procedurecode + "'/><input type='hidden' name='hdnProcId' value='" + procId + "'/><input type='hidden' name='hdnImplantName' id='hdnImplantName' value='" + result[i].implantname + "'/><input type='hidden' name='hdnImplantCode' id='hdnImplantId' value='" + result[i].implantcode + "'/></td>", result[i].implantname, "<td class='text-align-center'><input type='number' id='txtUprice' class='form-control txtPriceclass' disabled='true' name='txtimpPrice' maxlength='15' min='0' value=" + parseFloat(result[i].unitcycleprice).toFixed(2) + " onkeypress='return event.charCode >= 48 && event.charCode <= 57'onkeypress='return event.charCode >= 48 && event.charCode <= 57'></td>", result[i].maximumunit, "<td class='text-align-center'><input type='number' id='txtImplAmt' class='form-control txtqytclass' disabled='true' name='txtimpqty' maxlength='3' min='0' oninput='validity.valid || (value = '" + result[i].unit + "');' value=" + result[i].unit + " id='num' onkeypress='return event.charCode >= 48 && event.charCode <= 57'onkeypress='return event.charCode >= 48 && event.charCode <= 57'></td>", "<td class='text-align-right'><input type='text' class='form-control txtImplRowTotal' name='lblRowtotAmt' disabled='true' value='0.00' id='lblTotImplAmt'></td>", "<td class='text-align-right flagedt'><input readonly='readonly' style='border:none;background: rgba(0, 0, 0, 0);' type='text' name='ImpPreAuthCls' value='NO'/></td>"

                    ]).draw();

                }

            },

            error: function (error) {

                console.log(error.responseText);

                // $('#DvPatientInfo').hide();

            }

        });

    }

    $('#tblImplantList tbody').on('change', '.checkme', function () {

        if (this.checked) {

            var $tr = $(this).closest('tr');

            var rowData = $('#tblImplantList').DataTable().row($tr).data();

            let text = "Do you want to add this implant?";

            /*if (confirm(text) == true) {*/

            var unitPrice = $(this).closest("tr").find("input[name=txtimpPrice]").val();

            var editFlag = $(this).closest("tr").find("input[name=hdnFlagedit]").val();

            $(this).closest("tr").find("input[name=selectImpl]").prop('checked', true);

            if ($(this).closest("tr").find("input[name=selectImpl]").is(":checked")) {



                // Kisan Added implant record exsit or not 25-04-23

                var implantcode = $(this).closest("tr").find("#hdnImplantId").val();

                var implantName = $(this).closest("tr").find("#hdnImplantName").val();

                var hasMatch = false;

                for (var index1 = 0; index1 < implantdata.length; index1++) {

                    console.log("implantdata", implantdata[index1]);

                    console.log("implantName", implantName);

                    console.log("implantName", implantcode);

                    if (implantdata[index1].implantcode == implantcode && implantdata[index1].implantname == implantName) {

                        console.log("mr","true");

                        hasMatch = true;

                        break;

                    }

                }



                if (hasMatch == true) {

                    swal({

                        title: "You have already selected this Implant,Please select another Implant!",

                        type: "error",

                        confirmButtonColor: "#36A865",

                        confirmButtonText: "OK"

                    }).then(function () {

                        $tr.find("input[name=selectImpl]").prop('checked', false);

                    });

                    return false;

                }

                // Kisan Added implant record exsit or not 25-04-23



                $(this).closest("tr").find("input[name=txtimpqty]").focus();

                if (editFlag == "1") {

                    $(this).closest("tr").find("input[name=txtimpqty]").removeAttr('disabled');

                    $(this).closest("tr").find("input[name=txtimpPrice]").removeAttr('disabled');

                }

                else if (editFlag == "2") {

                    // $(this).closest("tr").find("input[name=txtimpqty]").removeAttr('disabled');

                    $(this).closest("tr").find("input[name=txtimpPrice]").removeAttr('disabled');

                }

                else if (editFlag == "3") {

                    $(this).closest("tr").find("input[name=txtimpqty]").removeAttr('disabled');

                    //$(this).closest("tr").find("input[name=txtimpPrice]").removeAttr('disabled');

                }

                else if (editFlag == "4") {

                    $(this).closest("tr").find("input[name=txtimpqty]").attr("disabled", "disabled")

                    $(this).closest("tr").find("input[name=txtimpPrice]").attr("disabled", "disabled")

                }



                //Modified on 25-02

                var impqty = $(this).closest("tr").find("input[name=txtimpqty]").val();

                /*alert(rowData[2].replace("₹", "").replace(",",""));*/

                var totalvalue = parseInt(impqty) * parseFloat(unitPrice);

                if (rowData[2] != '--') {

                    totalvalue = parseInt(impqty) * parseFloat(unitPrice);

                }

                else {

                    totalvalue = 0;

                }

                if (parseFloat(totalvalue) > 65000) {

                    //alert('Preapproval is required for this implant.');

                    swal({

                        //position: 'top-end',

                        icon: 'warning',

                        type: '',

                        title: 'Preapproval is required for this implant!',

                        showConfirmButton: false,

                        timer: 1500

                    });

                }

                $(this).closest("tr").find("input[name=lblRowtotAmt]").val(toIndianCurrency(totalvalue));

                CalculateTotalImplantInner();

                // CalculateImplantSubTotal(totalvalue);

            }

            else {

                $(this).closest("tr").find("input[name=txtimpqty]").attr("disabled", "disabled");

            }

        }

        else {

            var orPrice = $(this).closest("tr").find("input[name=hdnImpUnitPrice]").val();

            $(this).closest("tr").find("input[name=txtimpqty]").attr("disabled", "disabled");

            $(this).closest("tr").find("input[name=txtimpPrice]").attr("disabled", "disabled");

            $(this).closest("tr").find("input[name=txtimpPrice]").val(orPrice);

            $(this).closest("tr").find("input[name=ImpPreAuthCls]").val('NO');

            $("#lblImpSubTotal").html(toIndianCurrency(parseFloat(fn_ValReplace($("#lblImpSubTotal").text())) - parseFloat(fn_ValReplace($(this).closest("tr").find("input[name=lblRowtotAmt]").val()))));

            //$(this).closest("tr").find("input[name=txtimpqty]").val('');

            $(this).closest("tr").find("input[name=lblRowtotAmt]").val("0.00");

        }

    });



    $('#tblHgDruglist tbody').on('change', '.chkHed', function () {



        var $tr = $(this).closest('tr');

        var rowData = $('#tblHgDruglist').DataTable().row($tr).data();

        let text = "Do you want to add this implant?";



        if (this.checked) {



            $(this).closest("tr").find("input[name=selectHed]").prop('checked', true);

            if ($(this).closest("tr").find("input[name=selectHed]").is(":checked")) {



                // Kisan Added implant record exsit or not 25-04-23

                var highenddrugscode = $(this).closest("tr").find("input[name=hdnHedCode]").val();

                var highenddrugsName = $(this).closest("tr").find("input[name=hdnHedName]").val();

                var hasMatch = false;

                for (var index1 = 0; index1 < highenddrugs.length; index1++) {

                    console.log("highenddrugsName", highenddrugs[index1].HEDName);

                    if (highenddrugs[index1].HedCode == highenddrugscode && highenddrugs[index1].HEDName == highenddrugsName ) {

                        hasMatch = true;

                        break;

                    }

                }



                if (hasMatch == true) {

                    swal({

                        title: "You have already selected this HED,Please select another HED!",

                        type: "error",

                        confirmButtonColor: "#36A865",

                        confirmButtonText: "OK"

                    }).then(function () {

                        $tr.find("input[name=selectHed]").prop('checked', false);

                    });

                    return false;

                }

                // Kisan Added implant record exsit or not 25-04-23



                var isPriceEdit = $(this).closest("tr").find("input[name=hdnIsEdit]").val();

                var isUnitPrice = $(this).closest("tr").find("input[name=hdnUnitEdit]").val();

                if (isPriceEdit.toUpperCase() == "Y" && isUnitPrice.toUpperCase() == "Y") {

                    $(this).closest("tr").find("input[name=txthedAmt]").removeAttr('disabled');

                    $(this).closest("tr").find("input[name=txthedqty]").removeAttr('disabled');

                    $(this).closest("tr").find("input[name=txthedqty]").val(1);

                    $(this).closest("tr").find("input[name=txthedAmt]").focus();

                }

                else if (isPriceEdit.toUpperCase() == "N" && isUnitPrice.toUpperCase() == "Y") {

                    $(this).closest("tr").find("input[name=txthedAmt]").attr("disabled", "disabled");

                    $(this).closest("tr").find("input[name=txthedqty]").removeAttr('disabled');

                    $(this).closest("tr").find("input[name=txthedqty]").val(1);

                    $(this).closest("tr").find("input[name=txthedqty]").focus();

                }

                else if (isPriceEdit.toUpperCase() == "Y" && isUnitPrice.toUpperCase() == "N") {

                    $(this).closest("tr").find("input[name=txthedqty]").attr("disabled", "disabled");

                    $(this).closest("tr").find("input[name=txthedqty]").val(1);

                    $(this).closest("tr").find("input[name=txthedAmt]").removeAttr('disabled');

                    $(this).closest("tr").find("input[name=txthedAmt]").focus();

                }

                else if (isPriceEdit.toUpperCase() == "N" && isUnitPrice.toUpperCase() == "N") {

                    $(this).closest("tr").find("input[name=txthedAmt]").attr("disabled", "disabled");

                    $(this).closest("tr").find("input[name=txthedqty]").attr("disabled", "disabled");

                    $(this).closest("tr").find("input[name=txthedqty]").val(1);

                    //$(this).closest("tr").find("input[name=txthedAmt]").focus();

                    var impqty = $(this).closest("tr").find("input[name=txthedqty]").val();

                    var hedPrice = $(this).closest("tr").find("input[name=txthedAmt]").val();

                    var totalvalue = parseInt(impqty) * parseFloat(hedPrice).toFixed(2);

                    $(this).closest("tr").find("input[name=lblRowtotHedAmt]").val(totalvalue.toFixed(2));

                    CalculateTotalHedInner();

                }



                //if ($(this).closest("tr").find("input[name=hdnIsEdit]").val() != 'N') {

                //    $(this).closest("tr").find("input[name=txthedAmt]").removeAttr('disabled');

                //}

                //else {

                //    $(this).closest("tr").find("input[name=txthedAmt]").attr("disabled", "disabled");

                //}



                //$(this).closest("tr").find("input[name=txthedqty]").removeAttr('disabled');

                //$(this).closest("tr").find("input[name=txthedqty]").focus();

            }

            else {

                $(this).closest("tr").find("input[name=txthedqty]").attr("disabled", "disabled");

                $(this).closest("tr").find("input[name=txthedAmt]").attr("disabled", "disabled");

            }

        }

        else {

            $(this).closest("tr").find("input[name=txthedqty]").attr("disabled", "disabled");

            $("#lblHedSubTotal").html(toIndianCurrency(parseFloat(fn_ValReplace($("#lblHedSubTotal").text())) - parseFloat($(this).closest("tr").find("input[name=lblRowtotHedAmt]").val())));

            $(this).closest("tr").find("input[name=txthedqty]").val('');

            $(this).closest("tr").find("input[name=lblRowtotHedAmt]").val("0.00");

            $(this).closest("tr").find("input[name=txthedAmt]").attr("disabled", "disabled");



        }

    });



    $('#tblImplantList tbody').on('change', '.txtqytclass', function () {



        var $tr = $(this).closest('tr');

        var rowData = $('#tblImplantList').DataTable().row($tr).data();

        /* var ID = $(this).closest('tr').find('td').eq(3).text();*/

        var impqty = $(this).closest("tr").find("input[name=txtimpqty]").val();

        var impPrice = $(this).closest("tr").find("input[name=txtimpPrice]").val();

        var orgPrice = $(this).closest("tr").find("input[name=hdnImpUnitPrice]").val();

        var isApprvRqr = $(this).closest("tr").find("input[name=ImpPreAuthCls]").val();

        var excType = $(this).closest("tr").find("input[name=hdnExceptionType]").val();

        /*alert(rowData[2].replace("₹", "").replace(",",""));*/

        var totalvalue = parseInt(impqty) * parseFloat(impPrice);

        if (rowData[2] != '--') {

            totalvalue = parseInt(impqty) * parseFloat(impPrice);

        }

        else {

            totalvalue = 0;

        }

        //if (parseFloat(totalvalue) > 65000) {

        //    alert('Preapproval is required for this implant.');

        //    $(this).closest("tr").find("input[name=ImpPreAuthCls]").val('YES');

        //}

        if (excType != 'Y') {

            if (parseFloat(impPrice) > parseFloat(orgPrice) || parseFloat(totalvalue) > 65000) {

                // alert('Preapproval is required for this implant.');

                swal({

                    //position: 'top-end',

                    icon: 'warning',

                    type: 'warning',

                    title: 'Preapproval is required for this implant!',

                    showConfirmButton: false,

                    timer: 1500

                });

                $(this).closest("tr").find("input[name=ImpPreAuthCls]").val('YES');

            }

        }

        else {

            $(this).closest("tr").find("input[name=ImpPreAuthCls]").val('NO');

        }

        $(this).closest("tr").find("input[name=lblRowtotAmt]").val(toIndianCurrency(totalvalue));

        CalculateTotalImplantInner();

        // CalculateImplantSubTotal(totalvalue);



    });



    //Calculate Sum of Inner Implant Details Table

    function CalculateTotalImplantInner() {
        var calculated_total_sum = 0;
        $("#tblImplantList .txtImplRowTotal").each(function () {

            var get_textbox_value = $(this).val();

            /*if (get_textbox_value!="") {*/

            calculated_total_sum += parseFloat(fn_ValReplace(get_textbox_value));

            // }

        });
        $("#lblImpSubTotal").html(toIndianCurrency(calculated_total_sum));
        CalculateImpHighDrugsTotAmt();
        CalculateTotalPackageCost();
    }

    //Calculate Sum of Inner Implant Details Table

    function CalculateTotalHedInner() {
        var calculated_total_sum = 0;
        $("#tblHgDruglist .txtHedRowTotal").each(function () {

            var get_textbox_value = $(this).val();

            /*if (get_textbox_value!="") {*/

            calculated_total_sum += parseFloat(fn_ValReplace(get_textbox_value));

            // }

        });
        $("#lblHedSubTotal").html(toIndianCurrency(calculated_total_sum));
        CalculateImpHighDrugsTotAmt();
        CalculateTotalPackageCost();
    }

    $("#btnSubmitImplant").on('click', function () {

       // debugger;

        swal({
            title: "Are you sure?",
            text: "You want to add selected items.",
            type: "warning",
            showCancelButton: true,
            cancelButtonColor: '#d33',
            confirmButtonColor: "#36A865",
            confirmButtonText: 'Yes'
        }).then(function (isConfirm) {
            if (isConfirm.value) {
            $("#btnSubmitImplant").html("Adding..");
            $('#btnSubmitImplant').attr('disabled', 'disabled');
            var imppreauthreq = '';
            var statecode = '@Session["STATECODE"]';
            if ($("#lblImpSubTotal").text() == "0.00" || $("#lblImpSubTotal").text() == "₹0.00") {
                swal({
                    title: "Please choose at least one implant from list!",
                    icon: "error",
                    type: "warning",
                    confirmButtonColor: "#36A865",
                    confirmButtonText: "OK"
                }).then(function () {
                    $("#btnSubmitImplant").html("Add Implant");
                    $('#btnSubmitImplant').removeAttr('disabled');
                });
                return false;
            }

            var tableIndex = $("#lblParentTableId").text();
            var netTotal = 0;
            var hdnParentIsAuth = $('#hdnIsAuthRqrPack' + tableIndex).val();
            //console.log('imp', hdnParentIsAuth);
            var procMainId = '';
            $("#tblImplantList tr").each(function () {
                var self = $(this);
                var chkbox = self.find("input[name=selectImpl]");
                if (self.find("input[name=selectImpl]").is(":checked")) {
                    var implName = self.find("td:eq(1)").text().trim();
                    var UnitPrice = $(this).closest("tr").find("input[name=txtimpPrice]").val();
                    //self.find("td:eq(2)").text().trim();
                    var quantity = self.closest("tr").find("input[name=txtimpqty]").val();
                    var totlprice = self.closest("tr").find("input[name=lblRowtotAmt]").val();
                    var implCode = self.closest("tr").find("input[name=hdnImplantCode]").val();
                   var isPreAuthRqrImpl = self.closest("tr").find("input[name=ImpPreAuthCls]").val();
                   //console.log('isPreAuthRqrImpl', isPreAuthRqrImpl)
                    imppreauthreq = isPreAuthRqrImpl;//Add By Rajkishor Patra
                    //Added by Niranjan Poddar on 23-02
                    var ProcID = self.closest("tr").find("input[name=hdnProcId]").val();
                    var ProcCode = self.closest("tr").find("input[name=hdnProcCode]").val();
                    procMainId = ProcID;
                    var implhtml = "<tr class='active brd-left'>";
                    implhtml += "<td class='brd-left'>" + implName + "<input type='hidden' name='hdnImplProcCodes' value='" + ProcID + "'></td>";
                    implhtml += "<td>" + quantity + "<input type='hidden' id='hdnTabname' name='hdImpltabName' value='" + "tblImplantView" + tableIndex + "'></td>";
                    implhtml += "<td>" + UnitPrice + "<input type='hidden' id='hdnImplCodes' name='hdnImplCodes' value='" + implCode + "'><input type='hidden' name='hdnImplProcIdd' value='" + ProcID + "'></td>";
                    implhtml += "<td>" + totlprice + "</td>";
                    implhtml += "<td>" + isPreAuthRqrImpl + "<input type='hidden' name='implPreAuthcls' value='" + "isPackAuthReq" + tableIndex + "'><input type='hidden' id='hdnParentIsPreAuth' name='hdnnmParentIsPreAuth' value='" + hdnParentIsAuth + "'></td>";
                    implhtml += " <td><button type='button' class='btn btn-outline-danger clsImplDel' id='del'><i class='fa fa-trash'></i></button><input type='hidden' name='hdImplTotField' id='hdnTotlabel' value='" + "clsImplTotalInner" + tableIndex + "'><input type='hidden' name='hdnParentImplTot' id='hdnImplTotID' value='" + "implCost" + tableIndex + "'></td>";
                    implhtml += "<td><input type = 'hidden' id = 'implCode' name ='implCode' value = '" + implCode + "' ></td > ";
                    implhtml += "<td><input type = 'hidden' id = 'implname' name ='implname' value = '" + implName + "' ></td > ";
                    //implhtml += " <td><button type='button' class='btn btn-outline-danger clsImplDel' id='del'><i class='fa fa-trash'></i></button><input type='hidden' name='hdImplTotField' id='hdnTotlabel' value='" + "clsImplTotalInner" + tableIndex + "'><input type='hidden' name='hdnParentImplTot' id='hdnImplTotID' value='" + "implCost" + tableIndex + "'></td>";
                    implhtml += "</tr>";
                    var d = {
                        "implantcode": implCode,
                        "implantprice": fn_ValReplace(UnitPrice),
                        "implantquantity": quantity,
                        "totalprice": fn_ValReplace(totlprice),
                        "procedureId": ProcID,
                        "procedureCode": ProcCode,
                        "implantname": implName
                    };
                    implantdata.push(d);
                    netTotal += parseFloat(fn_ValReplace(totlprice));
                    $("#tblImplantView" + tableIndex + "").append(implhtml);
                    $(".implCost" + tableIndex + "").html(parseFloat(netTotal).toFixed(2));
                }
            });
            $(".clsImplTotalInner" + tableIndex + "").html(toIndianCurrency(parseFloat(netTotal)));
            $("#lblImpSubTotal").text('0.00');
            var tabName = "tblImplantView" + tableIndex;
            var innertTot = "clsImplTotalInner" + tableIndex;
            var parentTot = "implCost" + tableIndex;
            parentIsAuth = "isPackAuthReq" + tableIndex;
            CalculateTotalImplantPrice(tabName, innertTot, parentTot);
            if (hdnParentIsAuth.toUpperCase() != "YES") {
                CheckImplantIsPreAuthRequired(tabName, parentIsAuth, procMainId);
            }
            setTimeout(function () {

                $("#btnSubmitImplant").html("Add Implant");

                $('#btnSubmitImplant').removeAttr('disabled');

                $("#Addimplantmodal").modal('hide');

            }, 100);
            }
            else {
                swal({
                    title: "Sorry! Implant has not yet added!",
                    icon: "error",
                    type: "warning",
                    confirmButtonColor: "#36A865",
                    confirmButtonText: "OK"
                }).then(function () {
                    $("#btnSubmitImplant").html("Add Implant");
                    $('#btnSubmitImplant').removeAttr('disabled');
                });
            }
            if ((imppreauthreq.toUpperCase() == "YES") && statecode == "21" && $('input[name="radio"]:checked').val() == "N") {
                $("#preauthspanid").show();
                $("#preauthspandays").show();
                $("#preauthspandesc").show();
            }

            if ((imppreauthreq.toUpperCase() == "YES") && excpHospitalType == "2" && statecode != "21" && $('input[name="radio"]:checked').val() == "N") {
                $("#preauthspanid").show();
                $("#preauthspandays").show();
                $("#preauthspandesc").show();
            }
                CalculateTotalPackageCost();
        });

    });

    function CheckImplantIsPreAuthRequired(tableName, totPrentCol, procMainId) {

        //for preauthstatus yes as per total cost

        var statecode = '@Session["STATECODE"]';
        var excpHospitalType = '@Session["exceptionhospital"]';//0
        var TotalPackageCost = 0;
        var packagecost = $("#txtimplanttotalwardcost").val();
        var TotImplCost = $("#totalimplantcostid").val();
       /* var TotHedCost = $("#HighendAmt").html();*/
        TotalPackageCost = parseFloat(fn_ValReplace(packagecost)) + parseFloat(fn_ValReplace(TotImplCost));
        $('#txtimptotalwardcost').val(TotalPackageCost);
         //------------------------------------
        varAllTr = $('#' + tableName).find('tbody > tr');
        var IsAuthRequired = "NO";
        var IsAuth = '';
        for (var i = 0; i < varAllTr.length; i++) {
            if ($(varAllTr[i]).find('td')[4].innerText == "YES") {
                IsAuthRequired = "YES";
            }
        }
        if (IsAuthRequired != "NO") {
            $("." + totPrentCol).html(IsAuthRequired);
            IsAuth = 'YES';
        }

        else {
            $("." + totPrentCol).html('NO');
            IsAuth = 'NO';
        }
        const index = Pacakagedata.findIndex(data => data.procedureid === procMainId);
        Pacakagedata[index].preauthstatus = IsAuth;

        if (TotalPackageCost > 65000 && $('#txtExcptionType').val() == 'N' && $('input[name="radio"]:checked').val() == "N" && excpHospitalType == '2' && statecode != "21") {
            $("#preauthspanid").show();
            $("#preauthspandays").show();
            $("#preauthspandesc").show();
            Pacakagedata[index].preauthstatus = "YES";
        }
        if (TotalPackageCost <= 65000 && $('#txtExcptionType').val() == 'N' && $('input[name="radio"]:checked').val() == "N" && excpHospitalType == '2' && statecode != "21") {
            $("#preauthspanid").hide();
            $("#preauthspandays").hide();
            $("#preauthspandesc").hide();
            Pacakagedata[index].preauthstatus = "NO";
        }
        if (TotalPackageCost > 65000 && $('#txtExcptionType').val() == 'N' && $('input[name="radio"]:checked').val() == "N" && excpHospitalType != '1' && statecode == "21") {

            $("#preauthspanid").show();
            $("#preauthspandays").show();
            $("#preauthspandesc").show();
            Pacakagedata[index].preauthstatus = "YES";
        }
        if (TotalPackageCost <= 65000 && $('#txtExcptionType').val() == 'N' && $('input[name="radio"]:checked').val() == "N" && excpHospitalType != '1' && statecode == "21") {

            $("#preauthspanid").hide();
            $("#preauthspandays").hide();
            $("#preauthspandesc").hide();
            Pacakagedata[index].preauthstatus = "NO";
        }
        //if (TotalPackageCost > 65000 && $('input[name="radio"]:checked').val() == "N" && $('#txtExcptionType').val() == 'N'  && excpHospitalType == '2' && statecode != "21") {

        //    Pacakagedata[index].preauthstatus = "YES";
        //}
        //if (TotalPackageCost <= 65000 && $('input[name="radio"]:checked').val() == "N" && $('#txtExcptionType').val() == 'N' && excpHospitalType == '2' && statecode != "21") {

        //    Pacakagedata[index].preauthstatus = "NO";
        //}

        //if (TotalPackageCost > 65000 && $('input[name="radio"]:checked').val() == "N" && $('#txtExcptionType').val() == 'N' && excpHospitalType != '1' && statecode == "21") {
        //    Pacakagedata[index].preauthstatus = "YES";
        //}
        //if (TotalPackageCost <= 65000 && $('input[name="radio"]:checked').val() == "N" && $('#txtExcptionType').val() == 'N' && excpHospitalType != '1' && statecode == "21") {
        //    Pacakagedata[index].preauthstatus = "NO";
        //}

    }

    $("#btnHedSubmit").on('click', function () {
    $("#btnHedSubmit").html("Adding..");
    $('#btnHedSubmit').attr('disabled', 'disabled');
        var excpHospitalType = '@Session["exceptionhospital"]';//0
        var statecode = '@Session["STATECODE"]';
        if ($("#lblHedSubTotal").text() == "₹0.00" || $("#lblHedSubTotal").text() == "0.00") {
            swal({
                title: "Please choose at least one highend drugs from list!",
                icon: "error",
                type: "warning",
                confirmButtonColor: "#36A865",
                confirmButtonText: "OK"
            })
            $("#btnHedSubmit").html("Add HED");
            $('#btnHedSubmit').removeAttr('disabled');
            return false;
        }
        var tableIndex = $("#lblHedTabCount").text();
        var netTotal = 0;
        var HighEndDrugsList;
        var IsApprvRqr = "No";
        var parentIsAuth;
        var tabName;
        var hdnParentIsAuth = $('#hdnIsAuthRqrPack' + tableIndex).val();
        var procMainId = '';
        $("#tblHgDruglist tr").each(function () { // High End Drugs//



            var self = $(this);

            var chkbox = self.find("input[name=selectHed]");

            if (self.find("input[name=selectHed]").is(":checked")) {

                var implName = self.find("td:eq(1)").text().trim();

                var IsAuthRequired = self.find("td:eq(2)").text().trim();

                var UnitPrice = self.closest("tr").find("input[name=txthedAmt]").val(); //self.find("td:eq(2)").text().trim();

                var quantity = self.closest("tr").find("input[name=txthedqty]").val();

                var totlprice = self.closest("tr").find("input[name=lblRowtotHedAmt]").val();

                var HedCode = self.closest("tr").find("input[name=hdnHedCode]").val();

                //Added by Niranjan Poddar on 23-02

                var ProcID = self.closest("tr").find("input[name=hdnHedProcId]").val();

                var ProcCode = self.closest("tr").find("input[name=hdnHedProcCode]").val();



                procMainId = ProcID;



                if (IsAuthRequired == 'Yes') {

                    HighEndDrugsList += implName + ',';

                    IsApprvRqr = "Yes";

                }

                var implhtml = "<tr class='active brd-left'>";

                implhtml += "<td>" + implName + "<input type='hidden' id='hedhdnProcCode' name='hedhdnProcCodeId' value='" + ProcCode + "'/><input type='hidden' id='hedhdnProcIds' name='hedhdnProcId' value='" + ProcID + "'></td>";

                implhtml += "<td>" + quantity + "<input type='hidden' id='hdnTabname' name='hdHedltabName' value='" + "tblHgDrugsInnerList" + tableIndex + "'></td>";

                implhtml += "<td>" + parseFloat(UnitPrice).toFixed(2) + "</td>";

                implhtml += "<td>" + totlprice + "</td>";

                implhtml += "<td class='hedPreAuth'><input type='hidden' name='hedPreAuthcls' value='" + "isPackAuthReq" + tableIndex + "'>" + IsAuthRequired + "<input type='hidden' id='hdnParentIsPreAuth' name='hdnnmParentIsPreAuth' value='" + hdnParentIsAuth + "'></td>";

                implhtml += " <td><button type='button' class='btn btn-outline-danger clsHedDel' id='del'><i class='fa fa-trash'></i></button><input type='hidden' name='hdHedTotField' id='hdnTotlabel' value='" + "clsHedTotalInner" + tableIndex + "'/><input type='hidden' name='hdnParenHedTot' id='hdnHedTotID' value='" + "highendCost" + tableIndex + "'/></td>";

                implhtml += "<td><input type = 'hidden' id = 'HedCode' name ='HedCode' value = '" + HedCode + "' ></td > ";

                implhtml += "<td><input type = 'hidden' id = 'hdnHedName' name ='hdnHedName' value = '" + implName + "' ></td > ";

                implhtml += "</tr>";



                var dk = {

                    "HedCode": HedCode,

                    "IsAuthRequired": IsAuthRequired,

                    "UnitPrice": UnitPrice,

                    "quantity": quantity,
                    "totlprice": totlprice,
                    "HEDName": implName,
                   "ProcId": ProcID,
                    "ProcCode": ProcCode,

                };

                highenddrugs.push(dk);
                netTotal += parseFloat(fn_ValReplace(totlprice));

                $("#tblHgDrugsInnerList" + tableIndex + "").append(implhtml);

                $(".highendCost" + tableIndex + "").html(parseFloat(netTotal).toFixed(2));

            }



        });
        if (IsApprvRqr == "Yes") {

            swal({

                title: "Some package needs to pre-approval !!",

                //text: "Click ok to redirect override view page.",

                icon: "info",

                type: "warning",

                confirmButtonColor: "#36A865",

                confirmButtonText: "OK"

            })

                .then((result) => {

                    if (result.value) {

                        /* if (confirm("Are you sure you want to add selected items?")) {*/

                        $(".clsHedTotalInner" + tableIndex + "").html(toIndianCurrency(parseFloat(netTotal)));

                        //alert("Higherend Drugs added successfully!");

                        swal({

                            title: "Higherend Drugs added successfully!!",

                            //text: "Click ok to redirect override view page.",

                            icon: "success",

                            type: "success",

                            confirmButtonColor: "#36A865",

                            confirmButtonText: "OK"

                        });

                       // $("#Endrugs").modal('hide');

                        $("#lblHedSubTotal").text('₹0.00');

                        tabName = "tblHgDrugsInnerList" + tableIndex;

                        var innertTot = "clsHedTotalInner" + tableIndex;

                        var parentTot = "highendCost" + tableIndex;

                        parentIsAuth = "isPackAuthReq" + tableIndex;

                        setTimeout(function () {

                            $("#btnHedSubmit").html("Add HED");

                            $('#btnHedSubmit').removeAttr('disabled');

                            $("#Endrugs").modal('hide');

                        }, 100);



                        CalculateTotalImplantPrice(tabName, innertTot, parentTot);

                        if (hdnParentIsAuth.toUpperCase() != "YES") {

                            CheckHedIsPreAuthRequired(tabName, parentIsAuth, procMainId);

                        }

                        //}

                    }

                });



        }
        else {
            $(".clsHedTotalInner" + tableIndex + "").html(toIndianCurrency(parseFloat(netTotal)));
            swal({
                title: "Higherend Drugs added successfully!!",
                icon: "success",
                type: "success",
                confirmButtonColor: "#36A865",
                confirmButtonText: "OK"
            });
            $("#lblHedSubTotal").text('₹0.00');
            tabName = "tblHgDrugsInnerList" + tableIndex;
            var innertTot = "clsHedTotalInner" + tableIndex;
            var parentTot = "highendCost" + tableIndex;
            parentIsAuth = "isPackAuthReq" + tableIndex;
            CalculateTotalImplantPrice(tabName, innertTot, parentTot);
            setTimeout(function () {

                $("#btnHedSubmit").html("Add HED");

                $('#btnHedSubmit').removeAttr('disabled');

                $("#Endrugs").modal('hide');

            }, 100);
            if (hdnParentIsAuth.toUpperCase() != "YES") {
                CheckHedIsPreAuthRequired(tabName, parentIsAuth, procMainId);
            }
        }
        if ((IsApprvRqr == "YES" || IsApprvRqr == "Yes") && statecode == "21" && $('input[name="radio"]:checked').val() == "N") {
            $("#preauthspanid").show();
            $("#preauthspandays").show();
            $("#preauthspandesc").show();
        }
        var TotalPackageCost = 0;
        var packagecost = $('#txttotalwardcost').val(); /*$("#PackSubTotCost").html();*/
        var TotHedCost = $("#totalhighendcostid").val();
        TotalPackageCost = parseFloat(fn_ValReplace(packagecost)) + parseFloat(fn_ValReplace(TotHedCost));
        if (IsApprvRqr.toUpperCase() == "NO" && excpHospitalType != '1' && statecode == "21" && $('input[name="radio"]:checked').val() == "N" && TotalPackageCost > 65000 && $('#txtExcptionType').val() == 'N') {
            $("#preauthspanid").show();
            $("#preauthspandays").show();
            $("#preauthspandesc").show();
        }

        if (IsApprvRqr.toUpperCase() == "NO" && excpHospitalType == "2" && $('#txtExcptionType').val() == 'N' && statecode != "21" && $('input[name="radio"]:checked').val() == "N" && TotalPackageCost > 65000) {
            $("#preauthspanid").show();
            $("#preauthspandays").show();
            $("#preauthspandesc").show();
        }
        CalculateTotalPackageCost();

    });



    //Need to check by Niranjan

    //Check Is HighendDrugs is AuthRequired or Not?

    function CheckHedIsPreAuthRequired(tableName, totPrentCol, procMainId) {
        //debugger;
        //for preauthstatus yes as per total cost
        var statecode = '@Session["STATECODE"]';
        var excpHospitalType = '@Session["exceptionhospital"]';//0
        var TotalPackageCost = 0;
        var packagecost = $('#txttotalwardcost').val();
        var TotHedCost = $("#totalhighendcostid").val();
        TotalPackageCost = parseFloat(fn_ValReplace(packagecost)) + parseFloat(fn_ValReplace(TotHedCost));
        $('#txthightotalwardcost').val(TotalPackageCost);

        //------------------------------------
        varAllTr = $('#' + tableName).find('tbody > tr');
        var IsAuthRequired = "NO";
        var IsAuth = '';
        for (var i = 0; i < varAllTr.length; i++) {
            if ($(varAllTr[i]).find('td')[4].innerText == "Yes") {
                IsAuthRequired = "YES";
            }
        }
        if (IsAuthRequired != "NO") {
            $("." + totPrentCol).html(IsAuthRequired);
            IsAuth = 'YES';
        }
        else {
            $("." + totPrentCol).html('NO');
            IsAuth = 'NO';
        }
        const index = Pacakagedata.findIndex(data => data.procedureid === procMainId);
        Pacakagedata[index].preauthstatus = IsAuth;
        if (TotalPackageCost > 65000 && $('#txtExcptionType').val() == 'N' && $('input[name="radio"]:checked').val() == "N" && excpHospitalType == '2' && statecode != "21") {
            $("#preauthspanid").show();
            $("#preauthspandays").show();
            $("#preauthspandesc").show();
            Pacakagedata[index].preauthstatus = "YES";
        }
        if (TotalPackageCost <= 65000 && $('#txtExcptionType').val() == 'N' && $('input[name="radio"]:checked').val() == "N" && excpHospitalType == '2' && statecode != "21") {
            $("#preauthspanid").hide();
            $("#preauthspandays").hide();
            $("#preauthspandesc").hide();
            Pacakagedata[index].preauthstatus = "NO";
        }
        if (TotalPackageCost > 65000 && $('#txtExcptionType').val() == 'N' && $('input[name="radio"]:checked').val() == "N" && excpHospitalType != '1' && statecode == "21") {
            $("#preauthspanid").show();
            $("#preauthspandays").show();
            $("#preauthspandesc").show();
            Pacakagedata[index].preauthstatus = "YES";
        }
        if (TotalPackageCost <= 65000 && $('#txtExcptionType').val() == 'N' && $('input[name="radio"]:checked').val() == "N" && excpHospitalType != '1' && statecode == "21") {
            $("#preauthspanid").hide();
            $("#preauthspandays").hide();
            $("#preauthspandesc").hide();
            Pacakagedata[index].preauthstatus = "NO";
        }

    }
    function CalculateImpHighDrugsTotAmt() {
        var ImplSum = 0;
        $(".imptotal").each(function () {
            if ($(this).text() != "") {
                ImplSum += parseFloat($(this).text());
            }
        });
        $('#ImplAmt').text(toIndianCurrency(ImplSum));
        var HighSum = 0;
        $(".hedcost").each(function () {
            if ($(this).text() != "") {

                HighSum += parseFloat($(this).text());
            }
        });
        $('#HighendAmt').text(toIndianCurrency(HighSum));
    }

    function CalculateTotalImplantPrice(tableName, totlblClass, totPrentCol) {

        var tbl = tableName.slice(0, -1);

        varAllTr = $('#' + tableName).find('tbody > tr');
        var totalPrice = 0;
        for (var i = 0; i < varAllTr.length; i++) {
            totalPrice += parseFloat(fn_ValReplace($(varAllTr[i]).find('td')[3].innerText));
        }
        if (tbl == "tblImplantView") {
            var implantddata = $("#totalimplantcostid").val(totalPrice);
        }
        if (tbl =="tblHgDrugsInnerList") {
            var highenddata = $("#totalhighendcostid").val(totalPrice);
        }

        $("." + totlblClass).html(toIndianCurrency(parseFloat(totalPrice)));
        $("." + totPrentCol).html(parseFloat(totalPrice));
        CalculateImpHighDrugsTotAmt();
        CalculateTotalPackageCost();
    }

    function CalculateTotalPackageCost() {
        var TotalPackageCost = 0;
        var packagecost = $("#PackSubTotCost").html();
        var TotImplCost = $("#ImplAmt").html();
        var TotHedCost = $("#HighendAmt").html();
        TotalPackageCost = parseFloat(fn_ValReplace(packagecost)) + parseFloat(fn_ValReplace(TotImplCost)) + parseFloat(fn_ValReplace(TotHedCost));
        $("#TotalPackageCost").html(toIndianCurrency(TotalPackageCost));

    }

    $(document).on('click', '.clsImplDel', function () {
        var $thisTr = $(this).closest('tr');
        //alert($($thisTr).find('td')[3].innerText);
        var tableName = $($thisTr).find("input[name=hdImpltabName]").val();
        var totFieldName = $($thisTr).find("input[name=hdImplTotField]").val();
        var totParentCol = $($thisTr).find("input[name=hdnParentImplTot]").val();
        var ProcId = $($thisTr).find("input[name=hdnImplProcIdd]").val();
        var implCodeId = $($thisTr).find("input[name=implCode]").val();
        var implname = $($thisTr).find("input[name=implname]").val();
        var implIsPreAuth = $($thisTr).find("input[name=implPreAuthcls]").val();
        var ParentIsPreAuthhdn = $($thisTr).find("input[name=hdnnmParentIsPreAuth]").val();
        //alert(tableName + '---' + totFieldName + '-------' + totParentCol);
        var data1 = implantdata;
        for (var i = 0; i < data1.length; i++) {

            if (data1[i].implantcode == implCodeId && data1[i].implantname == implname) {
                data1 = jQuery.grep(data1, function (value) {
                    return value != data1[i];
                });
                implantdata = data1;
            }
        }
        $(this).closest('tr').remove();
        CalculateTotalImplantPrice(tableName, totFieldName, totParentCol);
        if (ParentIsPreAuthhdn.toUpperCase() != "YES") {
            CheckImplantIsPreAuthRequired(tableName, implIsPreAuth, ProcId);
        }
        $('#tblPackageDtls tr').each(function () {
            var preauthid = $(this).find('td').eq(10).text().trim();
            if (preauthid.toUpperCase() == 'YES') {
                $("#preauthspanid").show();
                $("#preauthspandays").show();
                $("#preauthspandesc").show();
                //console.log('preauthid', preauthid);
            }
            if (preauthid.toUpperCase() != 'YES') {
                var wardcost = $(this).find('td').eq(7).text().trim();
                var implantcost = $(this).find('td').eq(8).text().trim();
                var highendcost = $(this).find('td').eq(9).text().trim();
                var implanttotal = parseFloat(fn_ValReplace(wardcost)) + parseFloat(fn_ValReplace(implantcost));
                var highendtotal = parseFloat(fn_ValReplace(wardcost)) + parseFloat(fn_ValReplace(highendcost));
                if (implanttotal > 65000) {
                    $("#preauthspanid").show();
                    $("#preauthspandays").show();
                    $("#preauthspandesc").show();
                }
                else if (highendtotal > 65000) {
                    $("#preauthspanid").show();
                    $("#preauthspandays").show();
                    $("#preauthspandesc").show();
                }
                else {
                    $("#preauthspanid").hide();
                    $("#preauthspandays").hide();
                    $("#preauthspandesc").hide();
                }

            }


        });
    });
    $(document).on('click', '.clsHedDel', function () {
        var $thisTr = $(this).closest('tr');
        var tableName = $($thisTr).find("input[name=hdHedltabName]").val();
        var totFieldName = $($thisTr).find("input[name=hdHedTotField]").val();
        var totParentCol = $($thisTr).find("input[name=hdnParenHedTot]").val();
        var totParentIsPreAuth = $($thisTr).find("input[name=hedPreAuthcls]").val();
        var ParentIsPreAuthhdn = $($thisTr).find("input[name=hdnnmParentIsPreAuth]").val();
        var ProcId = $($thisTr).find("input[name=hedhdnProcId]").val();
        var HedCodeId = $($thisTr).find("input[name=HedCode]").val();
        var HedName = $($thisTr).find("input[name=hdnHedName]").val();
        var data1 = highenddrugs;
        for (var i = 0; i < data1.length; i++) {
            if (data1[i].HedCode == HedCodeId && data1[i].HEDName == HedName) {
                data1 = jQuery.grep(data1, function (value) {
                    return value != data1[i];
                });
                highenddrugs = data1;
            }
        }
        $(this).closest('tr').remove();
        CalculateTotalImplantPrice(tableName, totFieldName, totParentCol);
        if (ParentIsPreAuthhdn.toUpperCase() != "YES") {
            CheckHedIsPreAuthRequired(tableName, totParentIsPreAuth, ProcId);
        }
        $('#tblPackageDtls tr').each(function () {
            var preauthid = $(this).find('td').eq(10).text().trim();
            if (preauthid.toUpperCase() == 'YES') {
                $("#preauthspanid").show();
                $("#preauthspandays").show();
                $("#preauthspandesc").show();
                //console.log('preauthid', preauthid);
            }
            if (preauthid.toUpperCase() != 'YES') {
                var wardcost = $(this).find('td').eq(7).text().trim();
                var implantcost = $(this).find('td').eq(8).text().trim();
                var highendcost = $(this).find('td').eq(9).text().trim();
                var implanttotal = parseFloat(fn_ValReplace(wardcost)) + parseFloat(fn_ValReplace(implantcost));
                var highendtotal = parseFloat(fn_ValReplace(wardcost)) + parseFloat(fn_ValReplace(highendcost));
                if (implanttotal > 65000) {
                    $("#preauthspanid").show();
                    $("#preauthspandays").show();
                    $("#preauthspandesc").show();
                }
                else if (highendtotal > 65000) {
                    $("#preauthspanid").show();
                    $("#preauthspandays").show();
                    $("#preauthspandesc").show();
                }
                else {
                    $("#preauthspanid").hide();
                    $("#preauthspandays").hide();
                    $("#preauthspandesc").hide();
                }

            }


        });
    });



    $('#tblPackageDtls tbody').on('click', '.btncallHedrugs', function () {
        //debugger;
        var $tr = $(this).closest('tr');
        var wardtotalcost = $(this).closest("tr").find('td:eq(7)').text();
       // var highendtotalcost = $(this).closest("tr").find('td:eq(9)').text();
        var data = $('#txttotalwardcost').val(wardtotalcost);

        var row_index = $(this).closest("tr").index();
        var finrow = parseInt(row_index) + 1;
        var $td = $($tr).find('td');
        var ProcId = $(this).parents('tr').find('.clsPckdtlsId').val();
        $("#Endrugs").modal('show');
        $("#lblHedSubTotal").text('₹0.00');
        if ($td[2].innerText == 'MG069A' || $td[2].innerText == 'MG090B' || $td[2].innerText == 'MG092B') {
            getHighEndDrugsHED11List($td[2].innerText, finrow, ProcId);
        }
        else {
            getHighEndDrugsList($td[2].innerText, finrow, ProcId);
        }

        //getHighEndDrugsList($td[2].innerText, finrow, ProcId);

        // }

    });


    function getHighEndDrugsList(prcode, rowid, ProcId) {
        $("#lblHedTabCount").text(rowid);
        var PackCatagoryParams = {
            Action: 'B',
            proccode: prcode,
            hosexptype: '@Session["exceptionhospital"]'
        };
        $.ajax({
            url: ServiceURL + "/api/Common/GetHighDrugListByProcCode",
            type: "GET",
            data: PackCatagoryParams,
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (data) {

                var result = data;

                var defaultmessage = "No Record(s) Found!";

                // var thisHtml = "";

                var oTable = $('#tblHgDruglist').DataTable({

                    "language": {

                        "emptyTable": defaultmessage

                    },

                    destroy: true,

                    lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],

                });

                //oTable.buttons().container().appendTo('.indicatorslist');

                oTable.row().clear().draw();

                var result = data;

                for (var i = 0; i < data.length; i++) {



                    //oTable.row.add(["<div class='custom-control custom-checkbox'><input type='checkbox' class='custom-control-input chkHed' name='selectHed' id='customHedCheck" + i + "'><label class='custom-control-label' for='customHedCheck" + i + "'></label></div><input type='hidden' name='hdnUnitEdit' value='" + result[i].uniteditable + "'/><input type='hidden' name='hdnHedProcCode' value='" + prcode + "'/><input type='hidden' name='hdnHedProcId' value='" + ProcId + "'/><input type='hidden' name='hdnHedCode' value='" + result[i].hed_code + "'/><input type='hidden' name='hdnIsEdit' value='" + result[i].priceeditable + "'/><input type='hidden' name='hdnpriceeditbl' value='" + result[i].priceeditable + "'/></td>", result[i].hed_name, result[i].ispreauthrequired, "<td class='text-align-center'><input type='number' id='txtHedAmt' value='" + parseFloat(result[i].price).toFixed(2) + "' class='form-control txthedAmount' disabled='true' name='txthedAmt'  min='0' oninput='validity.valid || (value = '');'></td>", "<td class='text-align-center'><input type='number' id='txtHedlAmt' class='form-control txthedqytcls' disabled='true' name='txthedqty' maxlength='3' min='0' id='num'></td>", "<td class='text-align-right'><input type='text' class='form-control txtHedRowTotal' name='lblRowtotHedAmt' value='0.00' disabled='true' id='lblTotHedAmt'></td>"



                    //]).draw();



                    oTable.row.add(["<div class='custom-control custom-checkbox'><input type='checkbox' class='custom-control-input chkHed' name='selectHed' id='customHedCheck" + i + "'><label class='custom-control-label' for='customHedCheck" + i + "'></label></div><input type='hidden' name='hdnUnitEdit' value='" + result[i].uniteditable + "'/><input type='hidden' name='hdnHedProcCode' value='" + prcode + "'/><input type='hidden' name='hdnHedProcId' value='" + ProcId + "'/><input type='hidden' name='hdnHedName' value='" + result[i].hed_name + "'/><input type='hidden' name='hdnHedCode' value='" + result[i].hed_code + "'/><input type='hidden' name='hdnIsEdit' value='" + result[i].priceeditable + "'/><input type='hidden' name='hdnpriceeditbl' value='" + result[i].priceeditable + "'/></td>", result[i].hed_name, result[i].ispreauthrequired, "<td class='text-align-center'><input type='number' id='txtHedAmt' value='" + parseFloat(result[i].price).toFixed(2) + "' class='form-control txthedAmount' disabled='true' name='txthedAmt'  min='0' oninput='validity.valid || (value = '');'onkeypress='return event.charCode >= 48 && event.charCode <= 57'onkeypress='return event.charCode >= 48 && event.charCode <= 57'></td>", "<td class='text-align-center'><input type='number' id='txtHedlAmt' class='form-control txthedqytcls' disabled='true' name='txthedqty' maxlength='3' min='0' id='num' onkeypress='return event.charCode >= 48 && event.charCode <= 57'onkeypress='return event.charCode >= 48 && event.charCode <= 57'></td>", "<td class='text-align-right'><input type='text' class='form-control txtHedRowTotal' name='lblRowtotHedAmt' value='0.00' disabled='true' id='lblTotHedAmt'></td>"



                    ]).draw();

                }

            },
            error: function (error) {

                console.log(error.responseText);

                // $('#DvPatientInfo').hide();

            }
        });

    }

    //Binding only HED011 Highend drugs list



   //Binding only HED011 Highend drugs list changed on 04-04-2023

    function getHighEndDrugsHED11List(prcode, rowid, ProcId) {
        $("#lblHedTabCount").text(rowid);
        var PackCatagoryParams = {
            Action: 'R',
            proccode: prcode,
            hosexptype: '@Session["exceptionhospital"]'
        };
        $.ajax({
            url: ServiceURL + "/api/Common/GetHighDrugListByProcCode",
            type: "GET",
            data: PackCatagoryParams,
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (data) {

                var result = data;

                var defaultmessage = "No Record(s) Found!";

                // var thisHtml = "";

                var oTable = $('#tblHgDruglist').DataTable({

                    "language": {

                        "emptyTable": defaultmessage

                    },

                    destroy: true,

                    lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],

                });

                //oTable.buttons().container().appendTo('.indicatorslist');

                oTable.row().clear().draw();

                var result = data;

                for (var i = 0; i < data.length; i++) {



                    oTable.row.add(["<div class='custom-control custom-checkbox'><input type='checkbox' class='custom-control-input chkHed' name='selectHed' id='customHedCheck" + i + "'><label class='custom-control-label' for='customHedCheck" + i + "'></label></div><input type='hidden' name='hdnUnitEdit' value='" + result[i].uniteditable + "'/><input type='hidden' name='hdnHedProcCode' value='" + prcode + "'/><input type='hidden' name='hdnHedProcId' value='" + ProcId + "'/><input type='hidden' name='hdnHedName' value='" + result[i].hed_name + "'/><input type='hidden' name='hdnHedCode' value='" + result[i].hed_code + "'/><input type='hidden' name='hdnIsEdit' value='" + result[i].priceeditable + "'/><input type='hidden' name='hdnpriceeditbl' value='" + result[i].priceeditable + "'/></td>", result[i].hed_name, result[i].ispreauthrequired, "<td class='text-align-center'><input type='number' id='txtHedAmt' value='" + parseFloat(result[i].price).toFixed(2) + "' class='form-control txthedAmount' disabled='true' name='txthedAmt'  min='0' oninput='validity.valid || (value = '');'onkeypress='return event.charCode >= 48 && event.charCode <= 57'onkeypress='return event.charCode >= 48 && event.charCode <= 57'></td>", "<td class='text-align-center'><input type='number' id='txtHedlAmt' class='form-control txthedqytcls' disabled='true' name='txthedqty' maxlength='3' min='0' id='num' onkeypress='return event.charCode >= 48 && event.charCode <= 57'onkeypress='return event.charCode >= 48 && event.charCode <= 57'></td>", "<td class='text-align-right'><input type='text' class='form-control txtHedRowTotal' name='lblRowtotHedAmt' value='0.00' disabled='true' id='lblTotHedAmt'></td>"



                    ]).draw();

                }

            },
            error: function (error) {

                console.log(error.responseText);

                // $('#DvPatientInfo').hide();

            }
        });
    }



    $('#tblHgDruglist tbody').on('change', '.txthedqytcls', function () {



        var $tr = $(this).closest('tr');

        var rowData = $('#tblHgDruglist').DataTable().row($tr).data();

        /* var ID = $(this).closest('tr').find('td').eq(3).text();*/

        var impqty = $(this).closest("tr").find("input[name=txthedqty]").val();

        var hedPrice = $(this).closest("tr").find("input[name=txthedAmt]").val();



        if (impqty == "") {

            $(this).closest("tr").find("input[name=txthedqty]").val("1");

            impqty = 1;

        }



        if (hedPrice == "") {

            $(this).closest("tr").find("input[name=txthedAmt]").val("0.00");

        }



        var totalvalue = parseInt(impqty) * parseFloat(hedPrice).toFixed(2);

        if (hedPrice != '--') {

            totalvalue = parseInt(impqty) * parseFloat(hedPrice).toFixed(2);

        }

        else {

            totalvalue = 0.00;

        }



        $(this).closest("tr").find("input[name=lblRowtotHedAmt]").val(totalvalue.toFixed(2));

        CalculateTotalHedInner();



    });



    $('#tblHgDruglist tbody').on('change', '.txthedAmount', function () {



       var $tr = $(this).closest('tr');

        var rowData = $('#tblHgDruglist').DataTable().row($tr).data();

        /* var ID = $(this).closest('tr').find('td').eq(3).text();*/

        var impqty = $(this).closest("tr").find("input[name=txthedqty]").val();

        var hedPrice = $(this).closest("tr").find("input[name=txthedAmt]").val();

        if (impqty == "") {

            $(this).closest("tr").find("input[name=txthedqty]").val("1");

            impqty = 1;

        }



        if (hedPrice == "") {

            $(this).closest("tr").find("input[name=txthedAmt]").val("0.00");

        }

        var totalvalue = parseInt(impqty) * parseFloat(hedPrice).toFixed(2);

        if (hedPrice != '--') {

            totalvalue = parseInt(impqty) * parseFloat(hedPrice).toFixed(2);

        }

        else {

            totalvalue = 0.00;

        }

        $(this).closest("tr").find("input[name=lblRowtotHedAmt]").val(totalvalue.toFixed(2));



        CalculateTotalHedInner();



    });



    //Getting Ward list based on Procedure Code

    function getWardList(procCode) {
        var wardparam = {
            Action: 'W',
            hoscatId: '@Session["HospitalCategoryId"]',
            ProcCode: procCode
    };

    $.ajax({
        url: ServiceURL + "/api/Common/GetWardListByProcCode",
        type: "GET",
        data: wardparam,
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        success: function (data) {

            $('#ddlWard').empty().append('<option selected="selected" value="0">--Select--</option>');

            $.each(data, function () {

                $('#ddlWard').append($("<option></option>").val(this['id']).text(this['ward']));

            });

        },
        error: function (error) {

            console.log(error.responseText);

        }
    });
    }
     //By Niranjan Poddar on 10-02-2023

    function getWardCostDaysDtls(ward) {
        var wardParam = {
            Action: 'WA',
            wardid: ward,
            hoscategory:'@Session["HospitalCategoryId"]',
        };
        $.ajax({
            url: ServiceURL + "/api/Common/getWardPrice",
            type: "GET",
            data: wardParam,
            dataType: "json",
            async:false,
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                if (data != null) {
                    $("#txtwardcost").val(parseFloat(data));
                    $("#lblFormula").html(parseFloat(data));
                }
                else {
                    $("#txtwardcost").val('0.00');
                    $("#lblFormula").html('0.00');
                }
            },
            error: function (error) {
                console.log(error.responseText);
            }
        });
        //Added by niranjan on 10-02-2023
        calculateTotalPackageCostTop();
    }

    //By Niranjan Poddar on 14-02-2023
    function checkWardEditableOrNot(ward) {
        var wardParam = {
            Action: 'WP',
            wardid: ward,
            hoscategory:'@Session["HospitalCategoryId"]',
        };
        $.ajax({
            url: ServiceURL + "/api/Common/getWardPriceUnit",
            type: "GET",
            data: wardParam,
            dataType: "json",
            async:false,
            contentType: "application/json; charset=utf-8",
            success: function (resdata) {
                if (resdata != null) {
                    $("#lblWardEdit").html(resdata.pricefixededitable);
                    if (resdata.pricefixededitable == 'Y') {
                        if ($("#txtTreatDays").val() != "0") {
                            $("#txtTreatDays").val(1);
                        }
                        $("#hdnIsWardEdit").val(resdata.pricefixededitable);
                        $("#hdnWardUnit").val(resdata.maximumunit);
                        $("#lblWardMaxUnit").html(resdata.maximumunit);
                    }
                    else {
                        $("#txtTreatDays").attr("disabled", "disabled");
                        $("#hdnIsWardEdit").val('N');
                        $("#hdnWardUnit").val('');
                        $("#lblWardMaxUnit").html('');
                    }
                }
                else {
                    swal("info", "No Record(s) found!");
                }
            },
            error: function (error) {
                console.log(error.responseText);
            }
        });

        //Added by niranjan on 10-02-2023
        calculateTotalPackageCostTop();
    }

    $("#ddlWard").on('change', function () {
        var wardid = this.value;
        $("#txtTreatDays").val('1');
        $("#txtTreatCost").val('0');
        getWardCostDaysDtls(wardid);
        checkWardEditableOrNot(wardid);
        if ($("#hdnIsPackPriceEdit").val() == "Y") {
            $("#txtwardcost").removeAttr('disabled');
        }
        else {
            $("#txtwardcost").attr('disabled', 'disabled');
        }
    });
    //Calculate Total Selected Package Cost

    function calculateTotalPackageCostTop() {

        $("#txtPackageCost").val(toIndianCurrency('0.00'));

        var packcost = $("#txtTreatCost").val();

        var wardcost = $("#txtwardcost").val() != '' ? $("#txtwardcost").val() : '0';

        var totalPackageCost = 0;

        //Check for Variable or Not

        //if ($("#hdnstaytype").val() == "VARIABLE") {

        //    $("#txtTreatDays").removeAttr('disabled');

        //    if ($("#txtTreatDays").val() == "0") {

        //        $("#txtTreatDays").val(1);

        //        totalPackageCost = (parseFloat(packcost) + parseFloat(wardcost)) * (parseFloat($("#txtTreatDays").val()));

        //        $("#txtPackageCost").val(toIndianCurrency(totalPackageCost));

        //    }

        //    else {

        //        totalPackageCost = (parseFloat(packcost) + parseFloat(wardcost)) * (parseFloat($("#txtTreatDays").val()));

        //        $("#txtPackageCost").val(toIndianCurrency(totalPackageCost));

        //    }

        //}



        if ($("#hdnIsWardEdit").val() == "Y" && $("#hdnstaytype").val() == "VARIABLE") {

            //if ($("#hdnstaytype").val() == "NA") {

            //  /*  $("#txtTreatDays").attr('disabled', 'disabled');*/

            //    $("#txtTreatDays").removeAttr('disabled');

            //    totalPackageCost = (parseFloat(wardcost) * parseFloat($("#txtTreatDays").val())) + parseFloat(packcost);

            //    $("#txtPackageCost").val(toIndianCurrency(totalPackageCost));

            //}

            //else if ($("#hdnstaytype").val() == "VARIABLE") {



            $("#txtTreatDays").removeAttr('disabled');

            if ($("#txtTreatDays").val() == "0") {

                $("#txtTreatDays").val(1);

                totalPackageCost = (parseFloat(packcost) + parseFloat(wardcost)) * (parseFloat($("#txtTreatDays").val()));

                $("#txtPackageCost").val(toIndianCurrency(totalPackageCost));

            }

            else {

                totalPackageCost = (parseFloat(packcost) + parseFloat(wardcost)) * (parseFloat($("#txtTreatDays").val()));

                $("#txtPackageCost").val(toIndianCurrency(totalPackageCost));

            }

            //}

        }

        else {

            if ($("#hdnstaytype").val() == "NA") {

                $("#txtTreatDays").val('1');

                $("#txtTreatDays").attr('disabled', 'disabled');



                totalPackageCost = (parseFloat(packcost) + parseFloat(wardcost));

                $("#txtPackageCost").val(toIndianCurrency(totalPackageCost));

            }

            if ($("#hdnstaytype").val() == "VARIABLE" && $("#hdnIsWardEdit").val() == "Y") {

                $("#txtTreatDays").removeAttr('disabled');

                if ($("#txtTreatDays").val() == "0") {

                    $("#txtTreatDays").val(1);

                    totalPackageCost = (parseFloat(packcost) + parseFloat(wardcost)) * (parseFloat($("#txtTreatDays").val()));

                    $("#txtPackageCost").val(toIndianCurrency(totalPackageCost));

                }

                else {

                    totalPackageCost = (parseFloat(packcost) + parseFloat(wardcost)) * (parseFloat($("#txtTreatDays").val()));

                    $("#txtPackageCost").val(toIndianCurrency(totalPackageCost));

                }

            }



            if ($("#hdnstaytype").val() == "VARIABLE" && $("#hdnIsWardEdit").val() == "N") {

                $("#txtTreatDays").removeAttr('disabled');

                if ($("#txtTreatDays").val() == "0") {

                    $("#txtTreatDays").val(1);

                    totalPackageCost = (parseFloat(packcost) + parseFloat(wardcost)) * (parseFloat($("#txtTreatDays").val()));

                    $("#txtPackageCost").val(toIndianCurrency(totalPackageCost));

                }

                else {

                    totalPackageCost = (parseFloat(packcost) + parseFloat(wardcost)) * (parseFloat($("#txtTreatDays").val()));

                    $("#txtPackageCost").val(toIndianCurrency(totalPackageCost));

                }

            }

        }

    }



    //Treatmentdays change event to call CalculateTop Method

    $("#txtTreatDays").change(function () {

        if ($("#hdnMaxdays").val() != "") {

            if ($("#txtTreatDays").val() != "") {

                if (parseInt($("#txtTreatDays").val()) > parseInt($("#hdnMaxdays").val())) {

                    alert('Treatment days can not be exceed ' + $("#hdnMaxdays").val() + ' days!');

                    $("#txtTreatDays").val('');

                    $("#txtTreatDays").focus();

                    return false;

                }

            }

            else {

                alert('Please enter treatment days!');

                $("#txtTreatDays").focus();

                return false;

            }

        }

        calculateTotalPackageCostTop();

        checkIsExcepionType(fn_ValReplace($("#txtPackageCost").val()), $("#lblExcptionType").html());



    });



    $("#txtwardcost").change(function () {

        //if ($("#hdnMaxdays").val() != "") {

        //    if ($("#txtTreatDays").val() != "") {

        //        if (parseInt($("#txtTreatDays").val()) > parseInt($("#hdnMaxdays").val())) {

        //            alert('Treatment days can not be exceed ' + $("#hdnMaxdays").val() + ' days!');

        //            $("#txtTreatDays").val('');

        //            $("#txtTreatDays").focus();

        //            return false;

        //        }

        //    }

        //    else {

        //        alert('Please enter treatment days!');

        //        $("#txtTreatDays").focus();

        //        return false;

        //    }

        //}

        calculateTotalPackageCostTop();

        checkIsExcepionType(fn_ValReplace($("#txtPackageCost").val()), $("#lblExcptionType").html());

    });



    //OverRide Request

    function OverrideRequest() {

        $(".packagedetails").prop('checked', true);

        $('.packagedetails').prop('disabled', true);

        $('#MyPopupBlock').modal('show');



    }



    function submitOverrideRequestForm() {

        //debugger;

        var MotalityDocUpload = $("#uploadfile").get(0);

        var Motalityfiles = MotalityDocUpload.files;



        var fileExtension = ['pdf', 'jpeg', 'jpg'];

        var filename = $('#uploadfile').val();

        var extension = filename.replace(/^.*\./, '');

        if (filename.length != 0) {

            var File = $("#uploadfile")[0].files[0].size;

        }

        if ($('#txtNoofdays').val() == '' || $('#txtNoofdays').val() == 0) {

            swal({

                text: "Please enter No. Of Days.!!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtNoofdays").focus();

            });

            return false;

        }

        else if ($.inArray(extension.toLowerCase(), fileExtension) == -1 && filename.length != 0) {

            swal({

                text: "Please upload a valid file of type pdf, jpeg, jpg !!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#uploadfile").focus();

            });

            return false;

        }



        else if (File > 5242880) {

            swal({

                text: "File size cannot be greater than 5MB !!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#uploadfile").focus();

            });

            return false;

        }



        else if ($('#txtDescription12').val() === "") {

            swal({

                text: "Please Enter Description !!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtDescription12").focus();

            });

            return false;

        }



        else {

            $('#btnSubmit').prop('disabled', true);

            var OverrideRequestData = new FormData();

            OverrideRequestData.append("MemberId", $('#lblPatientMemberId').text());

            OverrideRequestData.append("URN", $('#lblPatientUrnNo').text());

            OverrideRequestData.append("NoofDays", $('#txtNoofdays').val());

            OverrideRequestData.append("DateOfAdmission", $('#dtActualAdmission').val());

            if (Motalityfiles.length > 0) { OverrideRequestData.append("UploadDoc", Motalityfiles[0]); }

            if (Motalityfiles.length > 0) { OverrideRequestData.append("UploadDoc1", Motalityfiles[0].name); }



            OverrideRequestData.append("Description", $('#txtDescription12').val());

            OverrideRequestData.append("GENERATEDTHROUGH", $('#chkboxblock').val());

            OverrideRequestData.append("HospitalCode", @Session["HospitalCode"]);

            OverrideRequestData.append("HospitalCategoryId", @Session["HospitalCategoryId"]);

            OverrideRequestData.append("ExceptionHospital", @Session["exceptionhospital"]);

            OverrideRequestData.append("ActionCode", "A");

            $.ajax({

                url: '@Url.Action("GenerateOverrideRequest", "BlockPackage")',

                type: "POST",

                data: OverrideRequestData,

                processData: false,

                contentType: false,

                beforeSend: function () {

                    $("#loader").show();

                },

                success: function (data) {

                    //debugger;

                    if (data[0].output == 2 && data[0].statecode == 21) {

                        if (data[0].exchospitaltype == 1) {

                            $("#txtOverrideCode").val(data[0].blockoverridecode);

                            $('#MyPopupBlock').modal('hide');

                            $("#PackageDetails").show();

                        }

                        else {

                             swal({

                            title: "Override Request generated successfully!!",

                            text: "Click ok to redirect override view page.",

                            icon: "success",

                            type: "success",

                            confirmButtonColor:"#36A865",

                            confirmButtonText: "OK"

                        })

                            .then((result) => {

                                if (result.value) {

                                    window.location = '@Url.Content("~/BlockPackage/OverrideView")';

                                } else if (result.dismiss === 'cancel') {

                                    swal(

                                        'Cancelled',

                                        'Your stay here :)',

                                        'error'

                                    )

                                }

                            });;

                        }

                     }

                     else if (data[0].output == 2 && data[0].statecode != 21) {

                        $("#txtOverrideCode").val(data[0].blockoverridecode);

                        $('#MyPopupBlock').modal('hide');

                        $("#PackageDetails").show();

                     }

                     else if (data[0].output == 2 && data[0].statecode == 21 && data[0].exchospitaltype == 1) {

                        $("#txtOverrideCode").val(data[0].blockoverridecode);

                        $('#MyPopupBlock').modal('hide');

                        $("#PackageDetails").show();

                     }

                    else if (data[0].output == 3) {

                        swal({

                            text: "Override request has already generated, new request not allowed. !!",

                            confirmButtonColor: "#36A865",

                            type: "warning",

                            confirmButtonText: "OK"

                        }).then(function () {

                            $("#txtDescription12").focus();

                        });

                     }

                     else {

                     }

                },

                complete: function () {

                    $("#loader").hide();

                },

                error: function (error) {



                    console.log(error.statusText);



                }

            });

        }

    }



    function OTPTIMER() {

        let timerOn = true;

        function timer(remaining) {

            var m = Math.floor(remaining / 60);

            var s = remaining % 60;

            m = m < 10 ? '0' + m : m;

            s = s < 10 ? '0' + s : s;

            document.getElementById('timer-countdown').innerHTML = m + ':' + s;

            remaining -= 1;



            if (remaining >= 0 && timerOn) {

                setTimeout(function () {

                    timer(remaining);

                }, 1000);

                return;

            }



            if (!timerOn) {

                // Do validate stuff here

                return;

            }

            // Do timeout stuff here

            $('#OTPModal').modal('hide');

            //alert('Timeout for otp');

        }

        timer(600);

    }



    function readURL(input) {

        // var userImg = '@Url.Content("~/imgs/no_user.png")';

        if (input.files && input.files[0]) {

            var reader = new FileReader();

            reader.onload = function (e) {

                var size = input.files[0].size;

                if (size <= 200000) {

                    $('#showPhoto')

                        .attr('src', e.target.result);

                }

                else {

                    $('#showPhoto')

                        .attr('src', userImg);

                }

            };

            reader.readAsDataURL(input.files[0]);

            $('#RemovePatientPic').show();

        }

    }

    function RemovePatientPic(ele) {

        $("#Photo").val("");

        $('#showPhoto').attr('src', userImg);

        $('#RemovePatientPic').hide();

    }

    $("#Photo").on("change", function (e) {

        var fileExtension = ['jpeg', 'jpg'];

        var filename = $('#Photo').val();

        var extension = filename.replace(/^.*\./, '');

        if ($.inArray(extension.toLowerCase(), fileExtension) == -1 && filename.length != 0) {

            swal({

                text: "Please upload a valid file of type jpeg, jpg !!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#Photo").focus();

                $("#Photo").val("");

                $('#showPhoto').attr('src', userImg);

                $('#RemovePatientPic').hide();

            });

            return false;

        }

        var fileSize = $("#Photo")[0].files[0].size;

        if (fileSize > 1048576) {

            swal({

                text: "File size cannot be greater than 1MB !!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#Photo").focus();

                $("#Photo").val("");

                $('#showPhoto').attr('src', userImg);

                $('#RemovePatientPic').hide();

            });

            return false;

        }

        else {

            $('#RemovePatientPic').show();

        }

    });

    $('#tblImplantList tbody').on('change', '.txtPriceclass', function () {



        var $tr = $(this).closest('tr');

        var rowData = $('#tblImplantList').DataTable().row($tr).data();

        /* var ID = $(this).closest('tr').find('td').eq(3).text();*/

        var impqty = $(this).closest("tr").find("input[name=txtimpqty]").val();

        var impPrice = $(this).closest("tr").find("input[name=txtimpPrice]").val();

        var orgPrice = $(this).closest("tr").find("input[name=hdnImpUnitPrice]").val();

        var excType = $(this).closest("tr").find("input[name=hdnExceptionType]").val();

        /*alert(rowData[2].replace("₹", "").replace(",",""));*/

        var totalvalue = parseInt(impqty) * parseFloat(impPrice);

        //if (rowData[2] != '--') {

        //    totalvalue = parseInt(impqty) * parseFloat(impPrice);

        //}

        //else {

        //    totalvalue = 0;

        //}

        if (excType != 'Y') {

            if (parseFloat(impPrice) > parseFloat(orgPrice) || parseFloat(totalvalue) > 65000) {

                //alert('Preapproval is required for this implant.');

                swal({

                    //position: 'top-end',

                    icon: 'warning',

                    type: 'warning',

                    title: 'Preapproval is required for this implant!',

                    showConfirmButton: false,

                    timer: 1500

                });

                $(this).closest("tr").find("input[name=ImpPreAuthCls]").val('YES');

            }

        }





        //if (parseFloat(totalvalue) > 65000) {

        //    alert('Preapproval is required for this implant.');

        //    $(this).closest("tr").find("input[name=ImpPreAuthCls]").val('YES');

        //}

        else {

            $(this).closest("tr").find("input[name=ImpPreAuthCls]").val('NO');

        }

        $(this).closest("tr").find("input[name=lblRowtotAmt]").val(toIndianCurrency(totalvalue));

        CalculateTotalImplantInner();

        // CalculateImplantSubTotal(totalvalue);



    });



    function PatientVerifyOTP() {

        if ($("#txtpatiantopt").val() == "") {

            swal({

                text: "Please Enter OTP!!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtpatiantopt").focus();

            });

        }

        else {

        var number = $('#txtPatientNo').val();

        var param = {

            URN: $('#lblURNNo').text(),

            MemberID: $('#spnPatientMemberId').text(),

            phonenumber: number,

            OTP: $("#txtpatiantopt").val(),

            HOSPITALCODE: @Session["HospitalCode"]

        };

        $.ajax({

            url: ServiceURL + "/api/BlockPackage/VerifyOTPWithPatientNumber",

            type: "POST",

            data: param,

            dataType: "json",

            beforeSend: function () {

                $("#loader").show();

            },

            success: function (result) {

                if (result == "-1") {

                    swal({

                        text: "OTP verified successfully!!",

                        type: "success",

                        confirmButtonColor: "#36A865",

                        confirmButtonText: "OK"

                    }).then(function () {

                        $('#WithOTP').modal('hide');

                        $("#txtpatiantopt").html('');

                    });

                }

                else {

                    swal({

                        text: "Invalid OTP!!",

                        type: "error",

                        confirmButtonColor: "#36A865",

                        confirmButtonText: "OK"

                    }).then(function () {

                        $("#txtpatiantopt").val("");

                        $('#WithOTP').modal('show');

                    });



                }

            },

            complete: function () {

                $("#loader").hide();

            },



        });

        }

    }



    function SendOTPWithPatient() {

        var number = $('#txtPatientNo').val();

        var param = {

            URN: $('#lblURNNo').text(),

            MemberID: $('#spnPatientMemberId').text(),

            phonenumber: number,

            HOSPITALCODE: @Session["HospitalCode"]

        };

        if (number != "") {

        $.ajax({

            url: ServiceURL + "/api/BlockPackage/SendOTPWithPatientNumber",

            type: "POST",

            data: param,

            dataType: "json",

                beforeSend: function () {

                    $("#loader").show();

                },

            success: function (result) {

                    if (result == "1") {

                        swal({

                            text: "OTP Send To The Patient Phone No.!!",

                            type: "success",

                            confirmButtonColor: "#36A865",

                            confirmButtonText: "OK"

                        }).then(function () {

                            $('#WithOTP').modal('show');

                            $('#WithOTP').modal({

                                backdrop: 'static',

                                keyboard: false

                            })

                        });

                    }

                    else if (result.status == "ERROR") {

                        swal({

                            text: "Server Not Responding, Please Wait!!",

                            type: "error",

                            confirmButtonColor: "#36A865",

                            confirmButtonText: "OK"

                        });

                    }

                    else {

                    }

                },

                complete: function () {

                    $("#loader").hide();

                },

                error: function (error) {

                    console.log(error.statusText);

                }

            });

        }

        else {

            swal({

                title: "Please enter patient phone no", type: ""

            }).then(function () {

                $('#votp').prop('checked', false);

                $('#vwotp').prop('checked', true);



            });



        }

    }



    $('#btnpatientcancel').on('click', function () {

        $('#WithOTP').modal('hide');

        $("#txtpatiantopt").html('');

        $('#votp').prop('checked', false);

        $('#vwotp').prop('checked', true);





    });



    function checkIsExcepionType(pckCost, excpType) {

        if (excpType == 'N') {

            if (parseFloat(pckCost) > 65000) {

                swal({

                    title: "Pre-approval is required for the package!",

                    //text: "Click ok to redirect override view page.",

                    icon: "warning",

                    type: "warning",

                    confirmButtonColor: "#36A865",

                    confirmButtonText: "OK"

                });

                //alert('Package needs to pre-auth!');

            }

        }

    }



    $("#txtuploadfile").on("change", function (e) {

        var fileExtension = ['pdf', 'jpeg', 'jpg'];

        var filename = $('#txtuploadfile').val();

        var extension = filename.replace(/^.*\./, '');

        if ($.inArray(extension.toLowerCase(), fileExtension) == -1 && filename.length != 0) {

            swal({

                text: "Please upload a valid file of type pdf, jpeg, jpg !!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtuploadfile").focus();

                $("#txtuploadfile").val("");

            });

            return false;

        }

        var fileSize = $("#txtuploadfile")[0].files[0].size;

        if (fileSize > 5000141) {

            swal({

                text: "File size cannot be greater than 5MB !!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#txtuploadfile").focus();

                $("#txtuploadfile").val("");

            });

            return false;

        }

        else {

            $("#RemovePreauthDoc").show();

        }

    });



    function RemovePreauthDoc(ele) {

        $("#txtuploadfile").val("");

        $('#RemovePreauthDoc').hide();

    }



    function RemoveoverrideDoc(ele) {

        $("#uploadfile").val("");

        $('#RemoveoverrideDoc').hide();

    }



    $("#uploadfile").on("change", function (e) {

        var fileExtension = ['pdf', 'jpeg', 'jpg'];

        var filename = $('#uploadfile').val();

        var extension = filename.replace(/^.*\./, '');

        if ($.inArray(extension.toLowerCase(), fileExtension) == -1 && filename.length != 0) {

            swal({

                text: "Please upload a valid file of type pdf, jpeg, jpg !!",

                confirmButtonColor: "#36A865",

                type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#uploadfile").focus();

                $("#uploadfile").val("");

            });

            return false;

        }

        var fileSize = $("#uploadfile")[0].files[0].size;

        if (fileSize > 5000141) {

            swal({

                text: "File size cannot be greater than 5MB !!",

                confirmButtonColor: "#36A865",

               type: "error",

                confirmButtonText: "OK"

            }).then(function () {

                $("#uploadfile").focus();

                $("#uploadfile").val("");

            });

            return false;

        }

        else {

           $("#RemoveoverrideDoc").show();

        }

    });



    function checkPackageIsExist(procCode) {

        let PrevPckg = $('#hdnPrevPckgList').val();

        console.log("PrevPckg", PrevPckg);

        console.log("prv", Pacakagedata);

        var hasMatch = false;

        var arr = $.parseJSON(PrevPckg); //convert to javascript array

        for (var index = 0; index < arr.length; index++) {



            if (arr[index].packageheadercode == procCode) {

                hasMatch = true;

                break;

            }

        }



        for (var index1 = 0; index1 < Pacakagedata.length; index1++) {

            console.log("mr", 331);

            console.log("mr", Pacakagedata[index1].PackageHeaderCode);

            console.log("procCode", procCode);

            if (Pacakagedata[index1].PackageHeaderCode == procCode) {

                console.log("mr", 22);

                hasMatch = true;

                break;

            }

        }

        if (hasMatch == true) {

            swal({

               title: "You have already selected MR package,Please select another package!",

                icon: "error",

                type: "error",

                confirmButtonColor: "#36A865",

                confirmButtonText: "Ok"

            });

            $("#popmodal").modal('hide');

            ClearControls();

        }

    }



    function clearallTotalAmout() {

        $("#sum").html('₹0.00');

        $("#WardTotCost").html('₹0.00');

        $("#PackSubTotCost").html('₹0.00');

        $("#ImplAmt").html('₹0.00');

        $("#HighendAmt").html('₹0.00');

        $("#TotalPackageCost").html('₹0.00');

    }

    function CheckMOUStatus(hospitalcode) {
        $.ajax({
            url: ServiceURL + "/api/Common/CheckMOUStatus",
            type: "GET",
            data: { "hospitalcode": hospitalcode },
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            beforeSend: function () {
                $("#loader").show();
            },
            success: function (result) {
                if (result.length > 0) {
                    if (result[0].moustatus == "1") {
                        $('#searchDiv').addClass('divdisable');
                        $('#urnNo').attr('disabled', true);
                        $('#mouDiv').show();
                    }
                }
            },
            complete: function () {
                $("#loader").hide();
            },
            error: function (error) {
                console.log(error.statusText);
            }
        });
    }

</script>

