
@{
    ViewBag.Title = "ViewExtensionOfStay";
    Layout = "~/Views/Shared/_CommonLayout.cshtml";
}

<script type="text/javascript">

    $(document).ready(function () {
        $('#txtExtDays').focus();
        var arrPackageInfo = [];
        @*$('#path').html('<a href="@Url.Action("PreAuthorizationDetails", "ExtensionOfStay")">Extension Of Stay</a>');*@
        if (localStorage.getItem('ExtensionOfStayInfo') != null) {
            var ExtensionStayInfo = JSON.parse(localStorage.getItem('ExtensionOfStayInfo'));
            $('#urnNum').html(ExtensionStayInfo[0].urn);
            SchemeC = ExtensionStayInfo[0].schemeCode;
            $('#BlockPackageDt').html(ExtensionStayInfo[0].BlockPackageDate);
            $('#Patientname').html(ExtensionStayInfo[0].PatientNm);
            $('#Packagename').html(ExtensionStayInfo[0].Packagenm);
            $('#InvoiceNo').html(ExtensionStayInfo[0].invoiceNo);
            $('#TransId').html(ExtensionStayInfo[0].TransactionId);
            $('#hdHospitalCode').html('@Session["HospitalCode"]');
        }
        $('#fuUploadDocument').on('change', function (e) {
            if (!ValidateFile('fuUploadDocument', 'Valid Document')) {
                return false;
            };
            if (!CheckFileType('fuUploadDocument', '1')) {
                return false;
            };
        });
       var params = {
            HospitalCode: '@Session["HospitalCode"]'
        };
        $.ajax({
            url: ServiceURL + "/api/Hospital/GetHospitalInformation",
            type: "GET",
            data: params,
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                $("#hdState").html(data.hospitalState);
                $("#hdDistrict").html(data.hospitalDistrict);
                $("#hdHospitalCode").html(data.hospitalCode);
                $("#HdName").html(data.hospitalname);
                // console.log(data);
            },
            error: function (error) {
                console.log(error.statusText);
            }
        });
        $('#btnBack').click(function () {
             window.location.href = '@Url.Action("ViewExtensionOfStay", "ExtensionOfStay")';
        });
        $('#btnSubmit').click(function () {
            var confirm = ValidatePackage();
            if (confirm == true) {
                var fileUpload = $("#fuUploadDocument").get(0);
                var files = fileUpload.files;
                var gridPackageInfo = $("#jsGrid").jsGrid("option", "data");
                if (files.length > 0) {
                    var data = new FormData();
                    data.append("file", files[0]);
                    data.append("urnNo", $('#urnNum').text());
                    data.append("HospitalCd", $('#hdHospitalCode').text());
                    data.append("NoOfExtDays", $('#txtExtDays').val());
                    data.append("TransactionId", $('#TransId').text());
                    //data.append("PackageDetail", $("option:selected", $("#PApackageDetail")).text());
                    //data.append("TreatmentCost", $('#PAtreatmentCost').val());
                    data.append("InvoiceNum", $('#InvoiceNo').text());
                    //data.append("SchemeCode", SchemeC);
                    console.log(data);
                     $.ajax({
                    url: '@Url.Action("InsertExtensionInfoDetails", "ExtensionOfStay")',
                    type: "POST",
                    data: data,
                    processData: false,
                    contentType: false,
                         success: function (data) {
                             if (data == "sucess") {
                                 alert('Extension Of Stay Request Created Sucessfully!!')
                                 window.location.href = '@Url.Action("ViewExtensionOfStay", "ExtensionOfStay")';
                             }
                    },
                         error: function (error) {
                             console.log(error.statusText);

                    }
                  });
                }
            }
        });

    });

    function ValidatePackage() {
         if ($('#txtExtDays').val() == "") {
             alert('Please Enter No. Of Extension Days !!');
            $('#txtExtDays').focus();
                return false;
         }
        else if ($('#txtExtDays').val() == "0") {
             alert('No. Of Extension Days can not be 0 !!');
            $('#txtExtDays').focus();
            return false;
         }
         else if ($('#txtExtDays').val() > "5") {
             alert('No. Of Extension Days can not be greater than 5 !!');
             $('#txtExtDays').focus();
             return false;
         }
         else if ($('#fuUploadDocument').val()=="") {
                alert('Please Upload Prescription !!');
             $('#fuUploadDocument').focus();
                return false;
            }
            else if (checkconfirm() == false) {
                return false;
            }
            else {
                return true;
            }
    }
    function checkDec(evt) {
        if (!(evt.keyCode == 46 || (evt.keyCode >= 48 && evt.keyCode <= 57))) return false;
        var parts = evt.srcElement.value.split('.');
        if (parts.length > 2) return false;
        if (evt.keyCode == 46) return (parts.length == 1);
        if (parts[0].length >= 14) return false;
        if (parts.length == 2 && parts[1].length >= 2) return false;
    }
    function checkChar(event) {
        var inputValue = event.which;
        // allow letters and whitespaces only.
        if (!(inputValue >= 65 && inputValue <= 120) && (inputValue != 32 && inputValue != 0)) {
            event.preventDefault();
        }
    }
    function checkconfirm() {
        if (window.confirm("Are you sure to want to request for extension of stay?")) {
            return true;
        }
        else {
            return false;
        }
    }
    function ValidateFile(cntr, strText) {

        var strValue = $('#' + cntr).get(0).files.length;
        if (strValue == "0") {
            alert("Please upload " + strText);
            return false;
        }
        else
            return true;
    }
    function CheckFileType(cntr, ftype) {

        // Get the file upload control file extension
        var extn = $('#' + cntr).val().split('.').pop().toLowerCase();
        if (extn != '') {

            // Create array with the files extensions to upload
            var fileListToUpload;
            if (parseInt(ftype) == 1)
                fileListToUpload = new Array('pdf','jpg', 'jpeg');
            else if (parseInt(ftype) == 2)
                fileListToUpload = new Array('jpg', 'jpeg');
            else
                fileListToUpload = new Array('pdf');

            //Check the file extension is in the array.
            var isValidFile = $.inArray(extn, fileListToUpload);

            // isValidFile gets the value -1 if the file extension is not in the list.
            if (isValidFile == -1) {
                if (parseInt(ftype) == 1)
                    alert('Please upload a valid document of type pdf/jpg/jpeg.!!!');
                else if (parseInt(ftype) == 2)
                    alert('Please upload a valid document of type jpg/jpeg.!!!');
                else
                    alert('Please Upload a valid document !!!');
                $('#' + cntr).replaceWith($('#' + cntr).val('').clone(true));
            }
            else {
                // Restrict the file size to 200KB(200000)
                if ($('#' + cntr).get(0).files[0].size > (200000)) {
                    alert('Document size should not exceed 200KB.!!!');
                    $('#' + cntr).replaceWith($('#' + cntr).val('').clone(true));
                }
                if ($('#' + cntr).get(0).files[0].name.length > 100) {
                    alert('Document Name should be maximum 100 Characters !!!');
                    $('#' + cntr).replaceWith($('#' + cntr).val('').clone(true));
                }
                else
                    return true;
            }
        }
        else
            return true;
    }
</script>
<div class="container-fluid">
    <div class="row">
        <div class="col-12 pb-3">
            <div class="card">
                <div class="data-info">
                    <div class="row">
                        <div class="col">
                            <h2>Hospital Details</h2>
                            <div class="row">
                                <div class="col-sm-3">
                                    <p>State</p>
                                    <h3 id="hdState"></h3>
                                </div>
                                <div class="col-sm-3">
                                    <p>District</p>
                                    <h3 id="hdDistrict"></h3>
                                </div>
                                <div class="col-sm-3">
                                    <p>Hospital Code</p>
                                    <h3 id="hdHospitalCode"></h3>
                                </div>
                                <div class="col-sm-3">
                                    <p>Name</p>
                                    <h3 id="HdName"></h3>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <h2>Member Info</h2>
                            <div class="row">
                                <div class="col-sm-3">
                                    <p>URN Number</p>
                                    <h3 id="urnNum"></h3>
                                    <div id="memberBlockCode" style="visibility:hidden"></div>
                                </div>
                                <div class="col-sm-3">
                                    <p>Patient Name</p>
                                    <h3 id="Patientname"></h3>
                                    <h3 id="headOfFamilyID" style="visibility:hidden"></h3>
                                    <h3 id="TransId" style="visibility:hidden"></h3>
                                    <h3 id="InvoiceNo" style="visibility:hidden"></h3>
                                </div>
                                <div class="col-sm-3">
                                    <p>Package Name</p>
                                    <h3 id="Packagename"></h3>
                                    @*<h3 id="Packagename" style="visibility:hidden"></h3>*@
                                    <div id="panchayatCode" style="visibility:hidden"></div>
                                </div>
                                <div class="col-sm-3">
                                    <p>Package Blocking Date</p>
                                    <h3 id="BlockPackageDt"></h3>
                                    <h3 id="districtCode" style="visibility:hidden"></h3>
                                    <div id="villageCode" style="visibility:hidden"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                </div>
                <div class="card-body">
                    <div class="custom-tab-content px-3">
                        <div>
                            <form>
                            <div class="form-group row">
                                <label for="treatmentCost" class="col-sm-2 col-form-label">No. of Extention Days<b><span style="color:red">*</span></b></label>
                                <div class="col-sm-3">
                                    <input type="text" class="form-control" id="txtExtDays" maxlength="1" onkeypress="return checkDec(event)"/>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="document" class="col-sm-2 col-form-label">Upload Prescription<b><span style="color:red">*</span></b></label>
                                <div class="col-sm-3">
                                    <input type="file" class="form-control" id="fuUploadDocument" placeholder="Upload here">
                                    <span style="font-weight: bold; color: Green">Max file size is 200KB</span>
                                    <br />
                                    <span style="font-weight: bold; color: Green">Only pdf/jpg/jpeg document allowed</span>
                                </div>
                            </div>
                            <div class="table table-striped table-bordered" id="jsGrid">
                            </div>
                            <div class="text-right py-3">
                                <input type="button" value="Back" class="btn btn-outline-danger my-2 my-sm-0" id="btnBack" />
                                <input class="btn btn-outline-success my-2 my-sm-0" type="button" value="Request For Extension" id="btnSubmit">
                            </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Body content Ends here -->
<!-- START HERE: Registration confirmation modal content -->
<div class="modal fade" id="admissionConfirmation" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="alert text-info" role="alert">
                    Are you sure want to Register ?
                </div>
                <div class="text-right">
                    <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal">NO</button>
                    <a href="javascript: void(0);" class="btn btn-outline-success btn-sm ml-1">YES</a>
                </div>
            </div>
        </div>
    </div>
    <!-- END HERE: Registration confirmation modal content -->
    <script type="text/javascript">
        $(function () {
            $('.datepicker').datepicker({
                format: 'dd M yyyy',
                endDate: 'today',
                autoclose: true
            }); //code for datepicker
            $('.secondary-menu li a').tooltip();
        });
    </script>






